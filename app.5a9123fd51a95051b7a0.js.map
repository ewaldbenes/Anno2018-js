{"version":3,"sources":["webpack:///./src/game/island-renderer.ts","webpack:///./src/game/ui/slider-sprite.ts","webpack:///./src/index.ts","webpack:///./src/util/ffmpeg.ts","webpack:///./src/parsers/GAM/world-generator.ts","webpack:///./src/upload.ts","webpack:///./src/game/font-loader.ts","webpack:///./src/game/island-sprite-loader.ts","webpack:///./src/filesystem.ts","webpack:///./src/game/music-player.ts","webpack:///./src/game/menu/missions.ts","webpack:///./src/parsers/BSH/bsh-image.ts","webpack:///./src/game/game-renderer.ts","webpack:///./src/uploadInfo.tsx","webpack:///./src/game/world/kontor.ts","webpack:///./src/game/world/contract.ts","webpack:///./src/game/world/castle.ts","webpack:///./src/parsers/BSH/bin-packer.ts","webpack:///./src/parsers/DAT/dat-parser.ts","webpack:///./src/game/game.ts","webpack:///./src/game/world/island.ts","webpack:///./src/game/world/city.ts","webpack:///./src/game/world/player-event.ts","webpack:///./src/parsers/BSH/bsh-parser.ts","webpack:///./src/game/field-type.ts","webpack:///./src/parsers/GAM/gam-parser.ts","webpack:///./src/game-loader.ts","webpack:///./src/parsers/GAM/block.ts","webpack:///./src/game/world/trader.ts","webpack:///./src/parsers/ZEI/bitmap-font-generator.ts","webpack:///./src/game/gad-renderer.ts","webpack:///./src/game/world/world.ts","webpack:///./src/game/world/timers.ts","webpack:///./src/game/menu-structure.ts","webpack:///./src/translation/translations.ts","webpack:///./src/translation/translator.ts","webpack:///./src/game/world/ship-course.ts","webpack:///./src/parsers/stream.ts","webpack:///./src/parsers/COD/cod-parser.ts","webpack:///./src/game/world/producer.ts","webpack:///./src/game/world/field.ts","webpack:///./src/parsers/SMK/smk-parser.ts","webpack:///./src/game/world/player.ts","webpack:///./src/game/config-loader.ts","webpack:///./src/util/assert.ts","webpack:///./src/game/world/world-generation-settings.ts","webpack:///./src/game/world/island-ore-location.ts","webpack:///./src/sprite-loader.ts","webpack:///./src/game/world/soldier.ts","webpack:///./src/parsers/GAM/island-loader.ts","webpack:///./src/parsers/BSH/bsh-color-palette.ts","webpack:///./src/game/world/task.ts","webpack:///./src/parsers/WAV/wav-parser.ts","webpack:///./src/game/world/ship.ts","webpack:///./src/game/world/good.ts","webpack:///./src/util/util.ts","webpack:///./src/util/pixi.ts","webpack:///./src/translation/translation-parser.ts"],"names":["IslandRenderer","world","fs","spriteLoader","_classCallCheck","this","islands","getIslandSprites","sprites","console","log","sort","a","b","layer","ra","position","x","y","rb","forEach","sprite","_this","addChild","SliderSprite","dragging","PIXI","Sprite","sizeY","offsetY","sliderSizeY","_this2","set","topY","on","event","eventY","data","originalEvent","texture","height","clamp","val","min","max","Math","_interopRequireWildcard","__webpack_require__","_filesystem","_interopRequireDefault","_gameLoader","_configLoader","_fontLoader","_gadRenderer","_islandRenderer","_islandSpriteLoader","_menuStructure","_musicPlayer","_gamParser","_islandLoader","_spriteLoader","_translator","_upload","_util","Viewport","__awaiter","regeneratorRuntime","mark","_callee2","style","game","version","FS_SIZE_MB","uploadHandler","app","viewport","menuViewport","fontLoader","configLoader","musicPlayer","gamParser","worldFieldBuilder","islandRenderer","gameLoader","queryGameName","gadRenderer","menuStructure","wrap","_context2","prev","next","enableAll","document","createElement","innerText","id","innerHTML","concat","head","appendChild","body","default","init","window","render","isUploaded","sent","warn","abrupt","Application","width","innerWidth","innerHeight","antialias","transparent","insertAdjacentElement","view","screenWidth","screen","screenHeight","stage","drag","direction","wheel","worldWidth","worldHeight","loadTranslations","load","getQueryParameter","loadByName","visible","mission","_callee","_context","stop","renderScreen","loadedFFmpeg","loadFFmpeg","doLoadFFmpeg","Promise","resolve","reject","arguments","returnCallback","loadFFmpegInBrowser","ffmpeg","eval","__dirname","callback","ffmpeg_run","self","getElementsByTagName","script","type","src","onreadystatechange","onload","_island","_assert","_block","WorldGenerator","islandLoader","worldGenerationSettings","nextIslandId","apply","_toConsumableArray","map","island","islandTemplates","islandTemplate","loadRandomIslandFile","size","climate","isSouth","numBaseIsland","blocks","eof","push","Block","fromStream","inselBlock","find","block","includes","undefined","inselHausBlock","newIsland","islandFromIsland5File","islandFromIsland4File","islandFromIsland3File","Error","baseFields","parseIslandBuildings","topFields","empty","JSZip","React","ReactDOM","_bshParser","_codParser","_datParser","_smkParser","_stream","_wavParser","_bitmapFontGenerator","_translationParser","_uploadInfo","escapeStringRegexp","UploadHandler","logger","ls","table","notes","onUploaded","uploadAndParse","bind","onReset","reset","onSaveOrMissionUploaded","evt","files","target","length","all","Array","from","file","uploadSaveOrMission","alert","location","reload","setLogger","exists","rmRoot","write","open","zipFileEntry","loadAsync","zip","error","_context5","t0","message","annoRoot","findRootInZip","copyIslands","copySaves","parseTranslations","customMissionPath","copyMissions","decryptCODs","parseDATs","parseGADs","parseBSHs","parseZEIs","parseMusic","parseVideos","t1","name","endsWith","r","_this3","_callee7","inName","outName","parser","_context7","info","openAndGetContentAsText","parse","call","JSON","stringify","mkdir","gadFile","findFileCaseInsensitive","async","_this4","_callee10","codFile","codStream","_context10","fromZipObject","decrypt","bshFile","_context12","decodeBSH","images","sheets","createSpriteSheets","saveSpriteSheets","translationFile","codParser","translations","PATH","bitmapFontGenerator","fontName","zeiFile","_context14","decodeZEI","createBitmapFont","font","hasFolderCaseInsensitive","wavParser","findFilesInZip","songs","song","path","substr","rawData","decode","wavData","encode","smkParser","videos","video","videoData","result","replace","_this5","copyFolderFromZip","inPath","outPath","fileExtensions","makeLowerCase","fileAndPath","relativePath","toLowerCase","targetPath","_context20","t2","startsWith","_iteratorNormalCompletion4","_didIteratorError4","_iteratorError4","_step4","_iterator4","split","Symbol","iterator","done","fileExtension","value","substring","err","return","caseInsensitiveFileName","RegExp","caseInsensitiveFolderName","folder","FontLoader","fonts","ZEI20V","Object","keys","openAndGetContentAsUint8Array","loader","add","uInt8ToBase64","IslandSpriteLoader","inited","fields","Map","textures","getTextures","getFieldData","handleField","_x","_y","field","fieldConfig","get","fieldId","origin","Point","newSprites","getSprites","rotation","ani","Filer","FileSystem","filer","root","persistent","filename","create","foldername","directory","filterByExtensions","entries","extensions","filter","entry","isFile","some","extension","entryOrPath","fullPath","parts","part","getTextContentFromFile","_context8","getUint8ContentFromFile","fileReader","FileReader","onerror","readAsText","Uint8Array","readAsArrayBuffer","_this6","df","used","free","cap","pathOrEntry","content","_this7","_this8","rm","_this9","downloadFile","downloadDirectory","fileName","element","setAttribute","display","click","removeChild","download","MusicPlayer","playing","buffer","loadSound","sound","loop","each","isPlaying","play","currentSongIdx","playNext","preload","Sound","source","singleInstance","loaded","preloadedSound","Missions","buttons","renderNewGame","renderLoadGame","emit","_callee3","_context3","currentPage","_callee4","_context4","ceil","newGameLines","ROWS","SCROLL_UP","SCROLL_DOWN","getNewGameLines","_playMainMenuMusic","currentTopItem","i","bitmapText","getChildByName","off","interactive","buttonMode","line","text","once","_callee6","_context6","_i","_i2","save","saves","maxSaveGames","toString","padStart","_callee8","_loop","_i3","loadMissions","missions","missionNum","_callee11","ranking","campaignNum","_context11","openAndGetContentAsStream","has","read32","UPNG","BSHImage","pixels","GameRenderer","fieldPos","xx","yy","worldX","TILE_WIDTH","worldY","floor","TILE_HEIGHT","myPlayerId","removeChildren","moveCameraToStartPosition","_zoom","center","scale","moveCenter","myKontor","kontors","kontor","playerId","myShip","ships","ship","moveTo","kontorIsland","islandId","point","fieldPosToWorldPos","UploadInfo","props","_getPrototypeOf","msg","setState","prevState","assign","messages","zipUploaded","_assertThisInitialized","worked","isUploading","resetFiles","state","Component","marginLeft","marginRight","fontFamily","maxWidth","lineHeight","href","multiple","accept","onChange","disabled","fontSize","key","color","toUpperCase","onClick","read8","goods","_good","fromSaveGame","parseGoods","ContractState","exports","Contract","time","numSwords","read16","numMuscets","numCanons","units","Unit","parseUnits","read","ready","hp","flags","BinPacker","w","h","node","findNode","splitNode","right","down","DATParser","getLogger","variables","objects","template","gfxMap","lastGfxName","currentObject","currentNestedObject","currentItem","currentNestedItem","_iteratorNormalCompletion","_didIteratorError","_iteratorError","_step","_iterator","trim","match","handleConstantAssignment","handleObjFill","handleNestedObjectBegin","handleProperty","handleNestedObjectEnd","mapToObject","gfx_category_map","fill","item","items","hasOwnProperty","baseItemNum","getValue","baseItem","deepCopy","GfxCategory","isMath","constant","currentGfx","objectName","nested_objects","_defineProperty","valueAsString","GfxCategoryMapped","nestedItem","isObject","deepMerge","tmp","arrayElement","oldVal","parseInt","parseFloat","arrayIdx","res","indexOf","values","v","index","obj","op","val1","val2","_typeof","isArray","patch","output","_redux","_reduxDevtoolsExtension","_reduxWatch","_Observable","_operators","_world","TICK","DONATE_MONEY","SET_SIMULATION_SPEED","PAY_UPKEEP","createSetSimulationSpeed","newSpeed","payload","createPayUpkeep","upkeep","Game","gameRenderer","timerId","keyboardManager","setupHotKeys","initialState","players","mapArrayById","tasks","cities","producers","timers","simulationSpeed","SimulationSpeed","Paused","store","createStore","combineReducers","playerReducer","timerReducer","composeWithDevTools","watchSimulationSpeed","watchTicksForUpkeep","dispatch","Default","enable","begin","arr","reduce","objectMap","simulationSpeedWatcher","getState","subscribe","speed","clearInterval","setInterval","tick","n","tickWatcher","Observable","observer","pipe","upkeeps","calculateUpkeeps","_arr","producer","buildingId","production","active","keyboard","Key","showTaskKey","F1","onKeyPressedWithPreventDefault","player","assignedTask","assignedTaskId","zoomKeys","F2","zoom","F3","F4","zoomKey","speedKeys","PAUSE","F5","Slow","F6","Medium","F7","Fast","SHIFT","F8","SuperFast","_loop2","speedKey","onKeysPressedWithPreventDefault","action","gameTime","timeGame","_Object$assign","fromPlayer","money","amount","toPlayer","every","e","read8Bool","numOreLocations","fertilityDiscovered","oreLocations","_islandOreLocation","OreLocation","fertility","tobacco","IslandFertilityFlags","TOBACCO","sugarcane","SUGARCANE","wine","WINE","cotton","COTTON","cacao","CACAO","spice","SPICE","parseFertility","differsFromBaseIsland","positionRect","Rectangle","cityIslandNum","progressAllowed","inhabitants","taxes","readString","PlayerEventKind","PlayerEvent","kind","otherPlayerId","_smartBuffer","_binPacker","_bshColorPalette","_bshImage","BSHParser","SPRITESHEET_SIZE","HEADER_SIZE","binPacker","atlasData","meta","frames","image","addBlock","png","config","startX","startY","j","idx","frame","rotated","trimmed","spriteSourceSize","sourceSize","saveSpriteSheet","SmartBuffer","writeString","padEnd","writeUInt32LE","imageBuffer","encodeImage","toBuffer","writeOffset","writeBuffer","fileType","fileLength","imageOffsets","numImages","seek","bshImage","decodeImage","rowIdx","targetIdx","ch","coloredPixels","FEs","skipPixelsEmpty","writeUInt8","coloredPixelsSlice","slice","pixel","colorIdx","colorsToIdx","_coloredPixelsSlice","padding","sheet","spritesheetIndex","_gameRenderer","FieldType","Id","gfxId","Gfx","Kind","Size","rotate","Rotate","animAdd","AnimAdd","animAnz","AnimAnz","animTime","AnimTime","yOffset","Posoffs","productionConfig","HAUS_PRODTYP","inactive","Kosten","good","Ware","animationStep","sx","sy","_GameRenderer$fieldPo","getTexture","animatedTextures","animatedSprite","extras","AnimatedSprite","animationSpeed","anchor","tileId","_castle","_city","_kontor","_player","_producer","_ship","_soldier","_task","_timers","_trader","_worldGenerationSettings","_worldGenerator","GAMParser","worldGenerator","lastIslandBlock","inselHausBlocks","doParse","populateWorld","gameName","nameBlock","playerBlock","parsePlayers","islandBlocks","parseIslands","handleBlock","taskFromSaveGame","shipFromSaveGame","soldiers","soldierFromSaveGame","kontorFromSaveGame","castles","castleFromSaveGame","cityFromSaveGame","producerFromSaveGame","trader","traderFromSaveGame","timersFromSaveGame","entities","islandBlock","islandFromSaveGame","islandBuildingBlocks","islandTopBlock","islandBottomBlock","loadIslandFile","islandFile","playerFromSaveGame","_game","GameLoader","loadSavesAndMissions","saveOrMission","saveGame","saveGameData","getWorld","gameLogic","playAll","IslandBlock","_1","_2","goodId","_3","xml","BitmapFontGenerator","pages","chars","pageId","page","_attr","char","xoffset","yoffset","xadvance","chnl","letter","String","fromCharCode","face","spacing","italic","bold","stretchH","smooth","aa","common","packed","indent","_sliderSprite","GADRenderer","destroyVideos","blockNumMapping","radioButtons","selectableCount","gadgets","GADGET","num","gadget","blockNr","Blocknr","gfx","Gfxnr","Pos","selectable","Noselflg","pressOff","Pressoff","isRadioButton","Reiheflg","isSlider","Slidverflg","sliderOffset","Slidoffs","sliderSize","Slidsize","defaultTexture","activeTexture","setSliderData","button","BitmapText","pivot","hitArea","onLoad","videoSprite","onEnd","baseTexture","addEventListener","destroy","World","cntCity","cntIsland","cntShipyard","cntMilitary","cntProduction","cntSettlers","cntGrowth","timeCity","timeIsland","timeShipyard","timeMilitary","timeProduction","timeGoodToolsCnt","timeGoodToolsMax","noErzOutFlg","tutorFlg","aiLevel","missionNumber","enableTrader","bigIronRunsOut","enableDroughts","enablePirate","enableVulcano","gameId","cityNameNumber","timeNextDrought","timePirateSec","missionSubNumber","shipMax","timeNextVulcano","cntVulcano","timeSettlers","timeGrowth","_pixi2","_missions","MenuStructure","structure","menu_main","loadVideoSprite","renderVideo","renderVideoFullscreen","_callee5","menu_missions","menu_loading","menu_mission_details","_callee9","_context9","_callee12","_callee13","_context13","_callee14","_callee15","_context15","_callee16","_context16","_callee17","_context17","utils","EventEmitter","videoNumber","textureFromUint8ArrayMP4","GAME","LEISTE","PLAYCOL","VIDEOKIND","SPEECHKIND","ENDLESSKIND","TUTORKIND","KAMPAGNE","FIGKIND","WARE","ROHST","ROHSTFELD","MILITAR","WOHNHAUS","STRASSE","BERGWERK","HANDWERK","FARM","HAFEN","DIVERS","ABRISS","LANDSCHAFT","jsonData","translationIdx","domain","keyToIdxMapping","_translations","translationKey","CourseState","ShipCourse","byte2","byte3","byte4","Stream","pos","character","readNBytes","pow","CODParser","encoding","decryptedBytes","Buffer","_iconvLite","encryptedBytes","speedCount","stock","read24","timer","secondGoodStock","firstGoodStock","producedGood","prodCnt","timeCnt","flags1","connectedToMarket","animCnt","allowGoodPickup","noGoodCnt","Field","islandCityNum","random","bits","animation","saveGameDataLength","_ffmpeg","SMKParser","inputFiles","args","prepareArguments","convert","_args","mergeAudio","join","handleOutput","str","print","printErr","stdin","TOTAL_MEMORY","read32S","killedByPlayerId","_3_3","_3_2","palaceBuilt","cathedralBuilt","enemiesDefeated","triumphArchesBuilt","soldiersKilled","soldiersFallen","shipsSunken","shipsKilled","_4","enablePositiveWillInfluence","enableNegativeWillInfluence","_5","positiveWillInfluence","negativeWillInfluence","accessibleBuildings","statues","statuesBuilt","tradeContracts","_contract","peaceContracts","playerEvents","_playerEvent","fullName","shortName","PlayerKind","_fieldType","ConfigLoader","fieldData","getFieldConfig","HAUS","expr","Boolean","WorldGenerationSettings","numNativesNorth","numNativesSouth","numBigIronOre","numSmallIronOre","numGoldOre","numWine","numSugarCane","numSpice","numCacao","numTobacco","numCotton","numTreasures","numIslands","forceNorth","forceSouth","islandSize","OreLocationKind","OreLocationSize","discoveredBy","SpriteLoader","loadTextures","textureMap","lastIndexOf","dataFileName","spriteSheetData","spriteSheetImageData","tex","textureFromUint8ArrayPNG","spritesheet","Spritesheet","hmm","SoldierType","isPatrolling","_field","IslandLoader","islandSizes","maxSize","islandNumber","sizeId","islandFiles","loadIslandsWithSizeAndClimate","randomIslandFile","dataLength","sizeName","idxToColors","colorsToIdxInner","monopolyGoodId1","monopolyGoodId2","helpOtherToReachInhabitantsPlayerId","playersToKill","requiredBalance","successVideoId","requiredTradeBalance","_6","ownCityReachInhabitants","count","requiredLevel","requiredLevelCount","_7","helpOtherToReachInhabitants","WAVParser","adpcmIndexTable","adpcmStepTable","wav","_wavefile","bitsPerSample","fmt","sampleRate","channels","numChannels","c1","step_index","predictor","c2","samples","left","Int16Array","decodeADPCM_IMA","numSamples","fromScratch","c","nibble","step","stepIndex","av_clip","sign","diff","av_clip_int16","_shipCourse","tradeStops","kontor_id","parseShipGoods","parseShipTradeStops","cargo","good_id","GoodAction","Good","sellingPrice","buyingPrice","wantedSellingAmount","wantedBuyingAmount","currentAmount","CHUNK_SIZE","subarray","btoa","url","results","exec","decodeURIComponent","gfxFolder","Texture","fromImage","tmpVideo","VideoBaseTexture","fromVideo","currentDomain"],"mappings":"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AM,IACZ,GAAM,GAAM,IACZ,EAAM,GAAM,IACZ,GAAM,GAAM,IACZ,GAAM,GAAM,IACZ,GAAM,IAAM,IACZ,GAAM,IAAM,IACZ,EAAM,GAAM,IACZ,EAAM,GAAM,IACZ,GAAM,IAAM,IACZ,GAAM,IAAM,IACZ,EAAM,IAAM,IACZ,GAAM,IAAM,IACZ,GAAM,IAAM,IACZ,GAAM,IAAM,IACZ,GAAM,IAAM,IACZ,GAAM,IAAM,IACZ,GAAM,IAAM,IACZ,GAAM,IAAM,IACZ,EAAM,IAAM,IACZ,GAAM,IAAM,IACZ,GAAM,IAAM,IACZ,GAAM,IAAM,IACZ,EAAM,IAAM,IACZ,GAAM,IAAM,IACZ,EAAM,IAAM,IACZ,GAAM,IAAM,IACZ,IAAM,IAAM,GACZ,GAAM,IAAM,IACZ,EAAM,IAAM,IACZ,EAAM,IAAM,IACZ,GAAM,IAAM,IACZ,GAAM,IAAM,IACZ,GAAM,IAAM,IACZ,GAAM,IAAM,IACZ,GAAM,IAAM,IACZ,GAAM,IAAM,IACZ,EAAM,IAAM,IACZ,GAAM,IAAM,IACZ,EAAM,IAAM,IACZ,IAAM,IAAM,IACZ,IAAM,IAAM,IACZ,IAAM,IAAM,EACZ,IAAM,IAAM,EACZ,EAAM,IAAM,IACZ,IAAM,IAAM,GACZ,IAAM,IAAM,GACZ,GAAM,IAAM,IACZ,GAAM,IAAM,IACZ,GAAM,IAAM,IACZ,IAAM,IAAM,IACZ,GAAM,IAAM,IACZ,GAAM,GAAM,EACZ,GAAM,GAAM,EACZ,GAAM,GAAM,GACZ,GAAM,GAAM,GACZ,GAAM,GAAM,GACZ,GAAM,GAAM,EACZ,GAAM,GAAM,GACZ,GAAM,IAAM,EACZ,GAAM,IAAM,EACZ,GAAM,GAAM,EACZ,GAAM,IAAM,GACZ,GAAM,IAAM,EACZ,GAAM,IAAM,GACZ,GAAM,IAAM,EACZ,GAAM,IAAM,GACZ,GAAM,GAAM,GACZ,GAAM,GAAM,GACZ,GAAM,GAAM,GACZ,GAAM,GAAM,GACZ,GAAM,GAAM,GACZ,GAAM,GAAM,GACZ,GAAM,GAAM,GACZ,GAAM,GAAM,GACZ,GAAM,GAAM,GACZ,GAAM,GAAM,GACZ,GAAM,GAAM,GACZ,GAAM,IAAM,GACZ,GAAM,GAAM,IACZ,GAAM,GAAM,IACZ,GAAM,IAAM,IACZ,GAAM,GAAM,EACZ,GAAM,GAAM,GACZ,GAAM,GAAM,GACZ,GAAM,GAAM,GACZ,GAAM,GAAM,GACZ,GAAM,GAAM,GACZ,GAAM,IAAM,GACZ,GAAM,GAAM,GACZ,GAAM,IAAM,GACZ,GAAM,IAAM,GACZ,GAAM,GAAM,GACZ,GAAM,IAAM,GACZ,GAAM,GAAM,GACZ,GAAM,IAAM,IACZ,IAAM,GAAM,GACZ,IAAM,GAAM,GACZ,IAAM,GAAM,GACZ,IAAM,GAAM,GACZ,IAAM,IAAM,GACZ,IAAM,IAAM,GACZ,IAAM,IAAM,IACZ,IAAM,GAAM,EACZ,IAAM,GAAM,GACZ,IAAM,GAAM,GACZ,IAAM,GAAM,GACZ,IAAM,GAAM,EACZ,IAAM,GAAM,GACZ,IAAM,GAAM,EACZ,IAAM,GAAM,GACZ,GAAM,IAAM,EACZ,GAAM,IAAM,EACZ,GAAM,IAAM,EACZ,GAAM,IAAM,EACZ,GAAM,IAAM,GACZ,GAAM,IAAM,GACZ,GAAM,IAAM,GACZ,GAAM,IAAM,EACZ,GAAM,IAAM,EACZ,GAAM,IAAM,GACZ,GAAM,IAAM,GACZ,GAAM,IAAM,EACZ,GAAM,IAAM,GACZ,GAAM,IAAM,GACZ,GAAM,IAAM,GACZ,GAAM,IAAM,EACZ,GAAM,IAAM,GACZ,GAAM,IAAM,IACZ,IAAM,IAAM,IACZ,GAAM,IAAM,EACZ,GAAM,IAAM,GACZ,GAAM,IAAM,GACZ,IAAM,IAAM,GACZ,IAAM,IAAM,IACZ,IAAM,IAAM,GACZ,IAAM,IAAM,GACZ,IAAM,IAAM,IACZ,IAAM,IAAM,GACZ,IAAM,IAAM,GACZ,GAAM,IAAM,IACZ,GAAM,IAAM,IACZ,IAAM,IAAM,IACZ,IAAM,IAAM,IACZ,GAAM,IAAM,IACZ,GAAM,IAAM,IACZ,IAAM,IAAM,IACZ,IAAM,IAAM,IACZ,GAAM,IAAM,IACZ,GAAM,IAAM,IACZ,GAAM,IAAM,IACZ,GAAM,IAAM,IACZ,GAAM,IAAM,IACZ,GAAM,IAAM,IACZ,GAAM,IAAM,IACZ,IAAM,IAAM,IACZ,IAAM,IAAM,IACZ,IAAM,IAAM,IACZ,IAAM,IAAM,IACZ,IAAM,IAAM,IACZ,IAAM,IA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","file":"app.5a9123fd51a95051b7a0.js","sourcesContent":["import * as PIXI from \"pixi.js\";\nimport FileSystem from \"../filesystem\";\nimport IslandSpriteLoader from \"./island-sprite-loader\";\nimport { SpriteWithPositionAndLayer } from \"./island-sprite-loader\";\nimport { Island } from \"./world/island\";\n\nexport const TILE_WIDTH = 64;\nexport const TILE_HEIGHT = 31;\n\nexport default class IslandRenderer {\n  constructor(\n    private world: PIXI.Container,\n    private fs: FileSystem,\n    private spriteLoader: IslandSpriteLoader\n  ) {}\n\n  public async render(islands: Island[]) {\n    const sprites = await this.spriteLoader.getIslandSprites(islands);\n    console.log(\"Map sprites loaded.\");\n    sprites.sort(\n      (a: SpriteWithPositionAndLayer, b: SpriteWithPositionAndLayer) => {\n        if (a.layer === b.layer) {\n          const ra = a.position.x + a.position.y;\n          const rb = b.position.x + b.position.y;\n          if (ra === rb) {\n            return 0;\n          } else if (ra < rb) {\n            return -1;\n          } else {\n            return 1;\n          }\n        } else if (a.layer === \"land\") {\n          return -1;\n        } else {\n          return 1;\n        }\n      }\n    );\n    console.log(\"Map sprites sorted.\");\n\n    sprites.forEach((sprite: SpriteWithPositionAndLayer) =>\n      this.world.addChild(sprite.sprite)\n    );\n    console.log(\"Map sprites drawn.\");\n  }\n}\n","import InteractionEvent = PIXI.interaction.InteractionEvent;\n\nexport default class SliderSprite extends PIXI.Sprite {\n  private dragging = false;\n  private topY: number;\n\n  public setSliderData(sizeY: number, offsetY: number, sliderSizeY: number) {\n    this.position.set(\n      this.position.x,\n      this.position.y + (sizeY - sliderSizeY) / 2\n    );\n    this.topY = this.position.y;\n    // sprite.position.set(sprite.position.x + sliderOffset[0], sprite.position.y + sliderOffset[1]);\n    this.on(\"mousedown\", (event: InteractionEvent) => {\n      this.dragging = true;\n    });\n    this.on(\"mouseup\", (event: InteractionEvent) => {\n      this.dragging = false;\n    });\n    this.on(\"mousemove\", (event: InteractionEvent) => {\n      if (this.dragging) {\n        const originalEvent = event.data.originalEvent as\n          | MouseEvent\n          | PointerEvent;\n        const eventY = originalEvent.offsetY - this.texture.height / 2;\n        this.position.y = this.clamp(\n          eventY,\n          this.topY,\n          this.topY + sliderSizeY - this.texture.height / 2\n        );\n      }\n    });\n  }\n\n  /*\n    public moveDown() {\n\n    }\n\n    public moveUp() {\n\n    }\n    */\n\n  private clamp(val: number, min: number, max: number) {\n    return Math.min(Math.max(min, val), max);\n  }\n}\n","import * as log from \"loglevel\";\nimport \"pixi-keyboard\";\nimport * as PIXI from \"pixi.js\";\nimport FileSystem from \"./filesystem\";\nimport GameLoader from \"./game-loader\";\nimport ConfigLoader from \"./game/config-loader\";\nimport FontLoader from \"./game/font-loader\";\nimport GADRenderer from \"./game/gad-renderer\";\nimport IslandRenderer from \"./game/island-renderer\";\nimport IslandSpriteLoader from \"./game/island-sprite-loader\";\nimport MenuStructure from \"./game/menu-structure\";\nimport MusicPlayer from \"./game/music-player\";\nimport GAMParser from \"./parsers/GAM/gam-parser\";\nimport IslandLoader from \"./parsers/GAM/island-loader\";\nimport SpriteLoader from \"./sprite-loader\";\nimport { loadTranslations } from \"./translation/translator\";\nimport UploadHandler from \"./upload\";\nimport { getQueryParameter } from \"./util/util\";\n\nconst Viewport = require(\"pixi-viewport\");\n\n// tslint:disable-next-line:no-floating-promises\n(async () => {\n  log.enableAll();\n\n  const style = document.createElement(\"style\");\n  style.innerText = `\n        body, html {\n            margin: 0;\n        }\n    `;\n  const game = document.createElement(\"div\");\n  game.id = \"game\";\n  const version = document.createElement(\"p\");\n  version.innerHTML = `Anno 2018, version ${__VERSION__},\n                         made by <a href=\"https://github.com/cmfcmf\">@cmfcmf</a>.\n                         The sourcecode can be found at <a href=\"https://github.com/cmfcmf/Anno2018-js\">GitHub</a>.`;\n\n  document.head.appendChild(style);\n  document.body.appendChild(game);\n  document.body.appendChild(version);\n\n  const fs = new FileSystem();\n  const FS_SIZE_MB = 2000;\n  await fs.init(1024 * 1024 * FS_SIZE_MB);\n  (window as any).fs = fs;\n\n  const uploadHandler = new UploadHandler(fs);\n  await uploadHandler.init();\n  uploadHandler.render(game);\n\n  if (!(await uploadHandler.isUploaded())) {\n    console.warn(\"Anno 1602 files not yet uploaded.\");\n    return;\n  }\n\n  // PIXI.utils.skipHello();\n  const app = new PIXI.Application({\n    width: window.innerWidth,\n    height: window.innerHeight - 120,\n    antialias: false,\n    transparent: false\n  });\n  game.insertAdjacentElement(\"afterbegin\", app.view);\n\n  const viewport = new Viewport({\n    screenWidth: app.screen.width,\n    screenHeight: app.screen.height\n  });\n  app.stage.addChild(viewport);\n\n  viewport.drag({ direction: \"all\", wheel: false }).wheel();\n  //    .mouseEdges({distance: 1000})\n  //    .clamp({direction: \"all\"})\n\n  const menuViewport = new Viewport({\n    screenWidth: app.screen.width,\n    screenHeight: app.screen.height,\n    worldWidth: 1024,\n    worldHeight: 768\n  });\n  app.stage.addChild(menuViewport);\n\n  await loadTranslations(fs);\n\n  const fontLoader = new FontLoader(fs);\n  await fontLoader.load();\n\n  const configLoader = new ConfigLoader(fs);\n  await configLoader.load();\n\n  const musicPlayer = new MusicPlayer(fs);\n  await musicPlayer.load();\n\n  const spriteLoader = new SpriteLoader(fs);\n\n  const gamParser = new GAMParser(new IslandLoader(fs));\n  const worldFieldBuilder = new IslandSpriteLoader(\n    fs,\n    configLoader,\n    spriteLoader\n  );\n  const islandRenderer = new IslandRenderer(viewport, fs, worldFieldBuilder);\n\n  const gameLoader = new GameLoader(\n    fs,\n    gamParser,\n    islandRenderer,\n    viewport,\n    configLoader,\n    musicPlayer\n  );\n\n  const queryGameName = getQueryParameter(\"load\");\n  if (queryGameName !== null) {\n    await gameLoader.loadByName(queryGameName);\n    menuViewport.visible = false;\n  } else {\n    // menuViewport.fit(); // TODO: Makes usage of sliders harder\n    const gadRenderer = new GADRenderer(menuViewport, spriteLoader);\n    const menuStructure = new MenuStructure(fs, gadRenderer, musicPlayer);\n    menuStructure.on(\"load-game\", async (mission: string) => {\n      await gameLoader.load(mission);\n      menuViewport.visible = false;\n    });\n    await menuStructure.renderScreen(\"menu_main\");\n  }\n})();\n","let loadedFFmpeg: any;\n\nexport async function loadFFmpeg(): Promise<any> {\n  if (loadedFFmpeg) {\n    return loadedFFmpeg;\n  }\n\n  loadedFFmpeg = await doLoadFFmpeg();\n\n  await new Promise((resolve, reject) => {\n    loadedFFmpeg({\n      arguments: [\"-version\"],\n      returnCallback: resolve\n    });\n  });\n\n  return loadedFFmpeg;\n}\n\nasync function doLoadFFmpeg() {\n  console.log(\"Loading FFmpeg\");\n  let ffmpeg;\n\n  if (typeof window !== \"undefined\") {\n    ffmpeg = await loadFFmpegInBrowser();\n  } else {\n    // We can't write require() directly, because we don't want webpack to interpret it.\n    // It is only used when running this script under Node.js.\n    // tslint:disable-next-line:no-eval\n    ffmpeg = eval(\"require\")(\n      __dirname + \"/../../node_modules/smk2mp4/demo/ffmpeg.js\"\n    );\n  }\n  console.log(\"Finished loading FFmpeg\");\n  return ffmpeg;\n}\n\nasync function loadFFmpegInBrowser(): Promise<any> {\n  return new Promise<any>((resolve, reject) => {\n    const callback = () => {\n      const ffmpeg_run = (self as any).ffmpeg_run;\n      if (ffmpeg_run) {\n        resolve(ffmpeg_run);\n      } else {\n        reject(\"Could not load FFmpeg!\");\n      }\n    };\n\n    const head = document.getElementsByTagName(\"head\")[0];\n    const script = document.createElement(\"script\");\n    script.type = \"text/javascript\";\n    script.src = \"ffmpeg.js\";\n    (script as any).onreadystatechange = callback;\n    script.onload = callback;\n\n    head.appendChild(script);\n  });\n}\n","import {\n  islandFromIsland3File,\n  islandFromIsland4File,\n  islandFromIsland5File\n} from \"../../game/world/island\";\nimport World from \"../../game/world/world\";\nimport WorldGenerationSettings from \"../../game/world/world-generation-settings\";\nimport assert from \"../../util/assert\";\nimport { Block } from \"./block\";\nimport IslandLoader from \"./island-loader\";\n\nexport default class WorldGenerator {\n  constructor(private islandLoader: IslandLoader) {}\n\n  public async populateWorld(\n    world: World,\n    worldGenerationSettings: WorldGenerationSettings\n  ) {\n    let nextIslandId = Math.max(...world.islands.map(island => island.id)) + 1;\n\n    for (const islandTemplate of worldGenerationSettings.islandTemplates) {\n      const {\n        data,\n        isSouth,\n        id: numBaseIsland\n      } = await this.islandLoader.loadRandomIslandFile(\n        islandTemplate.size,\n        islandTemplate.climate\n      );\n\n      const blocks: Block[] = [];\n      while (!data.eof()) {\n        blocks.push(Block.fromStream(data));\n      }\n\n      const inselBlock = blocks.find(block =>\n        [\"INSEL5\", \"INSEL4\", \"INSEL3\"].includes(block.type)\n      );\n      assert(inselBlock !== undefined);\n      const inselHausBlock = blocks.find(block => block.type === \"INSELHAUS\");\n      assert(inselHausBlock !== undefined);\n\n      // TODO: Place random things:\n      // numNativesNorth,\n      // numNativesSouth,\n      // numBigIronOre,\n      // numSmallIronOre,\n      // numGoldOre,\n      // numWine,\n      // numSugarCane,\n      // numSpice,\n      // numCacao,\n      // numTobacco,\n      // numCotton,\n      // numTreasures,\n\n      let newIsland;\n      switch (inselBlock.type) {\n        case \"INSEL5\":\n          newIsland = islandFromIsland5File(\n            nextIslandId++,\n            islandTemplate.position,\n            isSouth,\n            numBaseIsland,\n            inselBlock.data\n          );\n          break;\n        case \"INSEL4\":\n          newIsland = islandFromIsland4File(\n            nextIslandId++,\n            islandTemplate.position,\n            isSouth,\n            numBaseIsland,\n            inselBlock.data\n          );\n          break;\n        case \"INSEL3\":\n          newIsland = islandFromIsland3File(\n            nextIslandId++,\n            islandTemplate.position,\n            isSouth,\n            numBaseIsland,\n            inselBlock.data\n          );\n          break;\n        default:\n          throw new Error(\"This code cannot be reached.\");\n      }\n\n      newIsland.baseFields = this.islandLoader.parseIslandBuildings(\n        newIsland,\n        inselHausBlock\n      );\n      newIsland.topFields = this.islandLoader.parseIslandBuildings(\n        newIsland,\n        Block.empty(\"INSELHAUS\")\n      );\n\n      world.islands.push(newIsland);\n    }\n  }\n}\n","import * as JSZip from \"jszip\";\nimport { JSZipObject } from \"jszip\";\nimport * as log from \"loglevel\";\nimport * as React from \"react\";\nimport { ChangeEvent } from \"react\";\nimport * as ReactDOM from \"react-dom\";\nimport FileSystem from \"./filesystem\";\nimport BSHParser from \"./parsers/BSH/bsh-parser\";\nimport CODParser from \"./parsers/COD/cod-parser\";\nimport DATParser from \"./parsers/DAT/dat-parser\";\nimport SMKParser from \"./parsers/SMK/smk-parser\";\nimport Stream from \"./parsers/stream\";\n// import MP3Encoder from \"./parsers/WAV/mp3-encoder\";\nimport WAVParser from \"./parsers/WAV/wav-parser\";\nimport BitmapFontGenerator from \"./parsers/ZEI/bitmap-font-generator\";\nimport parseTranslations from \"./translation/translation-parser\";\nimport UploadInfo from \"./uploadInfo\";\nimport { findRootInZip } from \"./util/util\";\n\nconst escapeStringRegexp = require(\"escape-string-regexp\");\n\nexport interface UploadLogger {\n  readonly info: (msg: string) => void;\n  readonly warn: (msg: string) => void;\n  readonly error: (msg: string) => void;\n}\n\nexport default class UploadHandler {\n  private logger: UploadLogger;\n\n  constructor(private readonly fs: FileSystem) {\n    this.logger = log;\n  }\n\n  public async init() {\n    console.table(await this.fs.ls(\"/\"));\n  }\n\n  public render(game: HTMLElement) {\n    const notes = document.createElement(\"div\");\n    ReactDOM.render(\n      React.createElement(UploadInfo, {\n        onUploaded: this.uploadAndParse.bind(this),\n        onReset: this.reset.bind(this),\n        onSaveOrMissionUploaded: async (evt: ChangeEvent<HTMLInputElement>) => {\n          const files = evt.target.files;\n          if (files === null || files.length === 0) {\n            return;\n          }\n          await Promise.all(\n            Array.from(files).map(file => this.uploadSaveOrMission(file))\n          );\n          alert(\"Upload finished. The page will now refresh.\");\n          window.location.reload(true);\n        },\n        setLogger: this.setLogger.bind(this)\n      }),\n      game\n    );\n\n    game.appendChild(notes);\n  }\n\n  public async isUploaded() {\n    return this.fs.exists(\"/fields.dat\");\n  }\n\n  public setLogger(logger: UploadLogger) {\n    this.logger = logger;\n  }\n\n  private async reset() {\n    await this.fs.rmRoot();\n  }\n\n  private async uploadAndParse(file: File): Promise<boolean> {\n    let zip;\n    try {\n      await this.fs.write(\"/original.zip\", file);\n      const zipFileEntry = await this.fs.open(\"/original.zip\");\n      zip = await JSZip.loadAsync(zipFileEntry);\n    } catch (e) {\n      this.logger.error(`Could not upload the ZIP file: ${e.message}`);\n      return false;\n    }\n\n    try {\n      const annoRoot = findRootInZip(zip);\n      await this.fs.rmRoot();\n\n      await this.copyIslands(annoRoot);\n      await this.copySaves(annoRoot);\n      const customMissionPath = await this.parseTranslations(annoRoot);\n      await this.copyMissions(annoRoot, customMissionPath);\n      await this.decryptCODs(annoRoot);\n      await this.parseDATs();\n      await this.parseGADs(annoRoot);\n      await this.parseBSHs(annoRoot);\n      await this.parseZEIs(annoRoot);\n      await this.parseMusic(annoRoot);\n      await this.parseVideos(annoRoot);\n    } catch (e) {\n      this.logger.error(e.message);\n      return false;\n    }\n\n    return true;\n  }\n\n  private async uploadSaveOrMission(file: File) {\n    if (file.name.endsWith(\".gam\")) {\n      await this.fs.write(`/saves/${file.name}`, file);\n    } else {\n      await this.fs.write(`/missions-custom/${file.name}`, file);\n    }\n  }\n\n  private async parseDATs() {\n    return Promise.all(\n      [\n        [\"/fields.dat\", \"/fields.json\"],\n        [\"/animations.dat\", \"/animations.json\"]\n      ].map(async r => {\n        const inName = r[0];\n        const outName = r[1];\n        this.logger.info(`Started parsing \"${inName}\".`);\n\n        const parser = new DATParser();\n        const data = parser.parse(\n          await this.fs.openAndGetContentAsText(inName)\n        );\n        await this.fs.write(outName, JSON.stringify(data));\n\n        this.logger.info(`Finished parsing \"${inName}\".`);\n      })\n    );\n  }\n\n  private async parseGADs(annoRoot: JSZip) {\n    await this.fs.mkdir(\"/screens\");\n\n    const files = [\n      [\"Anno.gad\", \"\"],\n      [\"BASE.GAD\", \"menu_main\"],\n      [\"BAU.GAD\", \"\"],\n      [\"BAUKONT.GAD\", \"\"],\n      [\"BAUSHIP.GAD\", \"\"],\n      [\"BERGWERK.GAD\", \"\"],\n      [\"BUBBLE01.GAD\", \"\"],\n      [\"BUBBLE.GAD\", \"\"],\n      [\"CHAT.GAD\", \"\"],\n      [\"CLIENT.GAD\", \"\"],\n      [\"CTRL.GAD\", \"\"],\n      [\"DISK.GAD\", \"\"],\n      // [\"ENDE_DEM.GAD\", \"\"],\n      [\"ENDE.GAD\", \"menu_points\"],\n      [\"FARBWAHL.GAD\", \"menu_player_selection\"],\n      [\"HANDEL.GAD\", \"\"],\n      [\"HOST.GAD\", \"menu_missions\"],\n      [\"INFO.GAD\", \"\"],\n      [\"INFRA.GAD\", \"\"],\n      [\"KONTOR.GAD\", \"\"],\n      [\"LAGER.GAD\", \"\"],\n      [\"LEIST.GAD\", \"\"],\n      [\"MARKT.GAD\", \"\"],\n      [\"MILITAR.GAD\", \"\"],\n      [\"MISSION.GAD\", \"menu_mission_details\"],\n      [\"MISSZIEL.GAD\", \"\"],\n      [\"MKSHIP.GAD\", \"\"],\n      [\"MKSOLDAT.GAD\", \"\"],\n      [\"MUSIK.GAD\", \"\"],\n      [\"OPTION.GAD\", \"\"],\n      [\"PIRAT.GAD\", \"\"],\n      [\"PIRATORD.GAD\", \"\"],\n      [\"PLANTAGE.GAD\", \"\"],\n      [\"PROD.GAD\", \"\"],\n      [\"ROUTE.GAD\", \"\"],\n      [\"SCAPE.GAD\", \"\"],\n      [\"SHIP.GAD\", \"\"],\n      [\"SHIPLIST.GAD\", \"\"],\n      [\"SIEDLER.GAD\", \"\"],\n      [\"SKSHIP.GAD\", \"\"],\n      [\"SKSOLDAT.GAD\", \"\"],\n      [\"STADT.GAD\", \"\"],\n      [\"STADTLST.GAD\", \"\"],\n      [\"TOOLS.INC\", \"\"],\n      [\"TRADE.GAD\", \"\"],\n      [\"TRADER.GAD\", \"\"],\n      [\"TRANSFER.GAD\", \"\"],\n      [\"TRIBUT.GAD\", \"\"],\n      [\"TUTOR.GAD\", \"\"],\n      [\"VERTRAG.GAD\", \"\"],\n      [\"WAITLOAD.GAD\", \"menu_loading\"],\n      [\"WERFT.GAD\", \"\"]\n    ];\n\n    for (const r of files) {\n      if (r[1] === \"\") {\n        r[1] = r[0];\n      }\n      const inName = `GADDATA/${r[0]}`;\n      const outName = `/screens/${r[1]}.json`;\n      this.logger.info(`Started parsing \"${inName}\".`);\n\n      const parser = new DATParser();\n\n      const gadFile = this.findFileCaseInsensitive(annoRoot, inName);\n      const data = parser.parse(await gadFile.async(\"text\"));\n      await this.fs.write(outName, JSON.stringify(data));\n\n      this.logger.info(`Finished parsing \"${inName}\".`);\n    }\n  }\n\n  private async decryptCODs(annoRoot: JSZip) {\n    const parser = new CODParser();\n\n    return Promise.all(\n      [[\"haeuser.cod\", \"/fields.dat\"], [\"figuren.cod\", \"/animations.dat\"]].map(\n        async r => {\n          const inName = r[0];\n          const outName = r[1];\n\n          this.logger.info(`Started parsing \"${inName}\".`);\n\n          const codFile = this.findFileCaseInsensitive(annoRoot, inName);\n          const codStream = await Stream.fromZipObject(codFile);\n          await this.fs.write(outName, parser.decrypt(codStream));\n\n          this.logger.info(`Finished parsing \"${inName}\".`);\n        }\n      )\n    );\n  }\n\n  private async parseBSHs(annoRoot: JSZip) {\n    const parser = new BSHParser();\n\n    const files = [\n      [\"GFX/NUMBERS\", \"NUMBERS\"],\n      [\"GFX/STADTFLD\", \"STADTFLD\"],\n      [\"GFX/EFFEKTE\", \"EFFEKT\"],\n      [\"GFX/FISCHE\", \"WAL\"],\n      [\"GFX/GAUKLER\", \"GAUKLER\"],\n      [\"GFX/MAEHER\", \"MAEHER\"],\n      [\"GFX/SCHATTEN\", \"SCHATTEN\"],\n      [\"GFX/SHIP\", \"SHIP\"],\n      [\"GFX/SOLDAT\", \"SOLDAT\"],\n      [\"GFX/TIERE\", \"RIND\"],\n      [\"GFX/TRAEGER\", \"TRAEGER\"],\n      [\"ToolGfx/BAUHAUS\", \"TOOLS/BAUHAUS\"],\n      [\"ToolGfx/BAUSHIP\", \"TOOLS/BAUSHIP\"],\n      // [\"ToolGfx/EDITOR\",  \"TOOLS/EDITOR\"],\n      [\"ToolGfx/START\", \"TOOLS/START\"],\n      [\"ToolGfx/SYMBOL\", \"TOOLS/SYMBOL\"],\n      [\"ToolGfx/TOOLS\", \"TOOLS/TOOLS\"]\n    ];\n    for (const r of files) {\n      const inName = r[0] + \".BSH\";\n      const outName = r[1];\n\n      this.logger.info(`Started parsing \"${inName}\".`);\n      const bshFile = this.findFileCaseInsensitive(annoRoot, inName);\n      const images = await parser.decodeBSH(\n        await Stream.fromZipObject(bshFile)\n      );\n      const sheets = parser.createSpriteSheets(images);\n      await parser.saveSpriteSheets(this.fs, sheets, `/gfx/${outName}`);\n      this.logger.info(`Finished parsing \"${inName}\".`);\n    }\n  }\n\n  private async parseTranslations(annoRoot: JSZip) {\n    this.logger.info(\"Started parsing translations.\");\n    const translationFile = this.findFileCaseInsensitive(annoRoot, \"text.cod\");\n    const codParser = new CODParser();\n    const translations = parseTranslations(\n      codParser.decrypt(await Stream.fromZipObject(translationFile))\n    );\n    await this.fs.write(\"/translations.json\", JSON.stringify(translations));\n    this.logger.info(\"Finished parsing translations.\");\n\n    return translations.PATH[0];\n  }\n\n  private async parseZEIs(annoRoot: JSZip) {\n    await this.fs.mkdir(\"/fonts\");\n\n    const parser = new BSHParser();\n    const bitmapFontGenerator = new BitmapFontGenerator();\n\n    const files = [\n      \"ZEI11A\",\n      \"ZEI14A\",\n      \"ZEI14V\",\n      \"ZEI16G\",\n      \"ZEI16H\",\n      \"ZEI16V\",\n      \"ZEI20H\",\n      \"ZEI20V\",\n      \"ZEI24V\",\n      \"ZEI28V\",\n      \"ZEI2\",\n      \"ZEI9A\"\n    ];\n    for (const fontName of files) {\n      const inName = `TOOLGFX/${fontName}.ZEI`;\n      this.logger.info(`Started parsing \"${inName}\".`);\n\n      const zeiFile = this.findFileCaseInsensitive(annoRoot, inName);\n      const images = await parser.decodeZEI(\n        await Stream.fromZipObject(zeiFile)\n      );\n      const sheets = parser.createSpriteSheets(images);\n      await parser.saveSpriteSheets(this.fs, sheets, `/fonts/${fontName}`);\n      const font = await bitmapFontGenerator.createBitmapFont(sheets, fontName);\n\n      await this.fs.write(`/fonts/${fontName}/font.xml`, font);\n\n      this.logger.info(`Finished parsing \"${inName}\".`);\n    }\n  }\n\n  private async parseMusic(annoRoot: JSZip) {\n    await this.fs.mkdir(\"/music\");\n\n    if (!this.hasFolderCaseInsensitive(annoRoot, \"MUSIC8\")) {\n      this.logger.warn(\"No music files found.\");\n      return;\n    }\n\n    const wavParser = new WAVParser();\n    // const mp3Encoder = new MP3Encoder();\n\n    const songs = await this.findFilesInZip(annoRoot, \"MUSIC8\", \".wav\");\n    for (const song of songs) {\n      const name = song.path.substr(1);\n      this.logger.info(`Converting song ${name}`);\n      const rawData = wavParser.decode(await song.file.async(\"uint8array\"));\n      const wavData = wavParser.encode(rawData);\n\n      await this.fs.write(`/music/${name}`, wavData);\n\n      // Alternatively, we could convert the .wav files into .mp3 format.\n      // This takes about 10 seconds per .wav file.\n      //\n      // const mp3Data = mp3Encoder.encode(rawData);\n      // await this.fs.write(\n      //     `/music/${name.replace(\".wav\", \".mp3\")}`,\n      //     mp3Data,\n      // );\n\n      this.logger.info(`Finished converting song ${name}`);\n    }\n  }\n\n  private async parseVideos(annoRoot: JSZip) {\n    await this.fs.mkdir(\"/videos\");\n\n    if (!this.hasFolderCaseInsensitive(annoRoot, \"VIDEOSMK\")) {\n      this.logger.warn(\"No video files found.\");\n      return;\n    }\n\n    const smkParser = new SMKParser();\n\n    const videos = await this.findFilesInZip(annoRoot, \"VIDEOSMK\", \".smk\");\n    for (const video of videos) {\n      const name = video.path.substr(1);\n      this.logger.info(`Converting video ${name}`);\n\n      const videoData = await video.file.async(\"uint8array\");\n      const result = await smkParser.parse(videoData);\n\n      await this.fs.write(`/videos/${name.replace(\".smk\", \".mp4\")}`, result);\n      this.logger.info(`Finished converting video ${name}`);\n    }\n  }\n\n  private async copyIslands(annoRoot: JSZip) {\n    return Promise.all(\n      [\n        [\"NOKLIMA\", \"/islands/noklima\"],\n        [\"NORD\", \"/islands/north\"],\n        [\"NORDNAT\", \"/islands/northnat\"],\n        [\"SUED\", \"/islands/south\"],\n        [\"SUEDNAT\", \"/islands/southnat\"]\n      ].map(r => {\n        return this.copyFolderFromZip(annoRoot, r[0], r[1], \".scp\");\n      })\n    );\n  }\n\n  private async copySaves(annoRoot: JSZip) {\n    await this.copyFolderFromZip(annoRoot, \"SAVEGAME\", \"/saves\", \".gam\");\n  }\n\n  private async copyMissions(annoRoot: JSZip, customMissionPath: string) {\n    await this.copyFolderFromZip(\n      annoRoot,\n      \"Szenes\",\n      \"/missions-original\",\n      \".szm|.szs|.hss\"\n    );\n    await this.copyFolderFromZip(\n      annoRoot,\n      customMissionPath,\n      \"/missions-custom\",\n      \".szm|.szs|.hss\"\n    );\n  }\n\n  private async copyFolderFromZip(\n    zip: JSZip,\n    inPath: string,\n    outPath: string,\n    fileExtensions: string,\n    makeLowerCase: boolean = true\n  ) {\n    inPath = `${inPath}/`;\n    this.logger.info(\n      `Copying '${fileExtensions}' files from '${inPath}' to '${outPath}'.`\n    );\n\n    const files = this.findFilesInZip(zip, inPath, fileExtensions);\n\n    await this.fs.mkdir(outPath);\n\n    for (const fileAndPath of files) {\n      const relativePath = makeLowerCase\n        ? fileAndPath.path.toLowerCase()\n        : fileAndPath.path;\n      const file = fileAndPath.file;\n\n      const targetPath = `${outPath}/${relativePath}`;\n      this.logger.info(`Copying '${relativePath}' to '${targetPath}'.`);\n      await this.fs.write(targetPath, await file.async(\"blob\"));\n    }\n  }\n\n  private findFilesInZip(zip: JSZip, inPath: string, fileExtensions: string) {\n    const files: Array<{ path: string; file: JSZipObject }> = [];\n    zip.forEach((relativePath, file) => {\n      if (relativePath.startsWith(inPath)) {\n        for (const fileExtension of fileExtensions.split(\"|\")) {\n          if (\n            relativePath.toLowerCase().endsWith(fileExtension.toLowerCase())\n          ) {\n            relativePath = relativePath.substring(inPath.length);\n            relativePath = relativePath.substring(\n              0,\n              relativePath.length - fileExtension.length\n            );\n            relativePath += fileExtension;\n            files.push({\n              path: relativePath,\n              file: file\n            });\n            break;\n          }\n        }\n      }\n    });\n    return files;\n  }\n\n  private findFileCaseInsensitive(zip: JSZip, path: string): JSZip.JSZipObject {\n    const caseInsensitiveFileName = new RegExp(escapeStringRegexp(path), \"i\");\n    const file = zip.file(caseInsensitiveFileName)[0];\n    if (file === undefined) {\n      throw new Error(`Could not find file ${path}.`);\n    }\n\n    return file;\n  }\n\n  private hasFolderCaseInsensitive(zip: JSZip, path: string): boolean {\n    const caseInsensitiveFolderName = new RegExp(escapeStringRegexp(path), \"i\");\n    return zip.folder(caseInsensitiveFolderName)[0] !== undefined;\n  }\n}\n","import * as PIXI from \"pixi.js\";\nimport FileSystem from \"../filesystem\";\nimport { uInt8ToBase64 } from \"../util/util\";\n\nexport default class FontLoader {\n  constructor(private readonly fs: FileSystem) {}\n\n  public async load() {\n    const fonts: { [name: string]: { size: number } } = {\n      ZEI20V: { size: 24 }\n    };\n    for (const fontName of Object.keys(fonts)) {\n      // const size = fonts[fontName].size;\n      console.log(`Loading font ${fontName}.`);\n      const font = await this.fs.openAndGetContentAsUint8Array(\n        `/fonts/${fontName}/font.xml`\n      );\n      await new Promise(resolve => {\n        PIXI.loader\n          .add(fontName, `data:application/xml;base64,${uInt8ToBase64(font)}`)\n          .load(resolve);\n      });\n      console.log(`Finished loading font ${fontName}.`);\n    }\n  }\n}\n","import * as PIXI from \"pixi.js\";\nimport FileSystem from \"../filesystem\";\nimport SpriteLoader from \"../sprite-loader\";\nimport ConfigLoader from \"./config-loader\";\nimport { default as FieldX } from \"./field-type\";\nimport Field from \"./world/field\";\nimport { Island } from \"./world/island\";\n\nexport type WorldLayer = \"land\" | \"building\";\n\nexport interface SpriteWithPositionAndLayer {\n  sprite: PIXI.Sprite;\n  position: PIXI.Point;\n  layer: WorldLayer;\n}\n\nexport default class IslandSpriteLoader {\n  private inited = false;\n\n  private fields: ReadonlyMap<number, FieldX> = new Map();\n\n  private textures: Map<number, PIXI.Texture> = new Map();\n\n  constructor(\n    private readonly fs: FileSystem,\n    private readonly configLoader: ConfigLoader,\n    private readonly spriteLoader: SpriteLoader\n  ) {}\n\n  public async getIslandSprites(islands: Island[]) {\n    if (!this.inited) {\n      this.textures = await this.spriteLoader.getTextures(\"STADTFLD\");\n      this.fields = this.configLoader.getFieldData();\n      this.inited = true;\n    }\n\n    const sprites: SpriteWithPositionAndLayer[] = [];\n\n    islands.forEach(island => {\n      for (let x = 0; x < island.size.x; x++) {\n        for (let y = 0; y < island.size.y; y++) {\n          this.handleField(\n            island.baseFields[x][y],\n            island,\n            x,\n            y,\n            sprites,\n            \"land\"\n          );\n        }\n      }\n      for (let x = 0; x < island.size.x; x++) {\n        for (let y = 0; y < island.size.y; y++) {\n          this.handleField(\n            island.topFields[x][y],\n            island,\n            x,\n            y,\n            sprites,\n            \"building\"\n          );\n        }\n      }\n    });\n    return sprites;\n  }\n\n  private handleField(\n    field: Field | null,\n    island: Island,\n    x: number,\n    y: number,\n    sprites: SpriteWithPositionAndLayer[],\n    layer: WorldLayer\n  ) {\n    if (field === null) {\n      return;\n    }\n    const fieldConfig = this.fields.get(field.fieldId);\n    if (fieldConfig === undefined) {\n      throw new Error(`Could not load config for ${field.fieldId}.`);\n    }\n    const origin = new PIXI.Point(island.position.x + x, island.position.y + y);\n\n    const newSprites = fieldConfig.getSprites(\n      origin,\n      field.rotation,\n      field.ani,\n      this.textures,\n      layer\n    );\n    sprites.push(...newSprites);\n  }\n}\n","import Stream from \"./parsers/stream\";\nimport { uInt8ToBase64 } from \"./util/util\";\n\nconst Filer = require(\"filer.js\");\n\nexport default class FileSystem {\n  private filer: any;\n  constructor() {\n    this.filer = new Filer();\n  }\n\n  public root() {\n    return this.filer.fs.root;\n  }\n\n  public async init(size: number) {\n    return new Promise((resolve, reject) =>\n      this.filer.init(\n        {\n          persistent: true,\n          size: size\n        },\n        resolve,\n        reject\n      )\n    );\n  }\n\n  public async create(filename: string | WebKitEntry) {\n    return new Promise((resolve, reject) =>\n      this.filer.create(filename, false, resolve, reject)\n    );\n  }\n\n  public async mkdir(foldername: string | WebKitEntry) {\n    return new Promise((resolve, reject) =>\n      this.filer.mkdir(foldername, false, resolve, reject)\n    );\n  }\n\n  public async ls(\n    directory: string | WebKitEntry,\n    filterByExtensions?: string\n  ): Promise<WebKitEntry[]> {\n    const entries = await (new Promise((resolve, reject) => {\n      this.filer.ls(directory, resolve, reject);\n    }) as Promise<WebKitEntry[]>);\n\n    if (!filterByExtensions) {\n      return entries;\n    }\n\n    const extensions = filterByExtensions.split(\"|\");\n    return entries.filter((entry: WebKitEntry) => {\n      return (\n        entry.isFile &&\n        extensions.some(extension => entry.name.endsWith(extension))\n      );\n    });\n  }\n\n  public async exists(entryOrPath: string | WebKitEntry) {\n    let path: string;\n    if ((entryOrPath as WebKitEntry).fullPath) {\n      path = (entryOrPath as WebKitEntry).fullPath;\n    } else {\n      path = entryOrPath as string;\n    }\n    if (!path.startsWith(\"/\")) {\n      throw new Error(\n        `exists() only works with absolute paths, \"${path}\" given.`\n      );\n    }\n    const parts = path.split(\"/\").filter(part => part !== \"\");\n    path = \"\";\n    for (const part of parts) {\n      path += \"/\";\n      const entries = await this.ls(path);\n      path += part;\n      if (entries.find(entry => entry.fullPath === path) === undefined) {\n        return false;\n      }\n    }\n    return true;\n  }\n\n  public async open(entryOrPath: string | WebKitEntry): Promise<File> {\n    return new Promise((resolve, reject) =>\n      this.filer.open(entryOrPath, resolve, reject)\n    ) as Promise<File>;\n  }\n\n  public async openAndGetContentAsText(entryOrPath: string | WebKitEntry) {\n    return this.getTextContentFromFile(await this.open(entryOrPath));\n  }\n\n  public async openAndGetContentAsStream(\n    entryOrPath: string | WebKitEntry\n  ): Promise<Stream> {\n    return new Stream(\n      await this.getUint8ContentFromFile(await this.open(entryOrPath))\n    );\n  }\n\n  public async openAndGetContentAsUint8Array(\n    entryOrPath: string | WebKitEntry\n  ): Promise<Uint8Array> {\n    return this.getUint8ContentFromFile(await this.open(entryOrPath));\n  }\n\n  public async getTextContentFromFile(file: File): Promise<string> {\n    return new Promise<string>((resolve, reject) => {\n      const fileReader = new FileReader();\n      fileReader.onload = event => {\n        if (event.target !== null) {\n          resolve(event.target.result);\n        } else {\n          reject();\n        }\n      };\n      fileReader.onerror = event => {\n        reject();\n      };\n      fileReader.readAsText(file);\n    });\n  }\n\n  public async getUint8ContentFromFile(file: File): Promise<Uint8Array> {\n    return new Promise<Uint8Array>((resolve, reject) => {\n      const fileReader = new FileReader();\n      fileReader.onload = event => {\n        if (event.target !== null) {\n          resolve(new Uint8Array(event.target.result));\n        } else {\n          reject();\n        }\n      };\n      fileReader.onerror = event => {\n        reject();\n      };\n      fileReader.readAsArrayBuffer(file);\n    });\n  }\n\n  public async df() {\n    return new Promise((resolve, reject) => {\n      this.filer.df(\n        (used: number, free: number, cap: number) =>\n          resolve({ used: used, free: free, cap: cap }),\n        reject\n      );\n    });\n  }\n\n  public async write(pathOrEntry: string | WebKitEntry, content: any) {\n    return new Promise((resolve, reject) =>\n      this.filer.write(pathOrEntry, { data: content }, resolve, reject)\n    );\n  }\n\n  public async rm(pathOrEntry: string | WebKitEntry) {\n    return new Promise((resolve, reject) =>\n      this.filer.rm(pathOrEntry, resolve, reject)\n    );\n  }\n\n  public async rmRoot() {\n    const entries = await this.ls(\"/\");\n    return Promise.all(entries.map(entry => this.rm(entry)));\n  }\n\n  public async download(pathOrEntry: string | WebKitEntry) {\n    let files;\n    try {\n      files = await this.ls(pathOrEntry);\n    } catch (e) {\n      return this.downloadFile(pathOrEntry);\n    }\n    return this.downloadDirectory(files);\n  }\n\n  private async downloadFile(pathOrEntry: string | WebKitEntry) {\n    const fileName =\n      typeof pathOrEntry === \"string\" ? pathOrEntry : pathOrEntry.fullPath;\n\n    const content = await this.openAndGetContentAsUint8Array(pathOrEntry);\n    const element = document.createElement(\"a\");\n    element.setAttribute(\n      \"href\",\n      `data:application/json;base64,${uInt8ToBase64(content)}`\n    );\n    element.setAttribute(\"download\", fileName);\n    element.style.display = \"none\";\n    document.body.appendChild(element);\n    element.click();\n    document.body.removeChild(element);\n  }\n\n  private async downloadDirectory(files: WebKitEntry[]) {\n    for (const file of files) {\n      await this.download(file);\n    }\n  }\n}\n","import \"pixi-sound\";\nimport * as PIXI from \"pixi.js\";\nimport FileSystem from \"../filesystem\";\n\nexport default class MusicPlayer {\n  private playing = false;\n  private readonly songs: Array<{ name: string; sound: PIXI.sound.Sound }> = [];\n  private currentSongIdx: number;\n\n  constructor(private readonly fs: FileSystem) {}\n\n  public async load() {\n    const files = await this.fs.ls(\"/music\");\n    for (const file of files) {\n      console.log(`Loading music ${file.name}`);\n      const data = (await this.fs.openAndGetContentAsUint8Array(file))\n        .buffer as ArrayBuffer;\n      this.songs.push({ name: file.name, sound: await this.loadSound(data) });\n      console.log(`Finished loading music ${file.name}`);\n    }\n  }\n\n  public play(name: string, loop: boolean = false) {\n    const song = this.songs.find(each => each.name === name + \".wav\");\n    if (song === undefined) {\n      console.warn(`Song ${name} not found.`);\n      return;\n    }\n    if (!song.sound.isPlaying) {\n      song.sound.play({ loop: loop });\n    }\n  }\n\n  public playAll() {\n    if (this.songs.length === 0) {\n      console.warn(\"No music to play found :(\");\n      return;\n    }\n    if (this.playing) {\n      console.warn(\"Music is already playing!\");\n      return;\n    }\n    this.stop();\n\n    this.playing = true;\n    this.currentSongIdx = -1;\n    this.playNext();\n  }\n\n  public stop() {\n    this.songs.forEach(song => song.sound.stop());\n  }\n\n  private playNext() {\n    this.currentSongIdx++;\n    if (this.currentSongIdx === this.songs.length) {\n      this.currentSongIdx = 0;\n    }\n    this.songs[this.currentSongIdx].sound.play(this.playNext.bind(this));\n  }\n\n  private loadSound(data: ArrayBuffer, preload: boolean = false) {\n    return new Promise<PIXI.sound.Sound>((resolve, reject) => {\n      const sound = PIXI.sound.Sound.from({\n        source: data,\n        preload: preload,\n        singleInstance: true,\n        loaded: (err: Error, preloadedSound: PIXI.sound.Sound) => {\n          if (preload) {\n            if (err) {\n              reject(err);\n            } else {\n              resolve(preloadedSound);\n            }\n          }\n        }\n      });\n      if (!preload) {\n        resolve(sound);\n      }\n    });\n  }\n}\n","import * as PIXI from \"pixi.js\";\nimport FileSystem from \"../../filesystem\";\nimport GAMParser from \"../../parsers/GAM/gam-parser\";\nimport BitmapText = PIXI.extras.BitmapText;\nimport Sprite = PIXI.Sprite;\nimport t from \"../../translation/translator\";\nimport assert from \"../../util/assert\";\nimport MenuStructure, { ScreenConfig } from \"../menu-structure\";\n\nexport default class Missions implements ScreenConfig {\n  public buttons = [\n    this.renderNewGame.bind(this),\n    this.renderLoadGame.bind(this),\n    async () => {\n      await this.menuStructure.renderScreen(\"menu_loading\");\n      this.menuStructure.emit(\"load-game\", \"/saves/lastgame.gam\");\n    },\n    async () => this.menuStructure.renderScreen(\"menu_main\"),\n    async (stage: PIXI.Container) => {\n      this.currentPage = Math.max(0, this.currentPage - 1);\n      await this.renderNewGame(stage);\n    },\n    async (stage: PIXI.Container) => {\n      this.currentPage = Math.min(\n        Math.ceil(this.newGameLines.length / this.ROWS) - 1,\n        this.currentPage + 1\n      );\n      await this.renderNewGame(stage);\n    }\n  ];\n\n  private readonly ROWS = 14;\n\n  private readonly SCROLL_UP = \"menu-31011\";\n  private readonly SCROLL_DOWN = \"menu-31012\";\n\n  private newGameLines: Array<{\n    name: string;\n    difficulty?: number;\n    file?: WebKitFileEntry;\n  }> = [];\n\n  private currentPage = 0;\n  private gamParser: GAMParser;\n\n  constructor(\n    private readonly fs: FileSystem,\n    private readonly menuStructure: MenuStructure\n  ) {\n    this.gamParser = new GAMParser(null);\n  }\n\n  public async onLoad(stage: PIXI.Container) {\n    await this.getNewGameLines();\n\n    await this.renderNewGame(stage);\n    await this.menuStructure._playMainMenuMusic();\n  }\n\n  public async renderNewGame(stage: PIXI.Container) {\n    const currentTopItem = this.currentPage * this.ROWS;\n\n    for (let i = 0; i < this.ROWS; i++) {\n      const bitmapText = stage.getChildByName(\n        `menu-${31021 + i}`\n      ) as BitmapText;\n\n      bitmapText.off(\"click\");\n      bitmapText.visible = false;\n      bitmapText.interactive = false;\n      bitmapText.buttonMode = false;\n\n      if (i + currentTopItem < this.newGameLines.length) {\n        const line = this.newGameLines[i + currentTopItem];\n        bitmapText.text = line.name;\n        bitmapText.visible = true;\n        if (line.file) {\n          bitmapText.interactive = true;\n          bitmapText.buttonMode = true;\n          bitmapText.once(\"click\", async () => {\n            await this.menuStructure.renderScreen(\"menu_loading\");\n            this.menuStructure.emit(\"load-game\", line.file.fullPath);\n          });\n        }\n      }\n    }\n    for (let i = 0; i < this.ROWS; i++) {\n      const sprite = stage.getChildByName(`menu-${31041 + i}`) as Sprite;\n      sprite.visible =\n        i + currentTopItem < this.newGameLines.length &&\n        !!this.newGameLines[i + currentTopItem].file;\n    }\n    for (let i = 0; i < this.ROWS; i++) {\n      const sprite = stage.getChildByName(`menu-${31061 + i}`) as Sprite;\n      sprite.visible = false;\n    }\n\n    stage.getChildByName(this.SCROLL_UP).visible = true;\n    stage.getChildByName(this.SCROLL_DOWN).visible = true;\n  }\n\n  public async renderLoadGame(stage: PIXI.Container) {\n    const saves = (await this.fs.ls(\"/saves\", \".gam\")).filter(\n      save => save.name !== \"lastgame.gam\"\n    );\n\n    const maxSaveGames = 12;\n    for (let i = 0; i < this.ROWS; i++) {\n      const bitmapText = stage.getChildByName(\n        `menu-${31021 + i}`\n      ) as BitmapText;\n      bitmapText.visible = i < maxSaveGames;\n      if (i < saves.length) {\n        // TODO: Read name from Game.dat\n        bitmapText.text = `Game${i.toString().padStart(2, \"0\")}`;\n        bitmapText.interactive = true;\n        bitmapText.buttonMode = true;\n        bitmapText.once(\"click\", async () => {\n          await this.menuStructure.renderScreen(\"menu_loading\");\n          this.menuStructure.emit(\"load-game\", saves[i].fullPath);\n        });\n      } else {\n        bitmapText.text = `Empty${i.toString().padStart(2, \"0\")}`;\n      }\n    }\n    for (let i = 0; i < this.ROWS; i++) {\n      const sprite = stage.getChildByName(`menu-${31041 + i}`) as Sprite;\n      sprite.visible = false;\n    }\n    for (let i = 0; i < this.ROWS; i++) {\n      // TODO: Read players (from Game.dat ?)\n      const sprite = stage.getChildByName(`menu-${31061 + i}`) as Sprite;\n      sprite.visible = i < maxSaveGames;\n    }\n\n    stage.getChildByName(this.SCROLL_UP).visible = false;\n    stage.getChildByName(this.SCROLL_DOWN).visible = false;\n  }\n\n  private async getNewGameLines() {\n    const missions = await this.loadMissions();\n\n    this.newGameLines.push({ name: t(\"menu.divider.orginal_missions\") });\n\n    missions.filter(mission => mission.missionNum !== -1).forEach(mission => {\n      this.newGameLines.push({\n        name: mission.name,\n        file: mission.file as WebKitFileEntry\n      });\n    });\n\n    this.newGameLines.push({ name: t(\"menu.divider.missions\") });\n\n    this.newGameLines.push({ name: t(\"menu.divider.new_missions\") });\n\n    missions.filter(mission => mission.missionNum === -1).forEach(mission => {\n      this.newGameLines.push({\n        name: mission.name,\n        file: mission.file as WebKitFileEntry\n      });\n    });\n\n    this.newGameLines.push({ name: t(\"menu.divider.custom_missions\") });\n    const customMissions = await this.fs.ls(\"/missions-custom\", \".szs\");\n    customMissions.forEach(mission => {\n      this.newGameLines.push({\n        name: mission.name.replace(\".szs\", \"\"),\n        file: mission as WebKitFileEntry\n      });\n    });\n  }\n\n  private async loadMissions() {\n    const missions = await Promise.all(\n      (await this.fs.ls(\"/missions-original\", \".szs\")).map(async mission => {\n        const data = await this.fs.openAndGetContentAsStream(mission);\n        const blocks = this.gamParser.parse(data);\n        let ranking = -1; // NOT the number of stars\n        if (blocks.has(\"SZENE_RANKING\")) {\n          assert(blocks.get(\"SZENE_RANKING\").length === 1);\n          ranking = blocks.get(\"SZENE_RANKING\")[0].data.read32();\n        }\n        let campaignNum = -1;\n        if (blocks.has(\"SZENE_KAMPAGNE\")) {\n          assert(blocks.get(\"SZENE_KAMPAGNE\").length === 1);\n          campaignNum = blocks.get(\"SZENE_KAMPAGNE\")[0].data.read32();\n        }\n        // The missionNum denotes which\n        let missionNum = -1;\n        if (blocks.has(\"SZENE_MISSNR\")) {\n          assert(blocks.get(\"SZENE_MISSNR\").length === 1);\n          missionNum = blocks.get(\"SZENE_MISSNR\")[0].data.read32();\n        }\n\n        return {\n          blocks,\n          ranking,\n          campaignNum,\n          missionNum,\n          name: mission.name,\n          file: mission\n        };\n      })\n    );\n    missions.sort((a, b) => {\n      if (a.missionNum !== -1 && b.missionNum === -1) {\n        return -1;\n      } else if (a.missionNum === -1 && b.missionNum !== -1) {\n        return 1;\n      } else if (a.missionNum !== -1 && b.missionNum !== -1) {\n        if (a.missionNum < b.missionNum) {\n          return -1;\n        } else if (a.missionNum > b.missionNum) {\n          return 1;\n        } else {\n          // TODO: Sort missions within mission\n          return 0;\n        }\n      } else {\n        // TODO: Sort otherwise\n        return 0;\n      }\n    });\n\n    console.table(missions);\n\n    return missions;\n  }\n}\n","const UPNG = require(\"upng-js/UPNG.js\");\n\nexport default class BSHImage {\n  public width: number;\n  public height: number;\n  public pixels: Uint8Array;\n\n  constructor(width: number, height: number, pixels: Uint8Array) {\n    this.width = width;\n    this.height = height;\n    this.pixels = pixels;\n  }\n\n  public toPNG(): ArrayBuffer {\n    return UPNG.encode([this.pixels.buffer], this.width, this.height);\n  }\n}\n","import * as Viewport from \"pixi-viewport\";\nimport IslandRenderer, { TILE_HEIGHT, TILE_WIDTH } from \"./island-renderer\";\nimport World from \"./world/world\";\n\nexport default class GameRenderer {\n  public static fieldPosToWorldPos(fieldPos: PIXI.PointLike) {\n    const xx = fieldPos.x;\n    const yy = fieldPos.y;\n    const worldX = (xx - yy) * (TILE_WIDTH / 2);\n    const worldY = (xx + yy) * Math.floor(TILE_HEIGHT / 2);\n    return new PIXI.Point(worldX, worldY);\n  }\n\n  constructor(\n    private world: World,\n    private islandRenderer: IslandRenderer,\n    private viewport: Viewport\n  ) {}\n\n  public async begin(myPlayerId: number) {\n    this.viewport.removeChildren();\n\n    // Render islands\n    await this.islandRenderer.render(this.world.islands);\n\n    // Render ships\n    // ...\n\n    // Render soldiers\n    // ...\n\n    this.moveCameraToStartPosition(myPlayerId);\n  }\n\n  public zoom(zoom: 1 | 2 | 3) {\n    const center = this.viewport.center;\n    this.viewport.scale.set(1.0 / zoom);\n    this.viewport.moveCenter(center.x, center.y);\n  }\n\n  // public onMove(listener: (viewport: Viewport) => void) {\n  //     new Observable<Viewport>((observer) => {\n  //         this.viewport.on(\"moved\", (viewport) => observer.next(viewport));\n  //     }).pipe(\n  //         debounceTime(1000),\n  //     ).subscribe(listener);\n  // }\n\n  private moveCameraToStartPosition(myPlayerId: number) {\n    const myKontor = this.world.kontors.find(\n      kontor => kontor.playerId === myPlayerId\n    );\n    if (myKontor !== undefined) {\n      const position = myKontor.position;\n      const kontorIsland = this.world.islands.find(\n        island => island.id === myKontor.islandId\n      );\n      this.moveTo(\n        new PIXI.Point(\n          kontorIsland.position.x + position.x,\n          kontorIsland.position.y + position.y\n        )\n      );\n      return;\n    }\n    const myShip = this.world.ships.find(ship => ship.playerId === myPlayerId);\n    if (myShip !== undefined) {\n      this.moveTo(myShip.position);\n      return;\n    }\n    this.moveTo(new PIXI.Point(500 / 2, 300 / 2));\n  }\n\n  private moveTo(point: PIXI.Point) {\n    this.viewport.moveCenter(GameRenderer.fieldPosToWorldPos(point));\n  }\n}\n","import * as React from \"react\";\nimport { ChangeEvent } from \"react\";\nimport { UploadLogger } from \"./upload\";\n\ninterface Props {\n  onUploaded: (file: File) => Promise<boolean>;\n  onReset: () => Promise<void>;\n  onSaveOrMissionUploaded: (\n    evt: ChangeEvent<HTMLInputElement>\n  ) => Promise<void>;\n  setLogger: (logger: UploadLogger) => void;\n}\n\ninterface State {\n  isUploading: boolean;\n  messages: Array<{ msg: string; type: \"info\" | \"warn\" | \"error\" }>;\n}\n\nexport default class UploadInfo extends React.Component<Props, State>\n  implements UploadLogger {\n  constructor(props: Props) {\n    super(props);\n\n    this.state = {\n      isUploading: false,\n      messages: []\n    };\n\n    this.props.setLogger(this);\n  }\n\n  public render() {\n    return (\n      <div\n        style={{\n          marginLeft: \"1em\",\n          marginRight: \"1em\",\n          fontFamily: \"Arial\",\n          maxWidth: \"800px\",\n          lineHeight: 1.4\n        }}\n      >\n        <h1>Anno 2018</h1>\n        <p>\n          Welcome to Anno 2018, an effort to port twenty-year-old Anno 1602 to\n          the browser. This is in early development, however, you can already\n          load your savegames and start new games. Much of the actual simulation\n          is still missing though. For copyright reasons, we can't include the\n          original Anno 1602 files and graphics.{\" \"}\n          <strong>\n            You need own your own copy of Anno 1602 for Anno 2018 work.\n          </strong>\n        </p>\n        <p>\n          The following versions have been tested by us and confirmed to work:\n        </p>\n        <ul>\n          <li>German \"Anno 1602 Kngisedition\"</li>\n          <li>English \"Anno 1602 A.D.\" from GOG</li>\n        </ul>\n        <p>\n          Anno 2018 is tested in the latest versions of{\" \"}\n          <strong>Chrome (preferred, faster) and Firefox</strong> only. Other\n          browsers <em>might</em> work, but aren't supported.\n        </p>\n        <p>\n          To get started, follow these steps. You will need to \"upload\" your\n          Anno files on this website. Don't worry though, the files{\" \"}\n          <em>never</em> leave your PC and are only uploaded into your browser.\n          Once uploaded, the files remain in your browser and will be there when\n          you re-open this website.\n        </p>\n        <ol>\n          <li>\n            Find your Anno 1602 files and zip them. If you are using a version\n            of Anno 1602 which came with a physical CD, copy the videosmk and\n            music8 folders into your Anno 1602 root folder before creating the\n            zip file.\n          </li>\n          <li>\n            Use the upload button below to upload the zip file. The file should\n            be around 50MB if it doesn't contain music and videos, and around\n            500MB if it does.\n          </li>\n          <li>\n            <p>\n              Grab a coffee. The upload takes some time. Progress is being\n              logged below. Should anything go wrong, take a look at the error\n              message. It might tell you what to do. If it doesn't, make sure\n              you're using a recent version of Chrome or Firefox. If it is still\n              not working,{\" \"}\n              <a href=\"https://reddit.com/u/cmfcmf\">drop me a note at reddit</a>\n              , <a href=\"https://twitter.com/christianmflach\">twitter</a>, or{\" \"}\n              <a href=\"https://github.com/cmfcmf/Anno2018-js\">\n                create an issue at GitHub\n              </a>\n              . Make sure to include the upload progress output.\n            </p>\n            Upload:{\" \"}\n            <input\n              type={\"file\"}\n              multiple={false}\n              accept={\".zip\"}\n              onChange={this.zipUploaded}\n              disabled={this.state.isUploading}\n            />\n          </li>\n        </ol>\n\n        <h2>\n          Upload Progress <small>(newest at the top)</small>\n        </h2>\n        {this.state.messages.length === 0 && <p>Nothing yet...</p>}\n        <div style={{ fontSize: \"10px\" }}>\n          {this.state.messages.map((message, i) => (\n            <div key={i}>\n              <span\n                style={{\n                  color:\n                    message.type === \"info\"\n                      ? \"blue\"\n                      : message.type === \"warn\"\n                        ? \"orange\"\n                        : \"red\"\n                }}\n              >\n                {message.type.toUpperCase()}\n              </span>\n              : {message.msg}\n            </div>\n          ))}\n        </div>\n\n        <h2>Uploading custom missions and additional savegames</h2>\n        <p>\n          Use this button to upload additional missions or savegames after you\n          uploaded the main game:{\" \"}\n          <input\n            type={\"file\"}\n            multiple={true}\n            accept={\".szm,.szs,.gam\"}\n            onChange={this.props.onSaveOrMissionUploaded}\n          />\n        </p>\n\n        <h2>Resetting files</h2>\n        <p>\n          You can use the \"Reset all files\" button to delete all uploaded files\n          if needed: <button onClick={this.resetFiles}>Reset all files</button>\n        </p>\n      </div>\n    );\n  }\n\n  public readonly info = (msg: string) => {\n    this.log(msg, \"info\");\n  };\n\n  public readonly warn = (msg: string) => {\n    this.log(msg, \"warn\");\n  };\n\n  public readonly error = (msg: string) => {\n    this.log(msg, \"error\");\n  };\n\n  private readonly log = (msg: string, type: \"info\" | \"warn\" | \"error\") => {\n    this.setState((prevState: State) => {\n      return {\n        ...prevState,\n        messages: [{ msg, type }, ...prevState.messages]\n      };\n    });\n  };\n\n  private zipUploaded = async (evt: ChangeEvent<HTMLInputElement>) => {\n    const files = evt.target.files;\n    if (files === null || files.length !== 1) {\n      alert(\"Please select the zipped Anno1602 folder to upload.\");\n      return;\n    }\n    const file = files[0];\n    if (!file.name.endsWith(\".zip\")) {\n      alert(\"You need to upload a .zip file!\");\n      return;\n    }\n\n    this.setState({ isUploading: true });\n    const worked = await this.props.onUploaded(file);\n    this.setState({ isUploading: false });\n\n    if (worked) {\n      this.info(\"Upload finished. Please reload the page.\");\n      alert(\"Upload finished. Please reload the page.\");\n    } else {\n      this.error(\"The upload failed.\");\n      alert(\"The upload failed.\");\n    }\n  };\n\n  private resetFiles = async () => {\n    await this.props.onReset();\n    alert(\"All files deleted. The page will now refresh.\");\n    window.location.reload(true);\n  };\n}\n","/*\n * The savegame data structure was reverse-engineered by Benedikt Freisen\n * as part of the 'mdcii-engine' project and released under GPLv2+.\n * https://github.com/roybaer/mdcii-engine\n */\n\nimport Stream from \"../../parsers/stream\";\nimport Good from \"./good\";\n\nexport type Kontor = ReturnType<typeof kontorFromSaveGame>;\n\nexport function kontorFromSaveGame(data: Stream) {\n  const islandId = data.read8();\n  const position = new PIXI.Point(data.read8(), data.read8());\n  const playerId = data.read8();\n  const goods = parseGoods(data);\n\n  return {\n    islandId,\n    position,\n    playerId,\n    goods\n  };\n}\n\nfunction parseGoods(data: Stream) {\n  const goods = [];\n  for (let i = 0; i < 2; i++) {\n    Good.fromSaveGame(data);\n  }\n  for (let i = 2; i < 2 + 23; i++) {\n    goods.push(Good.fromSaveGame(data));\n  }\n  for (let i = 2 + 23; i < 50; i++) {\n    Good.fromSaveGame(data);\n  }\n  return goods;\n}\n","/*\n * The savegame data structure was reverse-engineered by Benedikt Freisen\n * as part of the 'mdcii-engine' project and released under GPLv2+.\n * https://github.com/roybaer/mdcii-engine\n */\n\nimport Stream from \"../../parsers/stream\";\n\nexport enum ContractState {\n  Inactive = 0,\n  OfferedByMe = 1,\n  OfferedByOther = 2,\n  Active = 3\n}\n\nexport default class Contract {\n  public static fromSaveGame(data: Stream) {\n    const state = data.read32();\n    const time = data.read32(); // unsure\n\n    return new Contract(state, time);\n  }\n\n  constructor(\n    public readonly state: ContractState,\n    public readonly time: number\n  ) {}\n}\n","/*\n * The savegame data structure was reverse-engineered by Benedikt Freisen\n * as part of the 'mdcii-engine' project and released under GPLv2+.\n * https://github.com/roybaer/mdcii-engine\n */\n\nimport Stream from \"../../parsers/stream\";\nimport { SoldierType } from \"./soldier\";\n\nclass Unit {\n  public static fromSaveGame(data: Stream) {\n    const type: SoldierType = data.read8();\n    const flags = data.read8();\n    data.read16();\n    const hp = data.read16();\n    data.read16();\n\n    return new Unit(type, (flags & 0x10) !== 0, hp);\n  }\n\n  constructor(\n    public type: SoldierType,\n    public ready: boolean,\n    public hp: number\n  ) {}\n}\n\nexport type Castle = ReturnType<typeof castleFromSaveGame>;\n\nexport function castleFromSaveGame(data: Stream) {\n  const islandId = data.read8();\n  const position = new PIXI.Point(data.read8(), data.read8());\n  data.read8();\n  data.read32();\n  const numSwords = data.read16();\n  const numMuscets = data.read16();\n  const numCanons = data.read16();\n  data.read16();\n  const units = parseUnits(data);\n  data.read(32);\n\n  return {\n    islandId,\n    position,\n    numSwords,\n    numMuscets,\n    numCanons,\n    units\n  };\n}\n\nfunction parseUnits(data: Stream) {\n  const units = [];\n  for (let i = 0; i < 8; i++) {\n    units.push(Unit.fromSaveGame(data));\n  }\n  return units;\n}\n","/**\n * This code is based on the bin-packing library by Jake Gordon licensed under MIT license.\n *\n * https://github.com/jakesgordon/bin-packing/blob/master/js/packer.js\n */\n\n/******************************************************************************\n This is a very simple binary tree based bin packing algorithm that is initialized\n with a fixed width and height and will fit each block into the first node where\n it fits and then split that node into 2 parts (down and right) to track the\n remaining whitespace.\n Best results occur when the input blocks are sorted by height, or even better\n when sorted by max(width,height).\n Inputs:\n ------\n w:       width of target rectangle\n h:      height of target rectangle\n blocks: array of any objects that have .w and .h attributes\n Outputs:\n -------\n marks each block that fits with a .fit attribute pointing to a\n node with .x and .y coordinates\n Example:\n -------\n var blocks = [\n { w: 100, h: 100 },\n { w: 100, h: 100 },\n { w:  80, h:  80 },\n { w:  80, h:  80 },\n etc\n etc\n ];\n var packer = new Packer(500, 500);\n packer.fit(blocks);\n for(var n = 0 ; n < blocks.length ; n++) {\n    var block = blocks[n];\n    if (block.fit) {\n      Draw(block.fit.x, block.fit.y, block.w, block.h);\n    }\n  }\n ******************************************************************************/\n\ninterface Rect {\n  w: number;\n  h: number;\n  fit?: Node;\n}\n\ninterface Node {\n  x: number;\n  y: number;\n  w: number;\n  h: number;\n  used?: boolean;\n  down?: Node;\n  right?: Node;\n}\n\nexport default class BinPacker {\n  private readonly root: Node;\n\n  constructor(w: number, h: number) {\n    this.root = { x: 0, y: 0, w: w, h: h };\n  }\n\n  public addBlock(block: Rect) {\n    const node = this.findNode(this.root, block.w, block.h);\n    if (node) {\n      return this.splitNode(node, block.w, block.h);\n    } else {\n      return false;\n    }\n  }\n\n  private findNode(root: Node, w: number, h: number): Node | null {\n    if (root.used) {\n      return this.findNode(root.right, w, h) || this.findNode(root.down, w, h);\n    } else if (w <= root.w && h <= root.h) {\n      return root;\n    } else {\n      return null;\n    }\n  }\n\n  private splitNode(node: Node, w: number, h: number) {\n    node.used = true;\n    node.down = { x: node.x, y: node.y + h, w: node.w, h: node.h - h };\n    node.right = { x: node.x + w, y: node.y, w: node.w - w, h: h };\n    return node;\n  }\n}\n","import * as log from \"loglevel\";\nimport assert from \"../../util/assert\";\n\nexport default class DATParser {\n  private log: log.Logger;\n\n  private variables: Map<string, any>;\n  private objects: any;\n  private template: object;\n  private gfxMap: Map<string, string>;\n\n  private lastGfxName: string;\n  private currentObject: string;\n  private currentNestedObject: string;\n  private currentItem: string;\n  private currentNestedItem: number;\n\n  constructor() {\n    this.log = log.getLogger(\"dat-parser\");\n  }\n\n  public parse(content: string) {\n    this.variables = new Map();\n    this.objects = {};\n    this.template = null;\n    this.gfxMap = new Map();\n    this.lastGfxName = null;\n    this.currentObject = null;\n    this.currentNestedObject = null;\n    this.currentItem = null;\n    this.currentNestedItem = 0;\n\n    for (let line of content.split(\"\\n\")) {\n      line = line.split(\";\")[0].trim();\n      if (line.length === 0) {\n        continue;\n      }\n\n      if (\n        line.startsWith(\"Nahrung:\") ||\n        line.startsWith(\"Soldat:\") ||\n        line.startsWith(\"Turm:\") ||\n        line.startsWith(\"Include:\")\n      ) {\n        // TODO: Skipped for now.\n        continue;\n      }\n\n      let result;\n\n      if ((result = line.match(/^(@?)(\\w+)\\s*=\\s*((?:\\d+|\\+|\\w+)+)$/))) {\n        this.handleConstantAssignment(result);\n        continue;\n      }\n\n      if ((result = line.match(/^ObjFill:\\s*([\\w,]+)$/))) {\n        this.handleObjFill(result);\n        continue;\n      }\n\n      if ((result = line.match(/^Objekt:\\s*(\\w+)$/))) {\n        this.handleNestedObjectBegin(result);\n        continue;\n      }\n\n      if (line === \"EndObj\") {\n        this.handleNestedObjectEnd();\n        continue;\n      }\n\n      if ((result = line.match(/^(@?)(\\w+):\\s*(.*?)\\s*$/))) {\n        this.handleProperty(result);\n        continue;\n      }\n\n      throw new Error(\"Could not parse: \" + line);\n    }\n\n    return {\n      variables: this.mapToObject(this.variables),\n      objects: this.objects,\n      gfx_category_map: this.mapToObject(this.gfxMap)\n    };\n  }\n\n  private handleObjFill(result: RegExpMatchArray) {\n    assert(this.currentObject != null);\n    assert(this.currentItem != null);\n\n    const fill = result[1];\n    const item = this.objects[this.currentObject].items[this.currentItem];\n    if (fill.startsWith(\"0,MAX\")) {\n      assert(this.template === null);\n      this.template = item;\n    } else {\n      assert(item.hasOwnProperty(\"nested_objects\"));\n\n      const baseItemNum = this.getValue(null, fill, false);\n      const baseItem = this.objects[this.currentObject].items[baseItemNum];\n      this.objects[this.currentObject].items[this.currentItem] = this.deepCopy(\n        baseItem\n      );\n\n      if (this.lastGfxName != null) {\n        item.GfxCategory = this.lastGfxName;\n      }\n    }\n  }\n\n  private handleConstantAssignment(result: RegExpMatchArray) {\n    const isMath = result[1].length > 0;\n    const constant = result[2];\n    const value = result[3];\n\n    if (constant.startsWith(\"GFX\")) {\n      if (value === \"0\") {\n        this.gfxMap.set(constant, constant);\n      } else if (value.startsWith(\"GFX\")) {\n        const currentGfx = value.split(\"+\")[0];\n        if (this.gfxMap.has(currentGfx)) {\n          this.gfxMap.set(constant, this.gfxMap.get(currentGfx));\n        }\n      }\n    }\n\n    this.variables.set(constant, this.getValue(constant, value, isMath));\n  }\n\n  private handleNestedObjectBegin(result: RegExpMatchArray) {\n    const objectName = result[1];\n    if (this.currentObject === null) {\n      this.currentObject = objectName;\n      this.objects[objectName] = {\n        items: {}\n      };\n    } else if (this.currentNestedObject === null) {\n      assert(this.currentItem !== null);\n      this.currentNestedObject = objectName;\n      this.currentNestedItem = 0;\n      const item = this.objects[this.currentObject].items[this.currentItem];\n      if (\n        item.nested_objects[this.currentNestedObject] === undefined ||\n        item.nested_objects[this.currentNestedObject][\n          this.currentNestedItem\n        ] === undefined\n      ) {\n        item.nested_objects[this.currentNestedObject] = {\n          [this.currentNestedItem]: {}\n        };\n      }\n    } else {\n      throw new Error(\n        \"It appears like there is more than one nesting level. \" +\n          \"This is not supported by this parser.\"\n      );\n    }\n  }\n\n  private handleNestedObjectEnd() {\n    if (this.currentNestedObject !== null) {\n      this.currentNestedObject = null;\n      this.currentNestedItem = null;\n    } else if (this.currentObject !== null) {\n      this.currentObject = null;\n      this.currentItem = null;\n    } else {\n      throw new Error(\"Received EndObj without current object!\");\n    }\n  }\n\n  private handleProperty(result: RegExpMatchArray) {\n    const isMath = result[1].length > 0;\n    const key = result[2];\n    const valueAsString = result[3];\n\n    const value = this.deepCopy(this.getValue(key, valueAsString, isMath));\n    this.variables.set(key, value);\n\n    if (key === \"Nummer\") {\n      if (this.currentNestedObject === null) {\n        this.currentItem = value;\n\n        this.objects[this.currentObject].items[this.currentItem] = {\n          nested_objects: {}\n        };\n        if (this.template !== null) {\n          const tmp = this.deepCopy(this.template);\n          this.objects[this.currentObject].items[\n            this.currentItem\n          ] = this.deepMerge(\n            tmp,\n            this.objects[this.currentObject].items[this.currentItem]\n          );\n        }\n      } else {\n        this.currentNestedItem = value;\n        this.objects[this.currentObject].items[this.currentItem].nested_objects[\n          this.currentNestedObject\n        ][this.currentNestedItem] = {};\n      }\n\n      return;\n    }\n    const item = this.objects[this.currentObject].items[this.currentItem];\n\n    if (key === \"Gfx\" && valueAsString.startsWith(\"GFX\")) {\n      this.lastGfxName = valueAsString.split(\"+\")[0];\n    }\n\n    if (this.currentNestedObject == null) {\n      item[key] = value;\n      if (this.lastGfxName != null) {\n        item.GfxCategory = this.lastGfxName;\n        item.GfxCategoryMapped = this.gfxMap.get(this.lastGfxName);\n      }\n    } else {\n      const nestedItem =\n        item.nested_objects[this.currentNestedObject][this.currentNestedItem];\n      if (\n        Object.keys(nestedItem).includes(key) &&\n        this.isObject(nestedItem[key])\n      ) {\n        nestedItem[key] = this.deepMerge(nestedItem[key], value);\n      } else {\n        nestedItem[key] = value;\n      }\n    }\n  }\n\n  private getValue(\n    key: string,\n    value: string,\n    isMath: boolean,\n    arrayElement: number = -1\n  ): any {\n    let result;\n    if (isMath) {\n      if ((result = value.match(/^([+\\-])(\\d+)$/))) {\n        let oldVal = this.variables.has(key)\n          ? this.deepCopy(this.variables.get(key))\n          : null;\n        if (oldVal.toString() === \"RUINE_KONTOR_1\") {\n          // TODO\n          oldVal = 424242;\n        }\n\n        if (arrayElement > -1) {\n          if (key === \"Size\") {\n            oldVal = oldVal[arrayElement === 0 ? \"x\" : \"y\"];\n          } else {\n            oldVal = oldVal[arrayElement];\n          }\n        }\n\n        if (result[1] === \"+\") {\n          return oldVal + parseInt(result[2], 10);\n        }\n        if (result[1] === \"-\") {\n          return oldVal - parseInt(result[2], 10);\n        }\n\n        throw new Error(\"This code should not be reached.\");\n      }\n    }\n\n    if (value.match(/^[\\-+]?\\d+$/)) {\n      return parseInt(value, 10);\n    }\n    if (value.match(/^[\\-+]?\\d+\\.\\d+$/)) {\n      return parseFloat(value);\n    }\n    if ((result = value.match(/^([A-Za-z0-9_]+)(?:\\[(\\d+)])?$/))) {\n      const name = result[1];\n      const arrayIdx = result[2];\n      // TODO: When is value not in variables\n      const res = this.variables.has(name)\n        ? this.deepCopy(this.variables.get(name))\n        : name;\n      if (arrayIdx !== undefined) {\n        return res[arrayIdx];\n      }\n      return res;\n    }\n    if (value.indexOf(\",\") !== -1) {\n      const values = value\n        .split(\",\")\n        .map((v, index) => this.getValue(key, v.trim(), isMath, index));\n\n      if (key === \"Size\") {\n        return {\n          x: values[0],\n          y: values[1]\n        };\n      } else if (key === \"Ware\") {\n        const obj: any = {};\n        obj[values[0]] = values[1];\n        return obj;\n      } else {\n        return values;\n      }\n    }\n    if (\n      (result = value.match(\n        /^([A-z]+(?:\\[\\d+])?|\\d+)([+\\-])([A-z]+(?:\\[\\d+])?|\\d+)$/\n      ))\n    ) {\n      const op = result[2];\n      const val1 = this.getValue(key, result[1], false);\n      const val2 = this.getValue(key, result[3], false);\n      return op === \"+\" ? val1 + val2 : val1 - val2;\n    }\n\n    throw new Error(\"This code should not be reached.\");\n  }\n\n  private deepCopy(data: any): any {\n    return JSON.parse(JSON.stringify(data));\n  }\n\n  private isObject(item: any) {\n    return item && typeof item === \"object\" && !Array.isArray(item);\n  }\n\n  /**\n   * Deep-Merge two objects.\n   *\n   * Based on code written by CplLL, which was based on code by Salakar.\n   *\n   * https://stackoverflow.com/a/37164538\n   */\n  private deepMerge(target: any, patch: any) {\n    const output = { ...target };\n    if (this.isObject(target) && this.isObject(patch)) {\n      Object.keys(patch).forEach(key => {\n        if (this.isObject(patch[key])) {\n          if (!(key in target)) {\n            Object.assign(output, { [key]: patch[key] });\n          } else {\n            output[key] = this.deepMerge(target[key], patch[key]);\n          }\n        } else {\n          Object.assign(output, { [key]: patch[key] });\n        }\n      });\n    }\n    return output;\n  }\n\n  private mapToObject<K, V>(map: Map<K, V>): object {\n    const obj: any = {};\n    map.forEach((value: V, key: K) => (obj[key] = value));\n    return obj;\n  }\n}\n","import \"pixi-keyboard\";\nimport * as PIXI from \"pixi.js\";\nimport { Action, combineReducers, createStore, Store } from \"redux\";\nimport { composeWithDevTools } from \"redux-devtools-extension\";\nimport watch from \"redux-watch\";\nimport { Observable } from \"rxjs/internal/Observable\";\nimport { filter } from \"rxjs/operators\";\nimport assert from \"../util/assert\";\nimport ConfigLoader from \"./config-loader\";\nimport GameRenderer from \"./game-renderer\";\nimport Keys = PIXI.keyboard.Keys;\nimport { City } from \"./world/city\";\nimport { Island } from \"./world/island\";\nimport { Kontor } from \"./world/kontor\";\nimport { Player } from \"./world/player\";\nimport { Producer } from \"./world/producer\";\nimport { Task } from \"./world/task\";\nimport { Timers } from \"./world/timers\";\nimport World, { SimulationSpeed } from \"./world/world\";\n\nconst TICK = \"TICK\";\nconst DONATE_MONEY = \"DONATE_MONEY\";\nconst SET_SIMULATION_SPEED = \"SET_SIMULATION_SPEED\";\nconst PAY_UPKEEP = \"PAY_UPKEEP\";\n\nfunction createTick() {\n  return {\n    type: TICK\n  };\n}\n\nfunction createDonateMoney(\n  fromPlayer: number,\n  toPlayer: number,\n  amount: number\n) {\n  return {\n    type: DONATE_MONEY,\n    payload: {\n      fromPlayer,\n      toPlayer,\n      amount\n    }\n  };\n}\n\nfunction createSetSimulationSpeed(newSpeed: SimulationSpeed) {\n  return {\n    type: SET_SIMULATION_SPEED,\n    payload: newSpeed\n  };\n}\n\nfunction createPayUpkeep(playerId: number, upkeep: number) {\n  return {\n    type: PAY_UPKEEP,\n    payload: {\n      playerId,\n      upkeep\n    }\n  };\n}\n\ninterface MapById<T> {\n  [k: string]: T;\n}\n\ninterface GameState {\n  players: MapById<Player>;\n  islands: MapById<Island>;\n  tasks: MapById<Task>;\n  cities: City[];\n  kontors: Kontor[];\n  producers: Producer[];\n  timers: Timers & { simulationSpeed: SimulationSpeed };\n}\n\nconst takeEveryNth = (n: number) => filter((value, index) => index % n === 0);\n\nexport default class Game {\n  private store: Store<GameState>;\n\n  private timerId: number = null;\n  private readonly myPlayerId: number = 0;\n  private readonly keyboardManager: PIXI.keyboard.KeyboardManager;\n\n  constructor(\n    private readonly gameRenderer: GameRenderer,\n    private readonly configLoader: ConfigLoader\n  ) {\n    this.keyboardManager = PIXI.keyboardManager;\n    this.setupHotKeys();\n  }\n\n  public async begin(world: World) {\n    const initialState: GameState = {\n      players: this.mapArrayById(world.players),\n      islands: this.mapArrayById(world.islands),\n      tasks: this.mapArrayById(world.tasks),\n      cities: world.cities,\n      kontors: world.kontors,\n      producers: world.producers,\n      timers: { ...world.timers, simulationSpeed: SimulationSpeed.Paused }\n    };\n\n    this.store = createStore<GameState, Action<string>, any, never>(\n      combineReducers({\n        players: this.playerReducer,\n        islands: (state: GameState[\"islands\"] = null, action: any) => state,\n        timers: this.timerReducer,\n        tasks: (state: GameState[\"tasks\"] = null, action: any) => state,\n        cities: (state: GameState[\"cities\"] = null, action: any) => state,\n        kontors: (state: GameState[\"kontors\"] = null, action: any) => state,\n        producers: (state: GameState[\"producers\"] = null, action: any) => state\n      }),\n      initialState,\n      composeWithDevTools()\n    );\n\n    this.watchSimulationSpeed();\n    this.watchTicksForUpkeep();\n\n    this.store.dispatch(createSetSimulationSpeed(SimulationSpeed.Default));\n\n    this.keyboardManager.enable();\n\n    await this.gameRenderer.begin(this.myPlayerId);\n\n    // this.gameRenderer.onMove(viewport => )\n  }\n\n  private mapArrayById<T extends { id: number }>(arr: T[]) {\n    return arr.reduce((objectMap: { [k: string]: T }, obj: T) => {\n      objectMap[obj.id] = obj;\n      return objectMap;\n    }, {});\n  }\n\n  private watchSimulationSpeed() {\n    const simulationSpeedWatcher = watch<\n      GameState[\"timers\"][\"simulationSpeed\"]\n    >(this.store.getState, \"timers.simulationSpeed\");\n    this.store.subscribe(\n      simulationSpeedWatcher(\n        (speed: GameState[\"timers\"][\"simulationSpeed\"]) => {\n          if (this.timerId !== null) {\n            clearInterval(this.timerId);\n          }\n          if (speed !== SimulationSpeed.Paused) {\n            this.timerId = setInterval(this.tick.bind(this), 1000 / speed);\n          }\n        }\n      )\n    );\n  }\n\n  private watchTicksForUpkeep() {\n    const tickWatcher = watch<GameState[\"timers\"][\"timeGame\"]>(\n      this.store.getState,\n      \"timers.timeGame\"\n    );\n\n    new Observable(observer => {\n      this.store.subscribe(\n        tickWatcher((tick: GameState[\"timers\"][\"timeGame\"]) => {\n          observer.next(tick);\n        })\n      );\n    })\n      .pipe(takeEveryNth(10))\n      .subscribe(() => {\n        const upkeeps = this.calculateUpkeeps();\n        for (const playerId of Object.keys(upkeeps)) {\n          // This is how Anno 1602 does it, see\n          // https://www.annozone.de/Charlie/Cod/numerik.html\n          const upkeep = Math.floor(upkeeps[playerId] / 6);\n\n          this.store.dispatch(createPayUpkeep(+playerId, upkeep));\n        }\n      });\n  }\n\n  private calculateUpkeeps() {\n    const state = this.store.getState();\n    const upkeeps: { [k: string]: number } = Object.keys(state.players).reduce(\n      (obj: { [k: string]: number }, id: string) => {\n        obj[id] = 0;\n        return obj;\n      },\n      {}\n    );\n\n    const islands = state.islands;\n    const producers = state.producers;\n    for (const producer of producers) {\n      const island = islands[producer.islandId];\n      const field = island.topFields[producer.position.x][producer.position.y];\n      const buildingId = field.fieldId;\n      const playerId = field.playerId;\n      assert(buildingId !== 0xffff);\n      assert(playerId < 7);\n      const fieldConfig = this.configLoader.getFieldData().get(buildingId);\n      assert(fieldConfig);\n\n      upkeeps[playerId] +=\n        fieldConfig.production.upkeep[producer.active ? \"active\" : \"inactive\"];\n    }\n\n    return upkeeps;\n  }\n\n  private setupHotKeys() {\n    const keys = PIXI.keyboard.Key;\n\n    const showTaskKey = keys.F1;\n    this.keyboardManager.onKeyPressedWithPreventDefault(showTaskKey, () => {\n      const state = this.store.getState();\n      const player = state.players[this.myPlayerId];\n      const assignedTask = state.tasks[player.assignedTaskId];\n      if (assignedTask !== undefined) {\n        console.info(assignedTask.text);\n      } else {\n        console.info(\"It appears like you have no task :/\");\n      }\n    });\n\n    const zoomKeys: Array<{ key: Keys; zoom: 1 | 2 | 3 }> = [\n      { key: keys.F2, zoom: 1 },\n      { key: keys.F3, zoom: 2 },\n      { key: keys.F4, zoom: 3 }\n    ];\n    for (const zoomKey of zoomKeys) {\n      this.keyboardManager.onKeyPressedWithPreventDefault(zoomKey.key, () =>\n        this.gameRenderer.zoom(zoomKey.zoom)\n      );\n    }\n\n    const speedKeys = [\n      { keys: [keys.PAUSE], speed: SimulationSpeed.Paused },\n      { keys: [keys.F5], speed: SimulationSpeed.Slow },\n      { keys: [keys.F6], speed: SimulationSpeed.Medium },\n      { keys: [keys.F7], speed: SimulationSpeed.Fast },\n      { keys: [keys.SHIFT, keys.F8], speed: SimulationSpeed.SuperFast }\n    ];\n    for (const speedKey of speedKeys) {\n      this.keyboardManager.onKeysPressedWithPreventDefault(speedKey.keys, () =>\n        this.store.dispatch(createSetSimulationSpeed(speedKey.speed))\n      );\n    }\n  }\n\n  private tick() {\n    this.store.dispatch(createTick());\n  }\n\n  private timerReducer(state: GameState[\"timers\"] = null, action: any) {\n    switch (action.type) {\n      case TICK:\n        return { ...state, gameTime: ++state.timeGame };\n      case SET_SIMULATION_SPEED:\n        return { ...state, simulationSpeed: action.payload };\n      default:\n        return state;\n    }\n  }\n\n  private playerReducer(state: GameState[\"players\"] = null, action: any) {\n    switch (action.type) {\n      case DONATE_MONEY:\n        const payload = action.payload;\n        return {\n          ...state,\n          [payload.fromPlayer]: {\n            ...state[payload.fromPlayer],\n            money: state[payload.fromPlayer].money - payload.amount\n          },\n          [payload.toPlayer]: {\n            ...state[payload.toPlayer],\n            money: state[payload.toPlayer].money + payload.amount\n          }\n        };\n      case PAY_UPKEEP:\n        const playerId = action.payload.playerId;\n        const upkeep = action.payload.upkeep;\n        return {\n          ...state,\n          [playerId]: {\n            ...state[playerId],\n            money: state[playerId].money - upkeep\n          }\n        };\n      default:\n        return state;\n    }\n  }\n}\n","/*\n * The savegame data structure was reverse-engineered by Benedikt Freisen\n * as part of the 'mdcii-engine' project and released under GPLv2+.\n * https://github.com/roybaer/mdcii-engine\n */\n\nimport Stream from \"../../parsers/stream\";\nimport assert from \"../../util/assert\";\nimport Field from \"./field\";\nimport { OreLocation } from \"./island-ore-location\";\n\nenum IslandFertilityFlags {\n  TOBACCO = 1,\n  SUGARCANE = 3,\n  WINE = 5,\n  COTTON = 4,\n  CACAO = 6,\n  SPICE = 2\n}\n\nexport interface IslandFertility {\n  tobacco: boolean;\n  sugarcane: boolean;\n  wine: boolean;\n  cotton: boolean;\n  cacao: boolean;\n  spice: boolean;\n}\n\nexport type Island = ReturnType<typeof islandFromSaveGame>;\n\nexport function islandFromIsland3File(\n  id: number,\n  position: PIXI.Point,\n  isSouth: boolean,\n  numBaseIsland: number,\n  data: Stream\n): Island {\n  data.read8(); // Ignore id\n  const size = new PIXI.Point(data.read8(), data.read8());\n\n  return {\n    id,\n    position,\n    size,\n    positionRect: new PIXI.Rectangle(position.x, position.y, size.x, size.y),\n    numBaseIsland,\n    numOreLocations: 0,\n    oreLocations: [],\n    fertility: {\n      tobacco: false,\n      sugarcane: false,\n      wine: false,\n      cotton: false,\n      cacao: false,\n      spice: false\n    },\n    isSouth,\n    differsFromBaseIsland: false,\n    fertilityDiscovered: false,\n    baseFields: [],\n    topFields: []\n  };\n}\n\nexport function islandFromIsland4File(\n  id: number,\n  position: PIXI.Point,\n  isSouth: boolean,\n  numBaseIsland: number,\n  data: Stream\n): Island {\n  return islandFromIsland3File(id, position, isSouth, numBaseIsland, data);\n}\n\nexport function islandFromIsland5File(\n  id: number,\n  position: PIXI.Point,\n  isSouth: boolean,\n  numBaseIsland: number,\n  data: Stream\n): Island {\n  return islandFromIsland3File(id, position, isSouth, numBaseIsland, data);\n}\n\nexport function islandFromSaveGame(data: Stream) {\n  const id = data.read8();\n  const width = data.read8();\n  const height = data.read8();\n  /*\n    uint8      strtduerrflg:1;\n    uint8      nofixflg:1;\n    uint8      vulkanflg:1;\n     */\n  const _1 = data.read8();\n  const x = data.read16();\n  const y = data.read16();\n\n  const hirschreviercnt = data.read16();\n  const speedcnt = data.read16();\n  // the order in which players built their cities on this island\n  // is 7, 7, 7, 7, 7, 7, 7, 7, by default\n  // fills up from the beginning with player ids once a player builds a kontor.\n  // natives are also listed; islands with natives start with 6, 7, 7, ...\n  const stadtplayernr = data.read(8);\n\n  assert(data.read(3).every(e => e === 0));\n\n  const vulcanoCount = data.read8();\n  const treasureFlag = data.read8Bool();\n  const rohstanz = data.read8();\n\n  const numOreLocations = data.read8();\n  const fertilityDiscovered = data.read8();\n  const oreLocations = [\n    OreLocation.fromSaveGame(data),\n    OreLocation.fromSaveGame(data)\n  ];\n  // These look like even more ore locations.\n  const _5 = data.read(48);\n\n  const fertility = parseFertility(data.read32());\n  const numBaseIsland = data.read16();\n\n  // unsure\n  const sizenr = data.read16();\n\n  const isSouth = data.read8Bool();\n  const differsFromBaseIsland = data.read8Bool();\n\n  // unsure\n  const duerrproz = data.read8();\n  // unsure\n  const rotier = data.read8();\n\n  const seeplayerflags = data.read32(); // 1 nach bloem Vorbeifahren (= zeigt Eingebohrene), 0xFF nach Kontorbau\n\n  // unsure\n  const duerrcnt = data.read32();\n\n  assert(data.read32() === 0);\n\n  const baseFields: Field[][] = [];\n  const topFields: Array<Array<Field | null>> = [];\n\n  return {\n    id,\n    position: new PIXI.Point(x, y),\n    size: new PIXI.Point(width, height),\n    positionRect: new PIXI.Rectangle(x, y, width, height),\n    numBaseIsland,\n    numOreLocations,\n    oreLocations,\n    fertility,\n    isSouth,\n    differsFromBaseIsland,\n    fertilityDiscovered: fertilityDiscovered !== 0,\n    baseFields,\n    topFields\n  };\n\n  // island.debug = {\n  //    _1,\n  //    _5,\n  //    hirschreviercnt,\n  //    speedcnt,\n  //    stadtplayernr,\n  //    vulcanoCount,\n  //    treasureFlag,\n  //    rohstanz,\n  //\n  //    sizenr,\n  //    duerrproz,\n  //    rotier,\n  //\n  //    seeplayerflags,\n  //    duerrcnt,\n  // };\n  // console.log(island.debug);\n}\n\nfunction parseFertility(fertility: number): IslandFertility {\n  return {\n    tobacco: (fertility & (1 << IslandFertilityFlags.TOBACCO)) > 0,\n    sugarcane: (fertility & (1 << IslandFertilityFlags.SUGARCANE)) > 0,\n    wine: (fertility & (1 << IslandFertilityFlags.WINE)) > 0,\n    cotton: (fertility & (1 << IslandFertilityFlags.COTTON)) > 0,\n    cacao: (fertility & (1 << IslandFertilityFlags.CACAO)) > 0,\n    spice: (fertility & (1 << IslandFertilityFlags.SPICE)) > 0\n  };\n}\n","/*\n * The savegame data structure was reverse-engineered by Benedikt Freisen\n * as part of the 'mdcii-engine' project and released under GPLv2+.\n * https://github.com/roybaer/mdcii-engine\n */\n\nimport Stream from \"../../parsers/stream\";\n\nexport type City = ReturnType<typeof cityFromSaveGame>;\n\nexport function cityFromSaveGame(data: Stream) {\n  const islandId = data.read8();\n  const cityIslandNum = data.read8();\n  const playerId = data.read16();\n  const progressAllowed = !data.read8Bool();\n  const _1 = data.read(87);\n  const inhabitants = [];\n  for (let i = 0; i < 5; i++) {\n    inhabitants.push(data.read32());\n  }\n  const _2 = data.read(15);\n  const taxes = [];\n  for (let i = 0; i < 5; i++) {\n    taxes.push(data.read8());\n  }\n  const _3 = data.read(3);\n  const name = data.readString(33);\n\n  return {\n    islandId,\n    playerId,\n    cityIslandNum,\n    progressAllowed,\n    inhabitants,\n    taxes,\n    name\n  };\n}\n","import Stream from \"../../parsers/stream\";\nimport assert from \"../../util/assert\";\n\nenum PlayerEventKind {}\n// TODO\n\nexport default class PlayerEvent {\n  public static fromSaveGame(data: Stream) {\n    const kind = data.read8();\n    const otherPlayerId = data.read8();\n    assert(data.read16() === 0);\n    const time = data.read32(); // TODO: Which unit is time in?\n\n    return new PlayerEvent(kind, otherPlayerId, time);\n  }\n\n  constructor(\n    public readonly kind: PlayerEventKind,\n    public readonly otherPlayerId: number,\n    public readonly time: number\n  ) {}\n}\n","import * as log from \"loglevel\";\nimport { SmartBuffer, SmartBufferOptions } from \"smart-buffer\";\nimport FileSystem from \"../../filesystem\";\nimport assert from \"../../util/assert\";\nimport Stream from \"../stream\";\nimport BinPacker from \"./bin-packer\";\nimport colorPalette, { colorsToIdx } from \"./bsh-color-palette\";\nimport BSHImage from \"./bsh-image\";\n\nconst UPNG = require(\"upng-js/UPNG.js\");\n\ninterface AtlasData {\n  meta: {};\n  frames: {\n    [key: string]: {\n      frame: {\n        x: number;\n        y: number;\n        w: number;\n        h: number;\n      };\n      rotated: boolean;\n      trimmed: boolean;\n      spriteSourceSize: {\n        x: number;\n        y: number;\n        w: number;\n        h: number;\n      };\n      sourceSize: {\n        w: number;\n        h: number;\n      };\n    };\n  };\n}\n\nexport interface SpriteSheetConfig {\n  png: ArrayBuffer;\n  config: AtlasData;\n}\n\nexport default class BSHParser {\n  private readonly SPRITESHEET_SIZE = 2048;\n\n  private readonly HEADER_SIZE = 20;\n\n  private log: log.Logger;\n\n  constructor() {\n    this.log = log.getLogger(\"bsh-parser\");\n  }\n\n  public async decodeBSH(data: Stream) {\n    return this.decode(data, \"BSH\");\n  }\n\n  public async decodeZEI(data: Stream) {\n    return this.decode(data, \"ZEI\");\n  }\n\n  public createSpriteSheets(images: BSHImage[]): SpriteSheetConfig[] {\n    const sheets: SpriteSheetConfig[] = [];\n\n    let binPacker = new BinPacker(this.SPRITESHEET_SIZE, this.SPRITESHEET_SIZE);\n    let pixels = new Uint8Array(\n      this.SPRITESHEET_SIZE * this.SPRITESHEET_SIZE * 4\n    );\n    let atlasData: AtlasData = { meta: {}, frames: {} };\n\n    for (let i = 0; i < images.length; i++) {\n      const image = images[i];\n      let result = binPacker.addBlock({ w: image.width, h: image.height });\n      if (result === false) {\n        sheets.push({\n          png: UPNG.encode(\n            [pixels.buffer],\n            this.SPRITESHEET_SIZE,\n            this.SPRITESHEET_SIZE\n          ),\n          config: atlasData\n        });\n        binPacker = new BinPacker(this.SPRITESHEET_SIZE, this.SPRITESHEET_SIZE);\n        pixels = new Uint8Array(\n          this.SPRITESHEET_SIZE * this.SPRITESHEET_SIZE * 4\n        );\n        atlasData = { meta: {}, frames: {} };\n\n        result = binPacker.addBlock({ w: image.width, h: image.height });\n      }\n      if (!result) {\n        throw new Error(\"Could not add image to empty spritesheet!\");\n      }\n\n      const startX = result.x;\n      const startY = result.y;\n\n      let j = 0;\n      for (let y = 0; y < image.height; y++) {\n        for (let x = 0; x < image.width; x++) {\n          const idx =\n            (startX +\n              x +\n              this.SPRITESHEET_SIZE * y +\n              this.SPRITESHEET_SIZE * startY) *\n            4;\n          pixels[idx + 0] = image.pixels[j * 4 + 0];\n          pixels[idx + 1] = image.pixels[j * 4 + 1];\n          pixels[idx + 2] = image.pixels[j * 4 + 2];\n          pixels[idx + 3] = image.pixels[j * 4 + 3];\n          j++;\n        }\n      }\n\n      atlasData.frames[i.toString(10)] = {\n        frame: {\n          x: startX,\n          y: startY,\n          w: image.width,\n          h: image.height\n        },\n        rotated: false,\n        trimmed: false,\n        spriteSourceSize: {\n          x: 0,\n          y: 0,\n          w: image.width,\n          h: image.height\n        },\n        sourceSize: {\n          w: image.width,\n          h: image.height\n        }\n      };\n    }\n\n    sheets.push({\n      png: UPNG.encode(\n        [pixels.buffer],\n        this.SPRITESHEET_SIZE,\n        this.SPRITESHEET_SIZE\n      ),\n      config: atlasData\n    });\n\n    return sheets;\n  }\n\n  public async saveSpriteSheets(\n    fs: FileSystem,\n    sheets: SpriteSheetConfig[],\n    outName: string\n  ) {\n    await fs.mkdir(outName);\n    for (let i = 0; i < sheets.length; i++) {\n      await this.saveSpriteSheet(fs, sheets[i], i, outName);\n    }\n  }\n\n  public encodeBSH(images: BSHImage[]): Buffer {\n    const data = new SmartBuffer();\n    data.writeString(\"BSH\".padEnd(16, \"\\0\"), \"ascii\");\n    data.writeUInt32LE(42);\n\n    images.forEach(() => data.writeUInt32LE(42));\n\n    images.forEach((image, i) => {\n      const imageBuffer = this.encodeImage(image).toBuffer();\n      data.writeUInt32LE(data.writeOffset - this.HEADER_SIZE, 20 + i * 4);\n      data.writeBuffer(imageBuffer);\n    });\n\n    data.writeUInt32LE(data.length - this.HEADER_SIZE, 16);\n\n    return data.toBuffer();\n  }\n\n  /**\n   * The parsing algorithm is based on code from the 'mdcii-engine'\n   * project by Benedikt Freisen released under GPLv2+.\n   * https://github.com/roybaer/mdcii-engine\n   */\n  private async decode(data: Stream, extension: string) {\n    const fileType = data.readString(16);\n    assert(fileType === extension);\n\n    const fileLength = data.read32();\n    assert(this.HEADER_SIZE + fileLength === data.length);\n\n    const imageOffsets: number[] = [];\n    imageOffsets.push(data.read32());\n    const numImages = imageOffsets[0] / 4;\n\n    for (let i = 1; i < numImages; i++) {\n      imageOffsets.push(data.read32());\n    }\n    const images: BSHImage[] = [];\n\n    for (let i = 0; i < numImages; i++) {\n      data.seek(imageOffsets[i] + this.HEADER_SIZE);\n      const bshImage = this.decodeImage(data);\n      if (bshImage !== null) {\n        images.push(bshImage);\n      }\n    }\n\n    return images;\n  }\n\n  private decodeImage(data: Stream): BSHImage | null {\n    const width = data.read32();\n    const height = data.read32();\n    const type = data.read32();\n    const length = data.read32();\n\n    assert(width > 0);\n    assert(height > 0);\n\n    const BYTES_PER_PIXEL = 4;\n    const pixels = new Uint8Array(width * height * BYTES_PER_PIXEL);\n\n    // The image's current row we write to.\n    let rowIdx = 0;\n\n    let targetIdx = 0;\n\n    while (true) {\n      const ch = data.read8();\n      if (ch === 0xff) {\n        break;\n      }\n      if (ch === 0xfe) {\n        // Go to next row. All remaining pixels in this row are empty\n        rowIdx++;\n        targetIdx = rowIdx * width * BYTES_PER_PIXEL;\n      } else {\n        // New row. First check how many pixels are empty and increase targetIdx by that amount\n        const emptyPixels = ch;\n        targetIdx += emptyPixels * BYTES_PER_PIXEL;\n\n        // How many pixels are colored\n        const coloredPixels = data.read8();\n        for (let i = 0; i < coloredPixels; i++) {\n          const idx = data.read8() * 3;\n\n          pixels[targetIdx++] = colorPalette[idx];\n          pixels[targetIdx++] = colorPalette[idx + 1];\n          pixels[targetIdx++] = colorPalette[idx + 2];\n          pixels[targetIdx++] = 0xff;\n        }\n      }\n    }\n    return new BSHImage(width, height, pixels);\n  }\n\n  private encodeImage(image: BSHImage) {\n    const data = new SmartBuffer();\n    data\n      .writeUInt32LE(image.width)\n      .writeUInt32LE(image.height)\n      .writeUInt32LE(1)\n      .writeUInt32LE(42); // This is overwritten later on\n\n    let FEs = 0;\n    for (let y = 0; y < image.height; y++) {\n      let skipPixelsEmpty = 0;\n      let coloredPixels: number[] = [];\n      let state: \"empty\" | \"colored\" = \"empty\";\n      for (let x = 0; x < image.width; x++) {\n        const color =\n          (image.pixels[(y * image.width + x) * 4 + 0] << 24) +\n          (image.pixels[(y * image.width + x) * 4 + 1] << 16) +\n          (image.pixels[(y * image.width + x) * 4 + 2] << 8) +\n          (image.pixels[(y * image.width + x) * 4 + 3] << 0);\n\n        if (color === 0x00000000) {\n          // Transparent pixel\n          if (state === \"empty\") {\n            skipPixelsEmpty++;\n          } else if (state === \"colored\") {\n            while (FEs > 0) {\n              data.writeUInt8(0xfe);\n              FEs--;\n            }\n\n            while (skipPixelsEmpty > 0xfd) {\n              data.writeUInt8(0xfd);\n              data.writeUInt8(0);\n              skipPixelsEmpty -= 0xfd;\n            }\n            data.writeUInt8(skipPixelsEmpty);\n\n            for (let i = 0; i < coloredPixels.length; i += 0xff) {\n              const coloredPixelsSlice = coloredPixels.slice(i, i + 0xff);\n              if (i > 0) {\n                data.writeUInt8(0x00);\n              }\n              data.writeUInt8(coloredPixelsSlice.length);\n              coloredPixelsSlice.forEach(pixel => {\n                const colorIdx = colorsToIdx[pixel];\n                data.writeUInt8(colorIdx);\n              });\n            }\n            skipPixelsEmpty = 1;\n            coloredPixels = [];\n          }\n          state = \"empty\";\n        } else {\n          // Non-transparent pixel\n          state = \"colored\";\n          coloredPixels.push(color);\n        }\n      }\n\n      if (state === \"colored\") {\n        while (FEs > 0) {\n          data.writeUInt8(0xfe);\n          FEs--;\n        }\n\n        while (skipPixelsEmpty > 0xfd) {\n          data.writeUInt8(0xfd);\n          data.writeUInt8(0);\n          skipPixelsEmpty -= 0xfd;\n        }\n        data.writeUInt8(skipPixelsEmpty);\n        for (let i = 0; i < coloredPixels.length; i += 0xff) {\n          const coloredPixelsSlice = coloredPixels.slice(i, i + 0xff);\n          if (i > 0) {\n            data.writeUInt8(0x00);\n          }\n          data.writeUInt8(coloredPixelsSlice.length);\n          coloredPixelsSlice.forEach(pixel => {\n            data.writeUInt8(colorsToIdx[pixel.toString()]);\n          });\n        }\n      }\n      FEs++;\n    }\n    data.writeUInt8(0xff);\n\n    const padding = (4 - (data.length % 4)) % 4; // How many bytes left to make it dividable by 4?\n    for (let i = 0; i < padding; i++) {\n      data.writeUInt8(0x00);\n    }\n    data.writeUInt32LE(data.length, 12);\n\n    return data;\n  }\n\n  private async saveSpriteSheet(\n    fs: FileSystem,\n    sheet: SpriteSheetConfig,\n    spritesheetIndex: number,\n    outName: string\n  ) {\n    await fs.write(\n      `${outName}/sprite-sheet-${spritesheetIndex}.png`,\n      sheet.png\n    );\n    await fs.write(\n      `${outName}/sprite-sheet-${spritesheetIndex}.json`,\n      JSON.stringify(sheet.config)\n    );\n  }\n}\n","import * as PIXI from \"pixi.js\";\nimport GameRenderer from \"./game-renderer\";\nimport { SpriteWithPositionAndLayer } from \"./island-sprite-loader\";\nimport { WorldLayer } from \"./island-sprite-loader\";\nimport { Rotation4 } from \"./world/world\";\n\nexport type LandFieldType =\n  | \"BODEN\"\n  | \"FLUSS\"\n  | \"FLUSSECK\"\n  | \"HANG\"\n  | \"HANGQUELL\"\n  | \"HANGECK\"\n  | \"STRAND\"\n  | \"STRANDMUND\"\n  | \"STRANDRUINE\"\n  | \"STRANDECKI\"\n  | \"STRANDECKA\"\n  | \"STRANDVARI\"\n  | \"BRANDUNG\"\n  | \"BRANDECK\"\n  | \"PIER\"\n  | \"MEER\"\n  | \"WALD\"\n  | \"RUINE\"\n  | \"STRANDHAUS\"\n  | \"HAFEN\"\n  | \"FELS\"\n  | \"MUENDUNG\";\n\nexport type BuildingFieldType =\n  | \"GEBAEUDE\"\n  | \"HQ\" // Kontor\n  | \"STRASSE\"\n  | \"BRUECKE\"\n  | \"PLATZ\"\n  | \"WMUEHLE\"\n  | \"MINE\"\n  | \"MAUER\"\n  | \"MAUERSTRAND\"\n  | \"TOR\"\n  | \"TURM\"\n  | \"TURMSTRAND\";\n\nexport type FieldKind = LandFieldType | BuildingFieldType;\n\nexport default class FieldType {\n  public readonly id: number;\n  public readonly gfxId: number;\n  public readonly kind: FieldKind;\n  public readonly size: PIXI.Point;\n  public readonly rotate: number;\n  public readonly animAdd: number;\n  public readonly yOffset: number;\n  public readonly animTime: number;\n  public readonly animAnz: number;\n  public readonly production: {\n    good: string;\n    upkeep: {\n      active: number;\n      inactive: number;\n    };\n  };\n\n  constructor(config: any) {\n    this.id = config.Id;\n    this.gfxId = config.Gfx;\n    this.kind = config.Kind;\n    this.size = new PIXI.Point(config.Size.x, config.Size.y);\n    this.rotate = config.Rotate;\n    this.animAdd = config.AnimAdd;\n    this.animAnz = config.AnimAnz;\n    this.animTime = config.AnimTime === \"TIMENEVER\" ? -1 : config.AnimTime;\n    this.yOffset = -config.Posoffs;\n\n    const productionConfig = config.nested_objects.HAUS_PRODTYP[0];\n    const upkeep = {\n      active: 0,\n      inactive: 0\n    };\n    if (Array.isArray(productionConfig.Kosten)) {\n      upkeep.active = productionConfig.Kosten[0];\n      upkeep.inactive = productionConfig.Kosten[1];\n    } else {\n      upkeep.active = upkeep.inactive =\n        productionConfig.Kosten !== undefined ? productionConfig.Kosten : 0;\n    }\n    this.production = {\n      good: productionConfig.Ware,\n      upkeep\n    };\n  }\n\n  public getSprites(\n    fieldPos: PIXI.Point,\n    rotation: Rotation4,\n    animationStep: number,\n    textures: Map<number, PIXI.Texture>,\n    layer: WorldLayer\n  ) {\n    const sprites: SpriteWithPositionAndLayer[] = [];\n    const sx = rotation % 2 === 0 ? this.size.x : this.size.y;\n    const sy = rotation % 2 === 0 ? this.size.y : this.size.x;\n    for (let y = 0; y < sy; y++) {\n      for (let x = 0; x < sx; x++) {\n        const xx = fieldPos.x + x;\n        const yy = fieldPos.y + y;\n        const { x: worldX, y: worldY } = GameRenderer.fieldPosToWorldPos(\n          new PIXI.Point(xx, yy)\n        );\n\n        let sprite: PIXI.Sprite | PIXI.extras.AnimatedSprite;\n        if (this.animAdd === 0 || this.animTime === -1) {\n          const texture = this.getTexture(\n            x,\n            y,\n            rotation,\n            animationStep,\n            textures\n          );\n          sprite = new PIXI.Sprite(texture);\n        } else {\n          const animatedTextures = [];\n          for (let i = 0; i < this.animAnz; i++) {\n            animatedTextures.push(this.getTexture(x, y, rotation, i, textures));\n          }\n          const animatedSprite = new PIXI.extras.AnimatedSprite(\n            animatedTextures\n          );\n          animatedSprite.animationSpeed =\n            (1.0 / 60.0) * (1000.0 / this.animTime);\n          animatedSprite.play();\n          sprite = animatedSprite;\n        }\n        // Set bottom left corner of sprite as origin.\n        sprite.anchor.set(0, 1);\n        sprite.x = worldX;\n        sprite.y = worldY + this.yOffset;\n        sprites.push({\n          sprite: sprite,\n          position: new PIXI.Point(xx, yy),\n          layer: layer\n        });\n      }\n    }\n\n    return sprites;\n  }\n\n  private getTexture(\n    x: number,\n    y: number,\n    rotation: Rotation4,\n    animationStep: number,\n    textures: Map<number, PIXI.Texture>\n  ): PIXI.Texture {\n    let tileId = this.gfxId;\n    if (this.rotate > 0) {\n      tileId += rotation * this.size.x * this.size.y;\n    }\n    tileId += animationStep * this.animAdd;\n\n    if (rotation === 0) {\n      tileId += y * this.size.x + x;\n    } else if (rotation === 1) {\n      tileId +=\n        this.size.x * this.size.y -\n        1 -\n        (x * this.size.x + (this.size.x - 1 - y));\n    } else if (rotation === 2) {\n      tileId += (this.size.y - 1 - y) * this.size.x + (this.size.x - 1 - x);\n    } else if (rotation === 3) {\n      tileId += x * this.size.x + (this.size.x - 1 - y);\n    } else {\n      throw new Error(`Invalid building rotation: ${rotation}.`);\n    }\n\n    const texture = textures.get(tileId);\n    if (texture === undefined) {\n      throw new Error(`Could not load texture ${tileId}.`);\n    }\n\n    return texture;\n  }\n}\n","/*\n * The savegame data structure was reverse-engineered by Benedikt Freisen\n * as part of the 'mdcii-engine' project and released under GPLv2+.\n * https://github.com/roybaer/mdcii-engine\n */\n\nimport { castleFromSaveGame } from \"../../game/world/castle\";\nimport { cityFromSaveGame } from \"../../game/world/city\";\nimport { Island, islandFromSaveGame } from \"../../game/world/island\";\nimport { kontorFromSaveGame } from \"../../game/world/kontor\";\nimport { Player, playerFromSaveGame } from \"../../game/world/player\";\nimport { producerFromSaveGame } from \"../../game/world/producer\";\nimport { shipFromSaveGame } from \"../../game/world/ship\";\nimport { soldierFromSaveGame } from \"../../game/world/soldier\";\nimport { taskFromSaveGame } from \"../../game/world/task\";\nimport { timersFromSaveGame } from \"../../game/world/timers\";\nimport { traderFromSaveGame } from \"../../game/world/trader\";\nimport World from \"../../game/world/world\";\nimport WorldGenerationSettings from \"../../game/world/world-generation-settings\";\nimport assert from \"../../util/assert\";\nimport Stream from \"../stream\";\nimport { Block, IslandBlock } from \"./block\";\nimport IslandLoader from \"./island-loader\";\nimport WorldGenerator from \"./world-generator\";\n\nexport default class GAMParser {\n  private worldGenerator: WorldGenerator;\n\n  constructor(private islandLoader: IslandLoader) {\n    this.worldGenerator = new WorldGenerator(islandLoader);\n  }\n\n  public parse(data: Stream) {\n    const blocks: Map<string, Block[]> = new Map();\n    while (!data.eof()) {\n      const block = Block.fromStream(data);\n      if (block.type !== \"INSELHAUS\") {\n        if (!blocks.has(block.type)) {\n          blocks.set(block.type, []);\n        }\n        blocks.get(block.type).push(block);\n      } else {\n        const lastIslandBlock = blocks.get(\"INSEL5\")[\n          blocks.get(\"INSEL5\").length - 1\n        ] as IslandBlock;\n        if (lastIslandBlock.inselHausBlocks === undefined) {\n          lastIslandBlock.inselHausBlocks = [];\n        }\n        lastIslandBlock.inselHausBlocks.push(block);\n      }\n    }\n    return blocks;\n  }\n\n  public async getWorld(data: Stream) {\n    const blocks = this.parse(data);\n\n    const { world, worldGenerationSettings } = await this.doParse(blocks);\n\n    await this.worldGenerator.populateWorld(world, worldGenerationSettings);\n\n    return world;\n  }\n\n  private async doParse(blocks: Map<string, Block[]>) {\n    // console.log([...blocks.keys()].map(key => [key, blocks.get(key).length]));\n    console.log(\n      [...blocks.keys()]\n        .filter(\n          key => blocks.get(key).find(block => block.length > 0) !== undefined\n        )\n        .map(key => [key, blocks.get(key)])\n    );\n\n    let gameName = \"\";\n    if (blocks.has(\"NAME\")) {\n      // Missions don't have a name.\n      const nameBlock = blocks.get(\"NAME\")[0];\n      gameName = nameBlock.data.readString(nameBlock.length);\n    }\n\n    const playerBlock = blocks.get(\"PLAYER4\")[0];\n    const players = this.parsePlayers(playerBlock);\n\n    const islandBlocks = blocks.has(\"INSEL5\")\n      ? (blocks.get(\"INSEL5\") as IslandBlock[])\n      : [];\n    const islands = await this.parseIslands(islandBlocks);\n\n    const tasks = this.handleBlock(blocks, \"AUFTRAG4\", taskFromSaveGame);\n    const ships = this.handleBlock(blocks, \"SHIP4\", shipFromSaveGame);\n    const soldiers = this.handleBlock(blocks, \"SOLDAT3\", soldierFromSaveGame);\n    const kontors = this.handleBlock(blocks, \"KONTOR2\", kontorFromSaveGame);\n    const castles = this.handleBlock(blocks, \"MILITAR\", castleFromSaveGame);\n    const cities = this.handleBlock(blocks, \"STADT4\", cityFromSaveGame);\n    const producers = this.handleBlock(\n      blocks,\n      \"PRODLIST2\",\n      producerFromSaveGame\n    );\n\n    // TODO: HIRSCH2, WERFT, SIEDLER, ROHWACHS2, MARKT2, TURM, WIFF\n    let trader = null;\n    if (blocks.has(\"HANDLER\") && blocks.get(\"HANDLER\")[0].length > 0) {\n      trader = traderFromSaveGame(blocks.get(\"HANDLER\")[0].data);\n    }\n\n    assert(blocks.has(\"TIMERS\"));\n    assert(blocks.get(\"TIMERS\").length === 1);\n    const timers = timersFromSaveGame(blocks.get(\"TIMERS\")[0].data);\n\n    let worldGenerationSettings = WorldGenerationSettings.empty();\n    if (blocks.has(\"SZENE\")) {\n      const data = blocks.get(\"SZENE\")[0].data;\n      worldGenerationSettings = WorldGenerationSettings.fromSaveGame(data);\n    }\n\n    const world = new World(\n      islands,\n      players,\n      tasks,\n      gameName,\n      soldiers,\n      ships,\n      kontors,\n      castles,\n      cities,\n      trader,\n      timers,\n      producers\n    );\n\n    return { world, worldGenerationSettings };\n  }\n\n  private handleBlock<T>(\n    blocks: Map<string, Block[]>,\n    name: string,\n    fromSaveGame: (data: Stream) => T\n  ): T[] {\n    if (!blocks.has(name)) {\n      return [];\n    }\n    const entities: T[] = [];\n    for (const block of blocks.get(name)) {\n      while (!block.data.eof()) {\n        entities.push(fromSaveGame(block.data));\n      }\n    }\n    return entities;\n  }\n\n  private async parseIslands(islandBlocks: IslandBlock[]) {\n    const islands: Island[] = [];\n    for (const islandBlock of islandBlocks) {\n      const island = islandFromSaveGame(islandBlock.data);\n      const islandBuildingBlocks =\n        islandBlock.inselHausBlocks !== undefined\n          ? islandBlock.inselHausBlocks\n          : [];\n\n      let islandTopBlock = Block.empty(\"INSELHAUS\");\n      let islandBottomBlock;\n      if (!island.differsFromBaseIsland && islandBuildingBlocks.length <= 1) {\n        if (islandBuildingBlocks.length === 1) {\n          islandTopBlock = islandBuildingBlocks[0];\n        }\n\n        const islandFile = await this.islandLoader.loadIslandFile(island);\n        // TODO: Why do we ignore this block\n        const islandBasisBlock = Block.fromStream(islandFile);\n        // TODO: Are there more blocks?\n        islandBottomBlock = Block.fromStream(islandFile);\n      } else {\n        assert(\n          islandBuildingBlocks.length >= 1 && islandBuildingBlocks.length <= 2\n        );\n        islandBottomBlock = islandBuildingBlocks[0];\n        if (islandBuildingBlocks.length === 2) {\n          islandTopBlock = islandBuildingBlocks[1];\n        }\n      }\n      island.baseFields = this.islandLoader.parseIslandBuildings(\n        island,\n        islandBottomBlock\n      );\n\n      island.topFields = this.islandLoader.parseIslandBuildings(\n        island,\n        islandTopBlock\n      );\n\n      islands.push(island);\n    }\n    return islands;\n  }\n\n  private parsePlayers(block: Block) {\n    const players: Player[] = [];\n    while (!block.data.eof()) {\n      players.push(playerFromSaveGame(block.data));\n    }\n    return players;\n  }\n}\n","import * as Viewport from \"pixi-viewport\";\nimport FileSystem from \"./filesystem\";\nimport ConfigLoader from \"./game/config-loader\";\nimport Game from \"./game/game\";\nimport GameRenderer from \"./game/game-renderer\";\nimport IslandRenderer from \"./game/island-renderer\";\nimport MusicPlayer from \"./game/music-player\";\nimport GAMParser from \"./parsers/GAM/gam-parser\";\n\nexport default class GameLoader {\n  constructor(\n    private readonly fs: FileSystem,\n    private readonly gamParser: GAMParser,\n    private readonly islandRenderer: IslandRenderer,\n    private readonly viewport: Viewport,\n    private readonly configLoader: ConfigLoader,\n    private readonly musicPlayer: MusicPlayer\n  ) {}\n\n  public async loadByName(gameName: string) {\n    const saveGame = (await this.loadSavesAndMissions()).find(\n      saveOrMission => saveOrMission.name === gameName\n    );\n    await this.load(saveGame);\n  }\n\n  public async load(saveGame: WebKitEntry | string) {\n    const saveGameData = await this.fs.openAndGetContentAsStream(saveGame);\n    const world = await this.gamParser.getWorld(saveGameData);\n    const gameRenderer = new GameRenderer(\n      world,\n      this.islandRenderer,\n      this.viewport\n    );\n    const gameLogic = new Game(gameRenderer, this.configLoader);\n    await gameLogic.begin(world);\n    this.musicPlayer.playAll();\n\n    //      this.viewport.parent.addChild(new PIXI.Text(\n    //          `Money: ${world.players.find((player) => player.id === 0).money}`,\n    //          {fontFamily : \"Arial\", fontSize: 24, fill : 0xff1010},\n    //      ));\n  }\n\n  private async loadSavesAndMissions() {\n    const saves = [];\n    try {\n      saves.push(...(await this.fs.ls(\"/saves\", \".gam\")));\n    } catch (e) {\n      // Ignore errors\n    }\n\n    const missions = [];\n    try {\n      missions.push(...(await this.fs.ls(\"/missions-original\", \".szs|.szm\")));\n      missions.push(...(await this.fs.ls(\"/missions-custom\", \".szs|.szm\")));\n    } catch (e) {\n      // Ignore errors\n    }\n    return saves.concat(missions);\n  }\n}\n","import Stream from \"../stream\";\n\nexport class Block {\n  public static empty(type: string) {\n    return new Block(type, 0, new Stream(new Uint8Array()));\n  }\n\n  public static fromStream(data: Stream) {\n    return new Block(data.readString(16), data.read32(), data);\n  }\n\n  public readonly data: Stream;\n\n  constructor(\n    public readonly type: string,\n    public readonly length: number,\n    data: Stream\n  ) {\n    this.data = new Stream(data.slice(length));\n  }\n}\n\n// tslint:disable-next-line:max-classes-per-file\nexport class IslandBlock extends Block {\n  public inselHausBlocks: Block[] = [];\n}\n","/*\n * The savegame data structure was reverse-engineered by Benedikt Freisen\n * as part of the 'mdcii-engine' project and released under GPLv2+.\n * https://github.com/roybaer/mdcii-engine\n */\n\nimport Stream from \"../../parsers/stream\";\n\nexport type Trader = ReturnType<typeof traderFromSaveGame>;\n\nexport function traderFromSaveGame(data: Stream) {\n  const _1 = data.read32();\n  const _2 = data.read(5 * 4);\n  const goods = parseGoods(data);\n  const _3 = data.read(292);\n\n  console.error(_1, _2, goods, _3);\n\n  return {\n    goods\n  };\n}\n\nfunction parseGoods(data: Stream) {\n  const goods = [];\n  for (let i = 0; i < 24; i++) {\n    goods.push({\n      goodId: data.read32(),\n      _1: data.read32(),\n      _2: data.read32()\n    });\n  }\n  return goods;\n}\n","import { uInt8ToBase64 } from \"../../util/util\";\nimport { SpriteSheetConfig } from \"../BSH/bsh-parser\";\nconst xml = require(\"xml\");\n\nexport default class BitmapFontGenerator {\n  public async createBitmapFont(sheets: SpriteSheetConfig[], fontName: string) {\n    const pages = [];\n    const chars = [];\n\n    for (let pageId = 0; pageId < sheets.length; pageId++) {\n      const sheet = sheets[pageId];\n\n      pages.push({\n        page: [\n          {\n            _attr: {\n              id: pageId,\n              file: `data:image/png;base64,${uInt8ToBase64(\n                new Uint8Array(sheet.png)\n              )}`\n              // file: `${pageId}.png`,\n            }\n          }\n        ]\n      });\n\n      for (const idx of Object.keys(sheet.config.frames)) {\n        const config = sheet.config.frames[idx];\n\n        const char = parseInt(idx, 10) + 32;\n        chars.push({\n          char: [\n            {\n              _attr: {\n                id: char,\n                x: config.frame.x,\n                y: config.frame.y,\n                width: config.frame.w,\n                height: config.frame.h,\n                xoffset: 0,\n                yoffset: 0,\n                xadvance: config.frame.w,\n                page: pageId,\n                chnl: 15,\n                letter: String.fromCharCode(char)\n              }\n            }\n          ]\n        });\n      }\n    }\n\n    const fontSize = sheets[0].config.frames[0].sourceSize.h;\n\n    // http://www.angelcode.com/products/bmfont/doc/file_format.html\n    // https://raw.githubusercontent.com/pixijs/examples/gh-pages/required/assets/desyrel.xml\n    const font: any = {\n      font: [\n        {\n          info: [\n            {\n              _attr: {\n                face: fontName,\n                size: fontSize,\n                padding: \"0,0,0,0\",\n                spacing: \"0,0\",\n                italic: \"0\",\n                bold: \"0\",\n                stretchH: \"100\",\n                smooth: \"1\", // unsure\n                aa: \"1\" // unsure\n                // charset\n                // unicode\n              }\n            }\n          ]\n        },\n        {\n          common: [\n            {\n              _attr: {\n                pages: sheets.length,\n                lineHeight: fontSize,\n                // base\n                // scaleW\n                // scaleH\n                packed: 0\n                // alphaChnl\n                // redChnl\n                // greenChnl\n                // blueChnl\n              }\n            }\n          ]\n        },\n        { pages },\n        { chars }\n      ]\n    };\n\n    return xml(font, { indent: \"  \" });\n  }\n}\n","import VideoBaseTexture = PIXI.VideoBaseTexture;\nimport * as PIXI from \"pixi.js\";\nimport SpriteLoader from \"../sprite-loader\";\nimport assert from \"../util/assert\";\nimport { ScreenConfig } from \"./menu-structure\";\nimport SliderSprite from \"./ui/slider-sprite\";\n\ninterface RadioButtonData {\n  sprite: PIXI.Sprite;\n  defaultTexture: PIXI.Texture;\n  activeTexture: PIXI.Texture;\n}\n\nexport default class GADRenderer {\n  private videos: PIXI.Sprite[] = [];\n\n  constructor(\n    private readonly stage: PIXI.Container,\n    private readonly spriteLoader: SpriteLoader\n  ) {}\n\n  public async render(data: any, config: ScreenConfig) {\n    this.destroyVideos();\n    this.stage.removeChildren();\n\n    const blockNumMapping: Map<number, string> = new Map();\n    for (const name of Object.keys(data.variables)) {\n      const value = data.variables[name];\n      if (name.startsWith(\"BLK_\")) {\n        blockNumMapping.set(value, name.substring(4));\n      }\n    }\n\n    const radioButtons: RadioButtonData[] = [];\n    let selectableCount = 0;\n    const gadgets = data.objects.GADGET.items;\n    for (const num of Object.keys(gadgets)) {\n      const gadget = gadgets[num];\n      const id = gadget.Id;\n      const blockNr = gadget.Blocknr;\n      const gfx = gadget.Gfxnr;\n      const kind = gadget.Kind;\n      const position = new PIXI.Point(gadget.Pos[0], gadget.Pos[1]);\n      if (gadget.Posoffs) {\n        position.set(\n          position.x + gadget.Posoffs[0],\n          position.y + gadget.Posoffs[1]\n        );\n      }\n      const size =\n        gadget.Size !== undefined\n          ? new PIXI.Point(gadget.Size.x, gadget.Size.y)\n          : null;\n      const selectable = gadget.Noselflg === undefined || gadget.Noselflg === 0;\n      const pressOff = gadget.Pressoff;\n      const isRadioButton = gadget.Reiheflg === 1;\n      if (isRadioButton) {\n        assert(selectable);\n      }\n      assert(blockNr !== undefined);\n\n      const isSlider = gadget.Slidverflg !== undefined;\n      const sliderOffset = gadget.Slidoffs;\n      const sliderSize = gadget.Slidsize;\n\n      switch (kind) {\n        case \"GAD_GFX\":\n          const textures = await this.spriteLoader.getTextures(\n            `TOOLS/${blockNumMapping.get(blockNr)}`\n          );\n\n          const defaultTexture = textures.get(gfx);\n          const activeTexture = textures.get(gfx + pressOff);\n\n          const sprite = !isSlider\n            ? new PIXI.Sprite(defaultTexture)\n            : new SliderSprite(defaultTexture);\n          sprite.position.set(position.x, position.y);\n          sprite.name = `menu-${id}`;\n\n          if (isSlider) {\n            (sprite as SliderSprite).setSliderData(\n              size.y,\n              sliderOffset[1],\n              sliderSize[1]\n            );\n          }\n\n          if (selectable) {\n            sprite.buttonMode = true;\n            sprite.interactive = true;\n            const callback = config.buttons[selectableCount];\n\n            if (isRadioButton) {\n              if (radioButtons.length === 0) {\n                // The first radio button is active at the start.\n                sprite.texture = activeTexture;\n              }\n              radioButtons.push({ sprite, activeTexture, defaultTexture });\n            }\n\n            sprite.on(\"mousedown\", () => {\n              sprite.texture = activeTexture;\n              if (isRadioButton) {\n                // If this IS a radio button, make all other radio buttons inactive.\n                for (const button of radioButtons) {\n                  if (button.sprite !== sprite) {\n                    button.sprite.texture = button.defaultTexture;\n                  }\n                }\n              }\n              callback(this.stage);\n            });\n\n            if (!isRadioButton) {\n              // If this is NOT a radio button, go back to normal state on mouse up.\n              sprite.on(\"mouseup\", () => (sprite.texture = defaultTexture));\n            }\n\n            selectableCount++;\n          }\n          this.stage.addChild(sprite);\n          break;\n        case \"GAD_TEXTL\":\n          // case \"GAD_TEXTR\":\n          // case \"GAD_TEXTFL\":\n          // case \"GAD_TEXTZ\":\n          const fontSize = 24;\n          const text = new PIXI.extras.BitmapText(\"Here goes text!\", {\n            font: { name: \"ZEI20V\", size: fontSize }\n          });\n          text.position.set(position.x, position.y);\n          text.pivot.set(0, fontSize);\n          text.name = `menu-${id}`;\n          text.hitArea = new PIXI.Rectangle(0, 0, size.x, size.y);\n          this.stage.addChild(text);\n          break;\n        default:\n          console.warn(`Unsupported kind: ${kind}`);\n      }\n    }\n\n    await config.onLoad(this.stage);\n  }\n\n  public renderVideo(videoSprite: PIXI.Sprite, onEnd: () => void) {\n    // @ts-ignore\n    const videoTexture: VideoBaseTexture = videoSprite.texture.baseTexture;\n    videoTexture.source.addEventListener(\n      \"ended\",\n      () => {\n        this.stage.removeChild(videoSprite);\n        onEnd();\n      },\n      { once: true }\n    );\n    this.stage.addChild(videoSprite);\n    this.videos.push(videoSprite);\n  }\n\n  public renderVideoFullscreen(videoSprite: PIXI.Sprite, onEnd: () => void) {\n    this.destroyVideos();\n    this.stage.removeChildren();\n\n    // @ts-ignore\n    const videoTexture: VideoBaseTexture = videoSprite.texture.baseTexture;\n    videoTexture.source.addEventListener(\n      \"ended\",\n      () => {\n        this.stage.removeChild(videoSprite);\n        onEnd();\n      },\n      { once: true }\n    );\n\n    videoSprite.scale.set(2, 2);\n\n    // TODO: For some reason, this.stage.width/height are way to small.\n    const x =\n      /*this.stage.width*/ 1024 / 2 -\n      (videoSprite.texture.width * videoSprite.scale.x) / 2;\n    const y =\n      /*this.stage.height*/ 768 / 2 -\n      (videoSprite.texture.height * videoSprite.scale.y) / 2;\n    videoSprite.position.set(x, y);\n\n    this.stage.addChild(videoSprite);\n  }\n\n  private destroyVideos() {\n    this.videos.forEach(video =>\n      video.destroy({ texture: true, baseTexture: true })\n    );\n    this.videos = [];\n  }\n}\n","import { Castle } from \"./castle\";\nimport { City } from \"./city\";\nimport { Island } from \"./island\";\nimport { Kontor } from \"./kontor\";\nimport { Player } from \"./player\";\nimport { Producer } from \"./producer\";\nimport { Ship } from \"./ship\";\nimport { Soldier } from \"./soldier\";\nimport { Task } from \"./task\";\nimport { Timers } from \"./timers\";\nimport { Trader } from \"./trader\";\n\nexport type Rotation4 = 0 | 1 | 2 | 3;\nexport type Rotation8 = 0 | 1 | 2 | 3 | 4 | 5 | 6 | 7;\n\nexport enum SimulationSpeed {\n  Paused = 0,\n  Default = 1,\n  Slow = Default,\n  Medium = 2,\n  Fast = 4,\n  SuperFast = 8\n}\n\nexport default class World {\n  constructor(\n    public readonly islands: Island[],\n    public readonly players: Player[],\n    public readonly tasks: Task[],\n    public readonly gameName: string,\n    public readonly soldiers: Soldier[],\n    public readonly ships: Ship[],\n    public readonly kontors: Kontor[],\n    public readonly castles: Castle[],\n    public readonly cities: City[],\n    public readonly trader: Trader | null,\n    public readonly timers: Timers,\n    public readonly producers: Producer[]\n  ) {\n    console.table(tasks);\n    console.log(gameName);\n    console.table(islands);\n    console.table(players);\n    console.table(soldiers);\n    console.table(ships);\n    console.table(kontors);\n    console.table(castles);\n    console.table(cities);\n    console.log(trader);\n    console.log(timers);\n    console.table(producers);\n  }\n}\n","/*\n * The savegame data structure was reverse-engineered by Benedikt Freisen\n * as part of the 'mdcii-engine' project and released under GPLv2+.\n * https://github.com/roybaer/mdcii-engine\n */\n\nimport Stream from \"../../parsers/stream\";\nimport assert from \"../../util/assert\";\n\nexport type Timers = ReturnType<typeof timersFromSaveGame>;\n\nexport function timersFromSaveGame(data: Stream) {\n  const cntCity = data.read8();\n  const cntIsland = data.read8();\n  const cntShipyard = data.read8();\n  const cntMilitary = data.read8();\n  const cntProduction = data.read8();\n  assert(data.read(31 + 32).every(e => e === 0));\n  const cntSettlers = data.read(32);\n  const cntGrowth = data.read(32);\n\n  const timeCity = data.read32();\n  const timeIsland = data.read32();\n  const timeShipyard = data.read32();\n  const timeMilitary = data.read32();\n  const timeProduction = data.read32();\n  const timeGoodToolsCnt = data.read32();\n  const timeGoodToolsMax = data.read32();\n  const timeGame = data.read32();\n\n  const noErzOutFlg = data.read8();\n  const tutorFlg = data.read8();\n  const aiLevel = data.read8();\n  const missionNumber = data.read8();\n\n  const flags = data.read32();\n  const enableTrader = (flags & (1 << 6)) === 0;\n  const bigIronRunsOut = (flags & (1 << 3)) === 0;\n  const enableDroughts = (flags & (1 << 2)) === 0; // TODO: Does not appear to be working for endless games.\n  const enablePirate = (flags & (1 << 0)) === 0;\n  const enableVulcano = (flags & (1 << 8)) === 0;\n\n  const gameId = data.read32();\n  const cityNameNumber = data.read32();\n  const timeNextDrought = data.read32();\n  const timePirateSec = data.read32();\n  const missionSubNumber = data.read32();\n  const shipMax = data.read32();\n\n  // vulcano\n  data.read(4);\n  // vulcano 2\n  data.read(4);\n\n  const timeNextVulcano = data.read32();\n  const cntVulcano = data.read32();\n\n  data.read(17 + 32, 4);\n  // assert(data.read(17 + 32, 4).every((e) => e === 0));\n  const timeSettlers = data.read(32, 4);\n  const timeGrowth = data.read(32, 4);\n\n  const timers = {\n    cntCity,\n    cntIsland,\n    cntShipyard,\n    cntMilitary,\n    cntProduction,\n    cntSettlers,\n    cntGrowth,\n    timeCity,\n    timeIsland,\n    timeShipyard,\n    timeMilitary,\n    timeProduction,\n    timeGoodToolsCnt,\n    timeGoodToolsMax,\n    timeGame,\n    noErzOutFlg,\n    tutorFlg,\n    aiLevel,\n    missionNumber,\n    gameId,\n    cityNameNumber,\n    timeNextDrought,\n    timePirateSec,\n    missionSubNumber,\n    shipMax,\n    timeNextVulcano,\n    cntVulcano,\n    timeSettlers,\n    timeGrowth,\n    enableTrader,\n    bigIronRunsOut,\n    enableDroughts,\n    enablePirate,\n    enableVulcano\n  };\n  console.log(timers);\n\n  return timers;\n}\n","import * as PIXI from \"pixi.js\";\nimport FileSystem from \"../filesystem\";\nimport { textureFromUint8ArrayMP4 } from \"../util/pixi\";\nimport GADRenderer from \"./gad-renderer\";\nimport Missions from \"./menu/missions\";\nimport MusicPlayer from \"./music-player\";\n\ntype Callback = (stage: PIXI.Container) => void;\n\nexport interface ScreenConfig {\n  onLoad: Callback;\n  buttons: Callback[];\n}\n\nexport default class MenuStructure extends PIXI.utils.EventEmitter {\n  private readonly structure: { [k: string]: ScreenConfig } = {\n    menu_main: {\n      onLoad: () => this._playMainMenuMusic(),\n      buttons: [\n        async () => this.renderScreen(\"menu_missions\"),\n        async () => console.log(\"Multiplayer\"),\n        async () => {\n          // Credits\n          this.musicPlayer.stop();\n          const videoSprite = await this.loadVideoSprite(10);\n          videoSprite.width = 453 - 14;\n          videoSprite.height = 367 - 14;\n          videoSprite.position.set(500 + 7, 359 + 7);\n          this.gadRenderer.renderVideo(\n            videoSprite,\n            () => this._playMainMenuMusic\n          );\n        },\n        async () => {\n          // Intro\n          const videoSprite = await this.loadVideoSprite(58);\n          this.musicPlayer.stop();\n          this.gadRenderer.renderVideoFullscreen(videoSprite, () =>\n            this.renderScreen(\"menu_main\")\n          );\n        },\n        async () => console.log(\"Exit\")\n      ]\n    },\n    menu_missions: new Missions(this.fs, this),\n    menu_loading: {\n      onLoad: () => {\n        // Nothing to do\n      },\n      buttons: []\n    },\n    menu_mission_details: {\n      onLoad: () => {\n        // Nothing to do\n      },\n      buttons: [\n        async () => console.log(\"Start Mission\"),\n        async () => this.renderScreen(\"menu_missions\"),\n        async () => console.log(\"Highscores up\"),\n        async () => console.log(\"Highscores down\"),\n        async () => console.log(\"Sub-Mission 0\"),\n        async () => console.log(\"Sub-Mission 1\"),\n        async () => console.log(\"Sub-Mission 2\"),\n        async () => console.log(\"Sub-Mission 3\"),\n        async () => console.log(\"Sub-Mission 4\"),\n        async () => console.log(\"Mission Description up\"),\n        async () => console.log(\"Mission Description down\"),\n        async () => console.log(\"Mission Description Slider\")\n      ]\n    }\n  };\n\n  constructor(\n    private readonly fs: FileSystem,\n    private readonly gadRenderer: GADRenderer,\n    private readonly musicPlayer: MusicPlayer\n  ) {\n    super();\n  }\n\n  public async renderScreen(screen: string) {\n    const data = JSON.parse(\n      await this.fs.openAndGetContentAsText(`/screens/${screen}.json`)\n    );\n    console.log(data);\n    const config = this.structure[screen];\n    await this.gadRenderer.render(data, config);\n  }\n\n  public _playMainMenuMusic() {\n    this.musicPlayer.play(\"1st Beginning\", true);\n  }\n\n  private async loadVideoSprite(videoNumber: number) {\n    const videoData = await this.fs.openAndGetContentAsUint8Array(\n      `/videos/${videoNumber}.mp4`\n    );\n    const texture = await textureFromUint8ArrayMP4(videoData);\n    return PIXI.Sprite.from(texture);\n  }\n}\n","enum GAME {\n  // TODO Add more translations\n  \"menu.divider.orginal_missions\" = 85,\n  \"menu.divider.missions\" = 86,\n  \"menu.divider.new_missions\" = 87,\n  \"menu.divider.custom_missions\" = 88,\n  \"exit_game\" = 89,\n  \"exit_game_question\" = 90\n}\n\n// TODO: [LEISTE]\nenum LEISTE {}\n\nenum PLAYCOL {\n  \"player.color.red\",\n  \"player.color.blue\",\n  \"player.color.yellow\",\n  \"player.color.white\" = 3\n}\n\nenum VIDEOKIND {\n  \"videos.event\",\n  \"videos.battle\",\n  \"videos.diplomacy\"\n}\n\nenum SPEECHKIND {\n  \"speech.event\",\n  \"speech.island_status\",\n  \"speech.player\",\n  \"speech.trade\",\n  \"speech.battle\",\n  \"speech.order\",\n  \"speech.diplomacy\"\n}\n\n// Ignore [ERROR]\n\nenum PATH {\n  \"path.custom_missions\"\n}\n\nenum ENDLESSKIND {\n  \"endless.difficulty.easy\",\n  \"endless.difficulty.medium\",\n  \"endless.difficulty.difficult\",\n  \"endless.difficulty.hard\"\n}\n\nenum TUTORKIND {\n  \"tutorial.mission_0\",\n  \"tutorial.mission_1\",\n  \"tutorial.mission_2\",\n  \"tutorial.mission_3\",\n  \"tutorial.mission_4\"\n}\n\nenum KAMPAGNE {\n  \"campaign.0.mission_0\",\n  \"campaign.0.mission_1\",\n  \"campaign.0.mission_2\",\n  \"campaign.0.mission_3\",\n  \"campaign.0.mission_4\",\n\n  \"campaign.1.mission_0\",\n  \"campaign.1.mission_1\",\n  \"campaign.1.mission_2\",\n  \"campaign.1.mission_3\",\n  \"campaign.1.mission_4\",\n\n  \"campaign.2.mission_0\",\n  \"campaign.2.mission_1\",\n  \"campaign.2.mission_2\",\n  \"campaign.2.mission_3\",\n  \"campaign.2.mission_4\",\n\n  \"campaign.3.mission_0\",\n  \"campaign.3.mission_1\",\n  \"campaign.3.mission_2\",\n  \"campaign.3.mission_3\",\n  \"campaign.3.mission_4\",\n\n  \"campaign.4.mission_0\",\n  \"campaign.4.mission_1\",\n  \"campaign.4.mission_2\",\n  \"campaign.4.mission_3\",\n  \"campaign.4.mission_4\",\n\n  \"campaign.5.mission_0\",\n  \"campaign.5.mission_1\",\n  \"campaign.5.mission_2\",\n  \"campaign.5.mission_3\",\n  \"campaign.5.mission_4\"\n}\n\nenum FIGKIND {\n  \"figure.unused\",\n  \"figure.infantry\",\n  \"figure.cavalry\",\n  \"figure.musketeer\",\n  \"figure.artiellery\"\n}\n\nenum WARE {\n  \"good.empty\",\n  \"good.each\",\n  \"good.iron_ore\",\n  \"good.gold_ore\",\n  \"good.wool\",\n  \"good.sugarcane\",\n  \"good.tobacco\",\n  \"good.cattle\",\n  \"good.grain\",\n  \"good.flour\",\n  \"good.iron\",\n  \"good.swords\",\n  \"good.muskets\",\n  \"good.cannons\",\n  \"good.food\",\n  \"good.tobacco_products\",\n  \"good.spices\",\n  \"good.cocoa\",\n  \"good.liquor\",\n  \"good.cloth\",\n  \"good.clothes\",\n  \"good.jewlry\",\n  \"good.tools\",\n  \"good.wood\",\n  \"good.bricks\"\n}\n\n// Ignore WAREM\n\nenum ROHST {\n  \"rohst.grain\",\n  \"rohst.tobacco\",\n  \"rohst.spices\",\n  \"rohst.sugarcane\",\n  \"rohst.cotton\",\n  \"rohst.vines\",\n  \"rohst.cocoa\",\n  \"rohst.grazing_land\",\n  \"rohst.tree\",\n  \"rohst.stones\",\n  \"rohst.ores\",\n  \"rohst.wild_game\",\n  \"rohst.fish\"\n}\n\nenum ROHSTFELD {\n  \"rohst_field.grain\",\n  \"rohst_field.tobacco\",\n  \"rohst_field.spices\",\n  \"rohst_field.sugarcane\",\n  \"rohst_field.cotton\",\n  \"rohst_field.vines\",\n  \"rohst_field.cocoa\",\n  \"rohst_field.grazing_land\",\n  \"rohst_field.tree\",\n  \"rohst_field.stones\",\n  \"rohst_field.ores\",\n  \"rohst_field.wild_game\",\n  \"rohst_field.fish\"\n}\n\nenum MILITAR {\n  \"buildings.military.wooden.wall\",\n  \"buildings.military.wooden.gate\",\n  \"buildings.military.wooden.watchtower\",\n  \"buildings.military.stone.wall\",\n  \"buildings.military.stone.gate\",\n  \"buildings.military.stone.watchtower\",\n  \"buildings.military.stone.gate_big\",\n  \"buildings.military.castle.small\",\n  \"buildings.military.castle.medium\",\n  \"buildings.military.castle.large\"\n}\n\nenum WOHNHAUS {\n  \"buildings.house.house\"\n}\n\nenum STRASSE {\n  \"buildings.street.dirt.street\",\n  \"buildings.street.stone.street\",\n  \"buildings.street.dirt.bridge\",\n  \"buildings.street.stone.bridge\",\n  \"buildings.street.square.0\",\n  \"buildings.street.square.1\",\n  \"buildings.street.square.2\",\n  \"buildings.street.square.3\"\n}\n\nenum BERGWERK {\n  \"buildings.mine.quarry\",\n  \"buildings.mine.iron\",\n  \"buildings.mine.iron_deep\",\n  \"buildings.mine.gold\"\n}\n\nenum HANDWERK {\n  \"buildings.production.weaver\",\n  \"buildings.production.butcher\",\n  \"buildings.production.flour_mill\",\n  \"buildings.production.bakery\",\n  \"buildings.production.tobacco\",\n  \"buildings.production.distillery\",\n  \"buildings.production.tailor\",\n  \"buildings.production.weaving_mill\",\n  \"buildings.production.stonemason\",\n  \"buildings.production.water_mill\",\n  \"buildings.production.ore_smelter\",\n  \"buildings.production.tool_maker\",\n  \"buildings.production.gold_smith\",\n  \"buildings.production.armourer\",\n  \"buildings.production.musket_maker\",\n  \"buildings.production.canon_foundry\"\n}\n\nenum FARM {\n  \"buildings.farm.hunter\",\n  \"buildings.farm.forester\",\n  \"buildings.field.forest\",\n  \"buildings.farm.grain\",\n  \"buildings.field.grain\",\n  \"buildings.farm.sheep\",\n  \"buildings.farm.cattle\",\n  \"buildings.farm.tobacco\",\n  \"buildings.field.tobacco\",\n  \"buildings.farm.spice\",\n  \"buildings.field.spice\",\n  \"buildings.farm.wine\",\n  \"buildings.field.wine\",\n  \"buildings.farm.sugarcane\",\n  \"buildings.field.sugarcane\",\n  \"buildings.farm.cotton\",\n  \"buildings.field.cotton\",\n  \"buildings.farm.cocoa\",\n  \"buildings.field.cocoa\"\n}\n\nenum HAFEN {\n  \"buildings.docks.warehouse.0\",\n  \"buildings.docks.warehouse.1\",\n  \"buildings.docks.warehouse.2\",\n  \"buildings.docks.warehouse.3\",\n  \"buildings.docks.fisher\",\n  \"buildings.docks.dock\",\n  \"buildings.docks.shipyard.small\",\n  \"buildings.docks.shipyard.large\"\n}\n\nenum DIVERS {\n  \"buildings.public.house\",\n  \"buildings.public.marketplace\",\n  \"buildings.public.chapel\",\n  \"buildings.public.church\",\n  \"buildings.public.cathedral\",\n  \"buildings.public.tavern\",\n  \"buildings.public.doctor\",\n  \"buildings.public.school\",\n  \"buildings.public.college\",\n  \"buildings.public.bathhouse\",\n  \"buildings.public.theater\",\n  \"buildings.public.firefighters\",\n  \"buildings.public.palace\",\n  \"buildings.public.gallows\",\n  \"buildings.public.monument\",\n  \"buildings.public.triumphal_arch\"\n}\n\nenum ABRISS {\n  \"demolish\"\n}\n\nenum LANDSCHAFT {\n  \"natives.0.head_lodge\",\n  \"natives.0.hut.0\",\n  \"natives.0.hut.1\",\n  \"natives.0.hut.2\",\n  \"natives.0.hut.3\",\n  \"natives.1.head_lodge\",\n  \"natives.1.hut.0\",\n  \"natives.1.hut.1\",\n  \"natives.1.hut.2\",\n  \"natives.1.hut.3\",\n  \"natives.pyramid\",\n  \"pirates.warehouse\",\n  \"pirates.1\",\n  \"pirates.2\",\n  \"pirates.tower\",\n  \"forest.mixed\",\n  \"forest.palm\"\n}\n\n// Ignore [BUBBLES]\n\n// Ignore [TUTOR]\n\n// Ignore [MELDUNG]\n\n// Ignore [STAEDTE]\n\n// Ignore [SHIPS]\n\n// Ignore [DEMO]\n\nconst lookup = {\n  GAME,\n  LEISTE,\n  PATH,\n  ENDLESSKIND,\n  PLAYCOL,\n  VIDEOKIND,\n  SPEECHKIND,\n  TUTORKIND,\n  KAMPAGNE,\n  FIGKIND,\n  WARE,\n  ROHST,\n  ROHSTFELD,\n  MILITAR,\n  WOHNHAUS,\n  STRASSE,\n  BERGWERK,\n  HANDWERK,\n  FARM,\n  HAFEN,\n  DIVERS,\n  ABRISS,\n  LANDSCHAFT\n};\n\nexport default lookup;\n\ntype GetKeys<U> = U extends Record<infer K, any> ? K : never;\ntype UnionToIntersection<U extends object> = {\n  [K in GetKeys<U>]: U extends Record<K, infer T> ? T : never\n};\nexport type TranslationKeys = keyof UnionToIntersection<\n  (typeof lookup)[keyof typeof lookup]\n>;\n\nexport type TranslationDomain = keyof typeof lookup;\n","import FileSystem from \"../filesystem\";\nimport lookup, { TranslationKeys } from \"./translations\";\n\nconst translations: Map<TranslationKeys, string> = new Map();\n\nexport default function t(key: TranslationKeys): string {\n  return translations.get(key);\n}\n\nexport async function loadTranslations(fs: FileSystem) {\n  const jsonData = JSON.parse(\n    await fs.openAndGetContentAsText(\"/translations.json\")\n  );\n  for (const domain of Object.keys(jsonData)) {\n    const keyToIdxMapping = (lookup as any)[domain];\n\n    for (const translationIdx in keyToIdxMapping) {\n      if (parseInt(translationIdx, 10) >= 0) {\n        const translationKey = keyToIdxMapping[translationIdx];\n        translations.set(translationKey, jsonData[domain][translationIdx]);\n      }\n    }\n  }\n}\n","/*\n * The savegame data structure was reverse-engineered by Benedikt Freisen\n * as part of the 'mdcii-engine' project and released under GPLv2+.\n * https://github.com/roybaer/mdcii-engine\n */\n\nimport Stream from \"../../parsers/stream\";\nimport assert from \"../../util/assert\";\n\nexport enum CourseState {\n  Stopped = 0x00,\n  Sailing = 55,\n  Unknown = 53,\n  Unknown2 = 52,\n  Unknown3 = 54,\n  Unknown4 = 51\n}\n\nexport class ShipCourse {\n  public static fromSaveGame(data: Stream) {\n    const num = data.read32();\n    const byte1 = (num >> 0) & 0xff;\n    const byte2 = (num >> 8) & 0xff;\n    const byte3 = (num >> 16) & 0xff;\n    const byte4 = (num >> 24) & 0xff;\n\n    const state: CourseState = byte1;\n    assert(state in CourseState);\n\n    const position = new PIXI.Point(\n      byte4 + ((byte2 & 0b00001111) << 8),\n      byte3 + ((byte2 & 0b11110000) << 4)\n    );\n\n    return new ShipCourse(position, state);\n  }\n\n  constructor(\n    public readonly position: PIXI.Point,\n    public readonly state: CourseState\n  ) {}\n}\n","import { JSZipObject } from \"jszip\";\n\nexport default class Stream {\n  public static async fromZipObject(zip: JSZipObject) {\n    const data = await zip.async(\"uint8array\");\n\n    return new Stream(data);\n  }\n\n  private pos: number;\n  private readonly data: Uint8Array;\n\n  public constructor(data: Uint8Array) {\n    this.pos = 0;\n    this.data = data;\n  }\n\n  get length(): number {\n    return this.data.length;\n  }\n\n  public position(): number {\n    return this.pos;\n  }\n\n  public seek(pos: number) {\n    this.pos = pos;\n  }\n\n  public readString(length: number) {\n    let result = \"\";\n    let done = false;\n    while (length--) {\n      const character = this.read8();\n      if (done || character === 0) {\n        done = true;\n        continue;\n      }\n      result += String.fromCharCode(character);\n    }\n\n    return result;\n  }\n\n  public readStringUnterminated(length: number) {\n    let result = \"\";\n    while (length--) {\n      result += String.fromCharCode(this.read8());\n    }\n\n    return result;\n  }\n\n  public read(length: number, size: number = 1) {\n    length *= size;\n    const result = [];\n    while (length > 0) {\n      result.push(this.readNBytes(size));\n      length -= size;\n    }\n    return result;\n  }\n\n  public slice(length: number) {\n    const data = this.data.slice(this.pos, this.pos + length);\n    this.pos += length;\n    return data;\n  }\n\n  public read16() {\n    return this.readNBytes(2);\n  }\n\n  public read24() {\n    return this.readNBytes(3);\n  }\n\n  public read32() {\n    return this.readNBytes(4);\n  }\n\n  public read32S(): number {\n    return this.readNBytes(4) >> 0;\n  }\n\n  public read64() {\n    return this.readNBytes(8);\n  }\n\n  public read8() {\n    return this.data[this.pos++];\n  }\n\n  public eof() {\n    return this.pos === this.length;\n  }\n\n  public read8Bool(): boolean {\n    return this.read8() !== 0;\n  }\n\n  private readNBytes(n: number) {\n    let result = 0;\n    for (let i = 0; i < n; i++) {\n      result += this.read8() * 2 ** (i * 8);\n    }\n    return result;\n  }\n}\n","import { decode as iconv_decode, encode as iconv_encode } from \"iconv-lite\";\nimport Stream from \"../stream\";\n\nexport default class CODParser {\n  private encoding = \"win1252\";\n\n  public decrypt(data: Stream): string {\n    const decryptedBytes = new Buffer(data.length);\n    for (let i = 0; i < data.length; i++) {\n      decryptedBytes[i] = 256 - data.read8();\n    }\n\n    // Decode the bytes using Windows 1252 \"Western\" encoding.\n    // The resulting string will then be written in UTF-8 format.\n    return iconv_decode(decryptedBytes, this.encoding);\n  }\n\n  public encrypt(content: string): Uint8Array {\n    const file = new Stream(iconv_encode(content, this.encoding));\n    const encryptedBytes = new Buffer(file.length);\n    for (let i = 0; i < file.length; i++) {\n      encryptedBytes[i] = 256 - file.read8();\n    }\n\n    return encryptedBytes;\n  }\n}\n","/*\n * The savegame data structure was reverse-engineered by Benedikt Freisen\n * as part of the 'mdcii-engine' project and released under GPLv2+.\n * https://github.com/roybaer/mdcii-engine\n */\n\nimport Stream from \"../../parsers/stream\";\nimport assert from \"../../util/assert\";\n\nexport type Producer = ReturnType<typeof producerFromSaveGame>;\n\nexport function producerFromSaveGame(data: Stream) {\n  const islandId = data.read8();\n  const position = new PIXI.Point(data.read8(), data.read8());\n  const speed = data.read8();\n  const speedCount = data.read8();\n  const stock = data.read24();\n  const timer = data.read16();\n  const secondGoodStock = data.read16();\n  const firstGoodStock = data.read24();\n  const producedGood = data.read8();\n  const prodCnt = data.read16();\n  const timeCnt = data.read16();\n  const flags1 = data.read8();\n\n  const active = (flags1 & (1 << 0)) > 0;\n  const connectedToMarket = (flags1 & (1 << 1)) > 0;\n  const animCnt = (flags1 >> 2) & 0b1111;\n  const allowGoodPickup = (flags1 & (1 << 6)) === 0;\n  const noGoodCnt = data.read8() & 0b1111;\n  assert(data.read16() === 0);\n\n  return {\n    islandId,\n    position,\n    speed,\n    speedCount,\n    stock,\n    timer,\n    secondGoodStock,\n    firstGoodStock,\n    producedGood,\n    prodCnt,\n    timeCnt,\n    active,\n    connectedToMarket,\n    animCnt,\n    allowGoodPickup,\n    noGoodCnt\n  };\n}\n","/*\n * The savegame data structure was reverse-engineered by Benedikt Freisen\n * as part of the 'mdcii-engine' project and released under GPLv2+.\n * https://github.com/roybaer/mdcii-engine\n */\n\nimport Stream from \"../../parsers/stream\";\nimport assert from \"../../util/assert\";\nimport { Rotation4 } from \"./world\";\n\nexport default class Field {\n  public static saveGameDataLength = 8;\n\n  public static fromSaveGame(data: Stream) {\n    const buildingId = data.read16() + 20000;\n    const x = data.read8();\n    const y = data.read8();\n    const bits = data.read32();\n\n    const rotation = (bits >> 0) & (2 ** 2 - 1);\n    const animation = (bits >> 2) & (2 ** 4 - 1);\n    const islandId = (bits >> 6) & (2 ** 8 - 1);\n    const islandCityNum = (bits >> 14) & (2 ** 3 - 1);\n    const random = (bits >> 17) & (2 ** 5 - 1);\n    const playerId = (bits >> 22) & (2 ** 4 - 1);\n    const empty = (bits >> 26) & (2 ** 6 - 1);\n    if (empty !== 0) {\n      // empty is sometimes 51.\n      // console.warn(`Expected 0, got ${empty}.`);\n    }\n\n    return new Field(\n      buildingId,\n      x,\n      y,\n      islandId,\n      islandCityNum,\n      rotation as Rotation4,\n      animation,\n      random,\n      playerId\n    );\n  }\n\n  constructor(\n    public fieldId: number,\n    public x: number,\n    public y: number,\n    public islandId: number,\n    public islandCityNum: number,\n    public rotation: Rotation4,\n    public ani: number,\n    public random: number,\n    public playerId: number\n  ) {}\n}\n","import { loadFFmpeg } from \"../../util/ffmpeg\";\n\ninterface FileInfo {\n  data: Uint8Array;\n  name: string;\n}\n\nexport default class SMKParser {\n  private ffmpeg: any;\n\n  public async parse(data: Uint8Array): Promise<Uint8Array> {\n    this.ffmpeg = await loadFFmpeg();\n\n    const inputFiles = [{ data, name: \"input.smk\" }];\n    try {\n      const args = this.prepareArguments(true);\n      return await this.convert(args, inputFiles);\n    } catch (e) {\n      if (e.message === \"only-one-audio-stream\") {\n        try {\n          const args = this.prepareArguments(false);\n          return await this.convert(args, inputFiles);\n        } catch (e) {\n          throw e;\n        }\n      } else {\n        throw e;\n      }\n    }\n  }\n\n  private prepareArguments(mergeAudio: boolean) {\n    const args = [\"-i\", \"input.smk\"];\n    if (mergeAudio) {\n      args.push(\n        ...[\n          \"-filter_complex\",\n          \"[0:a]amerge[c]\", // merge all audio streams into [c]\n          \"-map\",\n          \"[c]\", // use merged audio stream\n          \"-map\",\n          \"0:v:0\" // pass through first video stream\n        ]\n      );\n    }\n    args.push(\n      ...[\n        \"-ac\",\n        \"2\", // use stereo audio\n\n        // H.264 options\n        // https://trac.ffmpeg.org/wiki/Encode/H.264\n        \"-c:v\",\n        \"libx264\",\n        \"-pix_fmt\",\n        \"yuv420p\", // older pix_fmt required for Firefox\n        \"-preset\",\n        \"ultrafast\", // faster encoding, but bigger filesize\n        \"-movflags\",\n        \"+faststart\", // faster loading\n        \"output.mp4\"\n        // \"output.ogg\", // I wish I could use the free ogg format instead of mp4.\n      ]\n    );\n\n    return args;\n  }\n\n  private async convert(args: string[], inputFiles: FileInfo[]) {\n    console.log(`Converting video with arguments ${args.join(\" \")}`);\n\n    return new Promise<Uint8Array>((resolve, reject) => {\n      let output = \"\";\n      const handleOutput = (str: string) => {\n        output += str + \"\\n\";\n        console.log(str);\n      };\n      this.ffmpeg({\n        // apt update && apt -y install binutils pkg-config && cd /src/build && ./build_lgpl.sh\n        arguments: args,\n        files: inputFiles,\n        print: handleOutput,\n        printErr: handleOutput,\n        stdin: () => {\n          // Do nothing. This prevents the browser from \"prompt\"ing the user for input.\n        },\n        TOTAL_MEMORY: 100_000_000,\n        returnCallback: (files: FileInfo[]) => {\n          if (\n            output.includes(\n              \"Cannot find a matching stream for unlabeled input pad 1\"\n            )\n          ) {\n            reject(new Error(\"only-one-audio-stream\"));\n          } else if (files.length !== 1) {\n            reject(new Error(\"unknown-error\"));\n          } else {\n            resolve(new Uint8Array(files[0].data));\n          }\n        }\n      });\n    });\n  }\n}\n","/*\n * The savegame data structure was reverse-engineered by Benedikt Freisen\n * as part of the 'mdcii-engine' project and released under GPLv2+.\n * https://github.com/roybaer/mdcii-engine\n */\n\nimport Stream from \"../../parsers/stream\";\nimport assert from \"../../util/assert\";\nimport Contract from \"./contract\";\nimport PlayerEvent from \"./player-event\";\n\nexport enum PlayerKind {\n  HUMAN = 0,\n  AI = 9,\n  TRADER = 13,\n  PIRATE = 14,\n  NATIVE = 11\n}\n\nexport type Player = ReturnType<typeof playerFromSaveGame>;\n\nexport function playerFromSaveGame(data: Stream) {\n  const money = data.read32S();\n  const kind: PlayerKind = data.read8();\n  const id = data.read8();\n  const humanPlayerCount = data.read8(); // unsure\n  const color = data.read8();\n  const killedByPlayerId = data.read8(); // killedByPlayerId\n  assert(data.read8() === 0);\n  const _3_3 = data.read16(); // unsure, time since no ships and cities\n  const assignedTaskId = data.read8(); // Can be 0, 1, 2, 3 or 0xFF (no task assigned)\n  const _3_2 = data.read8(); // unsure, may not be played by human\n  const palaceBuilt = data.read8Bool();\n  const cathedralBuilt = data.read8Bool();\n\n  const enemiesDefeated = data.read16();\n  const triumphArchesBuilt = data.read16();\n  const soldiersKilled = data.read16();\n  const soldiersFallen = data.read16();\n  const shipsSunken = data.read16();\n  const shipsKilled = data.read16();\n  const _4 = data.read8();\n  const flags = data.read8();\n  const enablePositiveWillInfluence = (flags & (1 << 0)) > 0;\n  const enableNegativeWillInfluence = (flags & (1 << 1)) > 0;\n  const _5 = data.read(6);\n  const positiveWillInfluence = data.read8() / 32.0 + 1.0; // Between 1.0 and 5.0\n  const negativeWillInfluence = data.read8() / 32.0 + 1.0; // Between 1.0 and 5.0\n  assert(data.read(14).every(e => e === 0));\n  const accessibleBuildings = data.read32();\n  const statues = data.read16();\n  const statuesBuilt = data.read16();\n  const tmp = data.read32();\n  assert(tmp === 0xffffffff);\n\n  const _8 = data.read(264);\n  const tradeContracts = [];\n  for (let i = 0; i < 3; i++) {\n    tradeContracts.push(Contract.fromSaveGame(data));\n  }\n  const peaceContracts = [];\n  for (let i = 0; i < 3; i++) {\n    peaceContracts.push(Contract.fromSaveGame(data));\n  }\n\n  const _9 = data.read(72);\n\n  const playerEvents = [];\n  for (let i = 0; i < 64; i++) {\n    playerEvents.push(PlayerEvent.fromSaveGame(data));\n  }\n\n  const fullName = data.readString(64);\n  const shortName = data.readString(48); // Only used in multiplayer\n\n  console.log(`player ${id}:  `, killedByPlayerId, _3_3, _3_2, _4, _5); // , _8, _9);\n\n  return {\n    id,\n    kind,\n    color,\n    fullName,\n    shortName,\n    tradeContracts,\n    peaceContracts,\n    money,\n    enemiesDefeated,\n    triumphArchesBuilt,\n    soldiersKilled,\n    soldiersFallen,\n    shipsSunken,\n    shipsKilled,\n    accessibleBuildings,\n    statues,\n    statuesBuilt,\n    palaceBuilt,\n    cathedralBuilt,\n\n    enablePositiveWillInfluence,\n    enableNegativeWillInfluence,\n    positiveWillInfluence,\n    negativeWillInfluence,\n\n    assignedTaskId,\n\n    playerEvents\n  };\n}\n","import FileSystem from \"../filesystem\";\nimport FieldType from \"./field-type\";\n\nexport default class ConfigLoader {\n  private loaded = false;\n  private fieldConfig: any;\n\n  constructor(private readonly fs: FileSystem) {}\n\n  public async load() {\n    this.fieldConfig = JSON.parse(\n      await this.fs.openAndGetContentAsText(\"/fields.json\")\n    );\n    this.loaded = true;\n  }\n\n  public getFieldData(): ReadonlyMap<number, FieldType> {\n    const fields = new Map();\n    const fieldData = this.getFieldConfig();\n    for (const key of Object.keys(fieldData)) {\n      const fieldId = parseInt(fieldData[key].Id, 10);\n      fields.set(fieldId, new FieldType(fieldData[key]));\n    }\n    return fields;\n  }\n\n  private getFieldConfig() {\n    if (!this.loaded) {\n      throw new Error(\"Configuration is not loaded. Call .load() first!\");\n    }\n    return this.fieldConfig.objects.HAUS.items;\n  }\n}\n","/**\n * Based on the MIT-licensed browser-assert NPM package.\n * Copyright (c) 2015 Social Ally\n */\nexport default function assert(expr: any, message?: string) {\n  if (!Boolean(expr)) {\n    throw new Error(message || \"unknown assertion error\");\n  }\n}\n","/*\n * The savegame data structure was reverse-engineered by Benedikt Freisen\n * as part of the 'mdcii-engine' project and released under GPLv2+.\n * https://github.com/roybaer/mdcii-engine\n */\n\nimport { IslandSizeId } from \"../../parsers/GAM/island-loader\";\nimport Stream from \"../../parsers/stream\";\nimport assert from \"../../util/assert\";\n\nexport interface IslandTemplate {\n  num: number;\n  size: 0 | 1 | 2 | 3 | 4;\n  position: PIXI.Point;\n  climate: \"NORTH\" | \"SOUTH\" | \"ANY\";\n}\n\nexport default class WorldGenerationSettings {\n  public static fromSaveGame(data: Stream) {\n    const _1 = data.slice(100);\n\n    const numNativesNorth = _1[64];\n    const numNativesSouth = _1[68];\n\n    const numIslands = data.read32();\n\n    const _2 = data.slice(268);\n\n    const numBigIronOre = _2[46]; // Erzberg:    ERZBERG_GROSS, 6\n    const numSmallIronOre = _2[54]; // Erzberg:    ERZBERG_KLEIN, 8\n    const numGoldOre = _2[62];\n\n    const numWine = _2[110]; // Ware:       WEINTRAUBEN, 4\n    const numSugarCane = _2[95]; // Ware:       ZUCKERROHR, 3\n    const numSpice = _2[86]; // Ware:       GEWUERZBAUM, 2\n    const numCacao = _2[118]; // Ware:       KAKAOBAUM, 2\n    const numTobacco = _2[78]; // Ware:       TABAKBAUM, 3\n    const numCotton = _2[102]; // Ware:       BAUMWOLLE, 3\n\n    const numTreasures = _2[174]; // Schatz:     10\n\n    const islandTemplates: IslandTemplate[] = [];\n    for (let i = 0; i < numIslands; i++) {\n      const flags = data.read8();\n      const forceNorth = flags === 0;\n      const forceSouth = flags === 1;\n      const islandSize = data.read8(); // 0...4, where 0 is small and 4 is large.\n      if (islandSize < 0 || islandSize > 4) {\n        throw new Error(`Invalid island size category: ${islandSize}.`);\n      }\n      assert(data.read8() === 0x0000);\n      const num = data.read8();\n      const fileNr = data.read32(); // Largely uninteresting, mostly 0x0000FFFF, sometimes 0x00000000\n      const position = new PIXI.Point(data.read32(), data.read32());\n      islandTemplates.push({\n        num,\n        size: islandSize as IslandSizeId,\n        position: position,\n        climate: forceNorth ? \"NORTH\" : forceSouth ? \"SOUTH\" : \"ANY\"\n      });\n    }\n    for (const each of data.slice(data.length - data.position())) {\n      assert(each === 0);\n    }\n\n    // function dbg(arr: Uint8Array) {\n    //    let debug = \"\";\n    //    for (const each of arr) {\n    //        debug += `${each}\\n`;\n    //    }\n    //    console.log(debug);\n    // }\n    // dbg(_1);\n    // dbg(_2);\n\n    return new WorldGenerationSettings(\n      numNativesNorth,\n      numNativesSouth,\n      numBigIronOre,\n      numSmallIronOre,\n      numGoldOre,\n      numWine,\n      numSugarCane,\n      numSpice,\n      numCacao,\n      numTobacco,\n      numCotton,\n      numTreasures,\n      islandTemplates\n    );\n  }\n\n  public static empty() {\n    return new WorldGenerationSettings(0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, []);\n  }\n\n  constructor(\n    public readonly numNativesNorth: number,\n    public readonly numNativesSouth: number,\n    public readonly numBigIronOre: number,\n    public readonly numSmallIronOre: number,\n    public readonly numGoldOre: number,\n    public readonly numWine: number,\n    public readonly numSugarCane: number,\n    public readonly numSpice: number,\n    public readonly numCacao: number,\n    public readonly numTobacco: number,\n    public readonly numCotton: number,\n    public readonly numTreasures: number,\n    public readonly islandTemplates: IslandTemplate[]\n  ) {}\n}\n","/*\n * The savegame data structure was reverse-engineered by Benedikt Freisen\n * as part of the 'mdcii-engine' project and released under GPLv2+.\n * https://github.com/roybaer/mdcii-engine\n */\n\nimport Stream from \"../../parsers/stream\";\nimport assert from \"../../util/assert\";\n\nexport enum OreLocationKind {\n  Iron = 2,\n  Gold = 3\n}\n\nexport enum OreLocationSize {\n  Small = 1,\n  Big = 0\n}\n\nexport class OreLocation {\n  public static fromSaveGame(data: Stream) {\n    const kind = data.read8();\n    const position = new PIXI.Point(data.read8(), data.read8());\n    const discoveredBy = data.read8(); // unsure\n    const size = data.read8();\n    assert(data.read8() === 0);\n    const amount = data.read16(); // unsure\n\n    return new OreLocation(kind, size, amount, position, discoveredBy);\n  }\n\n  constructor(\n    public kind: OreLocationKind,\n    public size: OreLocationSize,\n    public amount: number,\n    public position: PIXI.Point,\n    public discoveredBy: number\n  ) {}\n}\n","import * as PIXI from \"pixi.js\";\nimport FileSystem from \"./filesystem\";\nimport { textureFromUint8ArrayPNG } from \"./util/pixi\";\n\nexport default class SpriteLoader {\n  private textures: Map<string, Map<number, PIXI.Texture>> = new Map();\n\n  constructor(private readonly fs: FileSystem) {}\n\n  public async getTextures(directory: string) {\n    directory = `/gfx/${directory}`;\n    if (!this.textures.has(directory)) {\n      await this.loadTextures(directory);\n    }\n    return this.textures.get(directory);\n  }\n\n  private async loadTextures(directory: string) {\n    const textureMap = new Map();\n\n    const files = await this.fs.ls(directory);\n    for (const file of files) {\n      const fileExtension = file.name.substr(file.name.lastIndexOf(\".\") + 1);\n      if (fileExtension === \"png\") {\n        const dataFileName =\n          file.fullPath.substring(0, file.fullPath.lastIndexOf(\".\")) + \".json\";\n        const spriteSheetData = JSON.parse(\n          await this.fs.openAndGetContentAsText(dataFileName)\n        );\n\n        const spriteSheetImageData = await this.fs.openAndGetContentAsUint8Array(\n          file\n        );\n        const tex = textureFromUint8ArrayPNG(spriteSheetImageData);\n        const spritesheet = new PIXI.Spritesheet(\n          tex.baseTexture,\n          spriteSheetData\n        );\n\n        const textures = await new Promise<{ [key: string]: PIXI.Texture }>(\n          (resolve, reject) => {\n            spritesheet.parse((sheet: any, hmm: any) => {\n              // This appears to be a bug.\n              resolve(sheet as { [key: string]: PIXI.Texture });\n            });\n          }\n        );\n\n        for (const gfxId of Object.keys(textures)) {\n          const texture = textures[gfxId];\n          textureMap.set(parseInt(gfxId, 10), texture);\n        }\n      }\n    }\n    this.textures.set(directory, textureMap);\n  }\n}\n","/*\n * The savegame data structure was reverse-engineered by Benedikt Freisen\n * as part of the 'mdcii-engine' project and released under GPLv2+.\n * https://github.com/roybaer/mdcii-engine\n */\n\nimport Stream from \"../../parsers/stream\";\nimport { Rotation8 } from \"./world\";\n\nexport enum SoldierType {\n  Swordsman = 0,\n  Cavalry = 1,\n  Musketeer = 2,\n  Gunner = 3,\n  Native = 8\n}\n\nexport type Soldier = ReturnType<typeof soldierFromSaveGame>;\n\nexport function soldierFromSaveGame(data: Stream) {\n  const position = new PIXI.Point(data.read16() / 2, data.read16() / 2);\n  const hp = data.read16();\n  const type = data.read16();\n  const id = data.read16();\n  const course1 = data.read(4);\n  const _1 = data.read16();\n  const _2 = data.read16();\n  const _3 = data.read8();\n  const _4 = data.read8();\n  const _5 = data.read32();\n  const playerId = data.read8();\n  const _6 = data.read8();\n  const _7 = data.read8();\n  const rotation = data.read8() as Rotation8;\n  const _8 = data.read8();\n  const isPatrolling = data.read8Bool();\n  const course2 = data.read(4);\n  const course3 = data.read(4);\n  const empty = data.read(30);\n\n  return {\n    id,\n    playerId,\n    type,\n    position: position,\n    rotation,\n    isPatrolling,\n    hp\n  };\n}\n","import FileSystem from \"../../filesystem\";\nimport Field from \"../../game/world/field\";\nimport { Island } from \"../../game/world/island\";\nimport assert from \"../../util/assert\";\nimport { Block } from \"./block\";\n\nexport type IslandSizeId = 0 | 1 | 2 | 3 | 4;\nexport type IslandSizeName = \"lit\" | \"mit\" | \"med\" | \"big\" | \"lar\";\ninterface IslandSize {\n  id: IslandSizeId;\n  name: IslandSizeName;\n  maxSize: number;\n}\n\nexport default class IslandLoader {\n  private readonly islandSizes: IslandSize[] = [\n    {\n      id: 0,\n      name: \"lit\",\n      maxSize: 35\n    },\n    {\n      id: 1,\n      name: \"mit\",\n      maxSize: 45\n    },\n    {\n      id: 2,\n      name: \"med\",\n      maxSize: 55\n    },\n    {\n      id: 3,\n      name: \"big\",\n      maxSize: 85\n    },\n    {\n      id: 4,\n      name: \"lar\",\n      maxSize: 100\n    }\n  ];\n\n  constructor(private fs: FileSystem) {}\n\n  public async loadIslandFile(island: Island) {\n    const climate = island.isSouth ? \"south\" : \"north\";\n    const islandNumber = island.numBaseIsland.toString().padStart(2, \"0\");\n    for (const islandSize of this.islandSizes) {\n      if (island.size.x <= islandSize.maxSize) {\n        return this.fs.openAndGetContentAsStream(\n          `/islands/${climate}/${islandSize.name}${islandNumber}.scp`\n        );\n      }\n    }\n\n    throw new Error(\"Could not load island\");\n  }\n\n  public async loadRandomIslandFile(\n    sizeId: 0 | 1 | 2 | 3 | 4,\n    climate: \"NORTH\" | \"SOUTH\" | \"ANY\"\n  ) {\n    const islandSize = this.islandSizes.find(size => size.id === sizeId);\n    if (islandSize === undefined) {\n      throw new Error(\"This should never happen.\");\n    }\n\n    const islandFiles = [];\n    if ([\"ANY\", \"NORTH\"].includes(climate)) {\n      islandFiles.push(\n        ...(await this.loadIslandsWithSizeAndClimate(islandSize.name, \"north\"))\n      );\n    }\n    if ([\"ANY\", \"SOUTH\"].includes(climate)) {\n      islandFiles.push(\n        ...(await this.loadIslandsWithSizeAndClimate(islandSize.name, \"south\"))\n      );\n    }\n\n    const randomIslandFile =\n      islandFiles[Math.floor(Math.random() * islandFiles.length)];\n\n    return {\n      data: await this.fs.openAndGetContentAsStream(\n        randomIslandFile.file.fullPath\n      ),\n      isSouth: randomIslandFile.climate === \"south\",\n      id: randomIslandFile.id\n    };\n  }\n\n  public parseIslandBuildings(\n    island: Island,\n    block: Block\n  ): Array<Array<Field | null>> {\n    const data = block.data;\n    const dataLength = block.length;\n\n    const fields: Field[][] = [];\n    for (let x = 0; x < island.size.x; x++) {\n      fields.push(new Array(island.size.y).fill(null));\n    }\n\n    for (let i = 0; i < dataLength / Field.saveGameDataLength; i++) {\n      const field = Field.fromSaveGame(data);\n      assert(field.x < island.size.x);\n      assert(field.y < island.size.y);\n      fields[field.x][field.y] = field;\n    }\n\n    return fields;\n  }\n\n  private async loadIslandsWithSizeAndClimate(\n    sizeName: IslandSizeName,\n    climate: \"north\" | \"south\"\n  ) {\n    return (await this.fs.ls(`/islands/${climate}`))\n      .filter(islandFile => islandFile.name.startsWith(sizeName))\n      .filter(islandFile => islandFile.name.match(/\\d\\d\\.scp$/) !== null)\n      .map(file => {\n        return {\n          file: file,\n          climate: climate,\n          id: parseInt(file.name.substr(3, 2), 10)\n        };\n      });\n  }\n}\n","// prettier-ignore\nconst idxToColors = new Uint8Array([\n  0x00, 0x00, 0x00,\n  0x80, 0x00, 0x00,\n  0x00, 0x80, 0x00,\n  0x80, 0x80, 0x00,\n  0x00, 0x00, 0x80,\n  0x6d, 0x1f, 0x6c,\n  0x00, 0x80, 0x80,\n  0xc0, 0xc0, 0xc0,\n  0xff, 0x00, 0xff,\n  0xff, 0x00, 0xff,\n  0x00, 0x00, 0x00,\n  0x00, 0x04, 0x04,\n  0x00, 0x08, 0x08,\n  0x00, 0x10, 0x00,\n  0x0b, 0x06, 0x03,\n  0x15, 0x08, 0x00,\n  0x25, 0x04, 0x00,\n  0x00, 0x14, 0x04,\n  0x06, 0x16, 0x06,\n  0x00, 0x21, 0x00,\n  0x03, 0x26, 0x03,\n  0x0e, 0x1c, 0x05,\n  0x08, 0x31, 0x04,\n  0x20, 0x18, 0x00,\n  0x1b, 0x2c, 0x00,\n  0x0a, 0x0c, 0x12,\n  0x08, 0x1c, 0x14,\n  0x18, 0x16, 0x10,\n  0x23, 0x17, 0x0c,\n  0x01, 0x29, 0x15,\n  0x0c, 0x2c, 0x13,\n  0x18, 0x2b, 0x11,\n  0x23, 0x29, 0x0f,\n  0x0a, 0x16, 0x25,\n  0x0a, 0x2c, 0x25,\n  0x24, 0x1f, 0x1f,\n  0x22, 0x31, 0x1d,\n  0x12, 0x24, 0x2c,\n  0x26, 0x2e, 0x29,\n  0x13, 0x22, 0x40,\n  0x04, 0x3d, 0x06,\n  0x10, 0x3b, 0x06,\n  0x15, 0x3e, 0x08,\n  0x25, 0x3d, 0x04,\n  0x0e, 0x3c, 0x28,\n  0x21, 0x3b, 0x23,\n  0x29, 0x3d, 0x20,\n  0x0e, 0x37, 0x40,\n  0x18, 0x3d, 0x3d,\n  0x21, 0x31, 0x3d,\n  0x25, 0x3d, 0x39,\n  0x11, 0x3a, 0x48,\n  0x29, 0x3d, 0x42,\n  0x11, 0x3c, 0x4e,\n  0x11, 0x3a, 0x5e,\n  0x0d, 0x4d, 0x00,\n  0x25, 0x4e, 0x00,\n  0x12, 0x4d, 0x08,\n  0x17, 0x4d, 0x25,\n  0x1c, 0x4d, 0x48,\n  0x19, 0x4d, 0x58,\n  0x16, 0x49, 0x6e,\n  0x11, 0x5f, 0x03,\n  0x25, 0x62, 0x00,\n  0x16, 0x5d, 0x3d,\n  0x16, 0x70, 0x2d,\n  0x15, 0x96, 0x24,\n  0x19, 0x7c, 0x6b,\n  0x1c, 0x94, 0x71,\n  0x00, 0x52, 0x8c,\n  0x08, 0x4a, 0x90,\n  0xf8, 0xc2, 0x30,\n  0x08, 0x52, 0x94,\n  0x08, 0x56, 0x94,\n  0x0c, 0x4e, 0x8c,\n  0x17, 0x52, 0x88,\n  0x00, 0x63, 0x8c,\n  0x18, 0x5e, 0x8c,\n  0x08, 0x5a, 0x9c,\n  0x0c, 0x5a, 0xa0,\n  0x12, 0x63, 0x94,\n  0x12, 0x65, 0x94,\n  0x0a, 0x75, 0x96,\n  0x08, 0x5a, 0xad,\n  0x08, 0x63, 0xa9,\n  0x0c, 0x67, 0xa5,\n  0x15, 0x68, 0xa5,\n  0x06, 0x79, 0xad,\n  0x13, 0x73, 0xab,\n  0x21, 0x73, 0xa5,\n  0x0a, 0x76, 0xb5,\n  0x18, 0x77, 0xb1,\n  0x21, 0x73, 0xad,\n  0x21, 0x7b, 0xb1,\n  0x18, 0x75, 0xbb,\n  0x08, 0x88, 0xbd,\n  0x0b, 0x88, 0xc4,\n  0x11, 0x88, 0xdc,\n  0x21, 0x9c, 0x84,\n  0x00, 0x9c, 0x94,\n  0x18, 0x9c, 0xb1,\n  0x00, 0x9c, 0xd6,\n  0x0c, 0x94, 0xce,\n  0xc4, 0x78, 0x5e,\n  0x0b, 0xad, 0xd8,\n  0x08, 0x94, 0xe7,\n  0x08, 0x94, 0xef,\n  0x0c, 0xa0, 0xe6,\n  0x1c, 0x98, 0xe2,\n  0x15, 0xb2, 0xe1,\n  0x10, 0xb1, 0xef,\n  0x18, 0xbd, 0xe7,\n  0x21, 0xbd, 0xde,\n  0x00, 0x94, 0xf7,\n  0x50, 0x96, 0xe2,\n  0x00, 0x9c, 0xff,\n  0xe0, 0x8a, 0x6c,\n  0xf2, 0x99, 0x7a,\n  0xe9, 0x71, 0x02,\n  0xff, 0x7d, 0x02,\n  0x08, 0xa5, 0xf7,\n  0xfb, 0xd8, 0x34,\n  0xf4, 0xaf, 0x2d,\n  0x10, 0x9c, 0xf7,\n  0x18, 0x94, 0xef,\n  0x14, 0x98, 0xfb,\n  0xff, 0xfc, 0x9d,\n  0x21, 0xa5, 0xf7,\n  0x36, 0x11, 0x04,\n  0x4a, 0x11, 0x04,\n  0x35, 0x2d, 0x0c,\n  0x46, 0x2c, 0x0b,\n  0x3c, 0x4a, 0x0b,\n  0x29, 0x63, 0x00,\n  0x3b, 0x5a, 0x13,\n  0x2d, 0x67, 0x00,\n  0x2e, 0x70, 0x00,\n  0x2d, 0x63, 0x08,\n  0x2c, 0x6a, 0x11,\n  0x37, 0x6d, 0x02,\n  0x37, 0x6a, 0x11,\n  0x42, 0x6a, 0x03,\n  0x44, 0x6c, 0x10,\n  0x3b, 0x2f, 0x26,\n  0x3e, 0x44, 0x29,\n  0x3b, 0x3d, 0x40,\n  0x3d, 0x4a, 0x3f,\n  0x3c, 0x61, 0x2d,\n  0x41, 0x5b, 0x44,\n  0x3f, 0x4d, 0x4b,\n  0x3c, 0x63, 0x4b,\n  0x31, 0x4c, 0x5a,\n  0x3f, 0x4b, 0x55,\n  0x2e, 0x62, 0x5a,\n  0x41, 0x65, 0x56,\n  0x3a, 0x5f, 0x68,\n  0x37, 0x62, 0x75,\n  0x37, 0x66, 0x8c,\n  0x5e, 0x16, 0x05,\n  0x59, 0x2a, 0x14,\n  0x5a, 0x40, 0x1a,\n  0x59, 0x60, 0x0b,\n  0x5a, 0x5e, 0x2d,\n  0x58, 0x50, 0x46,\n  0x57, 0x66, 0x44,\n  0x59, 0x4f, 0x50,\n  0x55, 0x67, 0x50,\n  0x5d, 0x6b, 0x4d,\n  0x5a, 0x58, 0x59,\n  0x56, 0x6f, 0x5a,\n  0x57, 0x63, 0x62,\n  0x58, 0x66, 0x75,\n  0x73, 0x21, 0x0a,\n  0x71, 0x41, 0x14,\n  0x6f, 0x5f, 0x11,\n  0x6f, 0x52, 0x39,\n  0x6c, 0x6f, 0x41,\n  0x6f, 0x6b, 0x5a,\n  0x6b, 0x68, 0x6b,\n  0x8f, 0x1d, 0x04,\n  0x89, 0x56, 0x0d,\n  0x8c, 0x58, 0x1f,\n  0x89, 0x63, 0x40,\n  0xac, 0x27, 0x05,\n  0xa6, 0x5d, 0x25,\n  0xc5, 0x31, 0x08,\n  0xcd, 0x54, 0x1e,\n  0x29, 0x7e, 0x02,\n  0x31, 0x7b, 0x00,\n  0x35, 0x7f, 0x00,\n  0x42, 0x7b, 0x00,\n  0x34, 0x7b, 0x0b,\n  0x36, 0x7b, 0x14,\n  0x36, 0x7a, 0x49,\n  0x31, 0x84, 0x04,\n  0x42, 0x84, 0x00,\n  0x31, 0x84, 0x14,\n  0x40, 0x84, 0x16,\n  0x35, 0x8c, 0x00,\n  0x35, 0x86, 0x37,\n  0x31, 0x8d, 0x32,\n  0x31, 0xa7, 0x1d,\n  0x53, 0x82, 0x09,\n  0x5b, 0x7e, 0x3e,\n  0x57, 0x79, 0x6b,\n  0x6c, 0x7b, 0x67,\n  0x52, 0xab, 0x06,\n  0x55, 0x91, 0x2f,\n  0x59, 0xb6, 0x29,\n  0x77, 0x7e, 0x3c,\n  0x77, 0x77, 0x69,\n  0x74, 0xb4, 0x30,\n  0xaa, 0x80, 0x2a,\n  0x91, 0x7d, 0x67,\n  0x85, 0xbb, 0x3a,\n  0xca, 0xac, 0x34,\n  0x2b, 0x85, 0x74,\n  0x53, 0x7f, 0x73,\n  0x7f, 0x7c, 0x73,\n  0x7d, 0x8e, 0x73,\n  0x4a, 0x7e, 0x7e,\n  0x49, 0x80, 0xa4,\n  0x76, 0x84, 0x7b,\n  0x76, 0x87, 0x8f,\n  0x2b, 0xa0, 0x7c,\n  0x5f, 0x9c, 0x84,\n  0x2d, 0xb5, 0x88,\n  0x3f, 0xc1, 0x8a,\n  0x5c, 0xa9, 0xbd,\n  0x3f, 0xde, 0xa7,\n  0x56, 0xed, 0xc8,\n  0x90, 0x89, 0x7b,\n  0x8d, 0x99, 0x85,\n  0x98, 0x95, 0x7f,\n  0xaf, 0x9a, 0x7c,\n  0x98, 0xa5, 0x8c,\n  0x98, 0xb2, 0x8d,\n  0xa9, 0xb0, 0x8c,\n  0xcc, 0xc2, 0x85,\n  0x9a, 0xb0, 0xad,\n  0xb9, 0xb6, 0xa0,\n  0xb3, 0xc8, 0xa7,\n  0xac, 0xd1, 0xcf,\n  0xdd, 0xda, 0xb5,\n  0xe1, 0xef, 0xe2,\n  0xfe, 0xfa, 0xe6,\n  0x00, 0x94, 0xff,\n  0xa0, 0xa0, 0xa4,\n  0x80, 0x80, 0x80,\n  0xff, 0x00, 0x00,\n  0x00, 0xff, 0x00,\n  0xff, 0xff, 0x00,\n  0x00, 0x00, 0xff,\n  0xff, 0x00, 0xff,\n  0x00, 0xff, 0xff,\n  0xff, 0xff, 0xff,\n]);\n\nexport default idxToColors;\n\nconst colorsToIdxInner: Record<string, number> = {};\n\nfor (let i = 0; i < idxToColors.length / 3; i++) {\n  const color =\n    (idxToColors[i * 3 + 0] << 24) +\n    (idxToColors[i * 3 + 1] << 16) +\n    (idxToColors[i * 3 + 2] << 8) +\n    0xff;\n  colorsToIdxInner[color.toString()] = i;\n}\n\nexport const colorsToIdx = colorsToIdxInner;\n","/*\n * The savegame data structure was reverse-engineered by Benedikt Freisen\n * as part of the 'mdcii-engine' project and released under GPLv2+.\n * https://github.com/roybaer/mdcii-engine\n */\n\nimport Stream from \"../../parsers/stream\";\nimport assert from \"../../util/assert\";\n\ninterface ReachInhabitants {\n  count: number; // require n inhabitants\n  requiredLevel: number; // out of the n, a few need to reach level x\n  requiredLevelCount: number; // require y of n inhabitants with level x\n}\n\nexport type Task = ReturnType<typeof taskFromSaveGame>;\n\nexport function taskFromSaveGame(data: Stream) {\n  const id = data.read32();\n  const _1 = data.read(28);\n\n  const monopolyGoodId1 = data.read8();\n  assert(data.read8() === 0);\n  const monopolyGoodId2 = data.read8();\n  assert(data.read8() === 0);\n  const helpOtherToReachInhabitantsPlayerId = data.read8(); // Can be 0, 1, 2, 3 or 7 for any player.\n\n  assert(data.read(6).every(e => e === 0));\n\n  const playersToKill = [];\n  if (data.read8Bool()) {\n    // Any does not include trader, pirate and native.\n    playersToKill.push(\"any\");\n  }\n  if (data.read8Bool()) {\n    playersToKill.push(\"red\");\n  }\n  if (data.read8Bool()) {\n    playersToKill.push(\"blue\");\n  }\n  if (data.read8Bool()) {\n    playersToKill.push(\"yellow\");\n  }\n  if (data.read8Bool()) {\n    playersToKill.push(\"white\");\n  }\n  if (data.read8Bool()) {\n    // Should never be true\n    playersToKill.push(\"trader\");\n  }\n  if (data.read8Bool()) {\n    playersToKill.push(\"pirate\");\n  }\n  if (data.read8Bool()) {\n    // Should never be true\n    playersToKill.push(\"native\");\n  }\n\n  const _3 = data.read(25);\n\n  const requiredBalance = data.read32();\n  const successVideoId = data.read32();\n  const requiredTradeBalance = data.read32();\n  const _5 = data.read(16);\n\n  const text = data.readString(2048);\n\n  const _6 = data.read(8);\n\n  const ownCityReachInhabitants: ReachInhabitants[] = [];\n  for (let i = 0; i < 3; i++) {\n    ownCityReachInhabitants.push({\n      count: data.read32(),\n      requiredLevel: data.read32(),\n      requiredLevelCount: data.read32()\n    });\n  }\n\n  const _7 = data.read(36);\n\n  const helpOtherToReachInhabitants: ReachInhabitants = {\n    count: data.read32(),\n    requiredLevel: data.read32(),\n    requiredLevelCount: data.read32()\n  };\n\n  console.warn(\"task\", id, _1, _3, _5, _6, _7);\n\n  return {\n    id,\n    text,\n    successVideoId,\n    playersToKill,\n    requiredBalance,\n    requiredTradeBalance,\n    ownCityReachInhabitants,\n    helpOtherToReachInhabitantsPlayerId,\n    helpOtherToReachInhabitants,\n    monopolyGoodId1,\n    monopolyGoodId2\n  };\n}\n","import WaveFile from \"wavefile\";\n\ninterface ADPCMChannelStatus {\n  predictor: number;\n  step_index: number;\n}\n\nexport interface RawSamples {\n  left: Int16Array;\n  right: Int16Array;\n  sampleRate: number;\n}\n\n/**\n * This code is based on FFmpeg:\n * https://github.com/FFmpeg/FFmpeg/blob/a8ce6fb425e07e60eb06d3f44992fdb91f23aafb/libavcodec/adpcm.c#L180-L204\n *\n * FFmpeg is licensed under the terms of the GNU Lesser General Public License 2.1 and later.\n */\nexport default class WAVParser {\n  // prettier-ignore\n  private readonly adpcmIndexTable = [\n    -1, -1, -1, -1, 2, 4, 6, 8,\n    -1, -1, -1, -1, 2, 4, 6, 8,\n  ];\n\n  // prettier-ignore\n  private readonly adpcmStepTable = [\n    7,     8,     9,    10,    11,    12,    13,    14,    16,    17,\n    19,    21,    23,    25,    28,    31,    34,    37,    41,    45,\n    50,    55,    60,    66,    73,    80,    88,    97,   107,   118,\n    130,   143,   157,   173,   190,   209,   230,   253,   279,   307,\n    337,   371,   408,   449,   494,   544,   598,   658,   724,   796,\n    876,   963,  1060,  1166,  1282,  1411,  1552,  1707,  1878,  2066,\n    2272,  2499,  2749,  3024,  3327,  3660,  4026,  4428,  4871,  5358,\n    5894,  6484,  7132,  7845,  8630,  9493, 10442, 11487, 12635, 13899,\n    15289, 16818, 18500, 20350, 22385, 24623, 27086, 29794, 32767,\n  ];\n\n  public decode(data: Uint8Array): RawSamples {\n    const wav = new WaveFile(data);\n\n    const bitsPerSample: number = (wav.fmt as any).bitsPerSample;\n    const sampleRate: number = (wav.fmt as any).sampleRate;\n    const channels: number = (wav.fmt as any).numChannels;\n\n    if (bitsPerSample !== 4) {\n      throw new Error(\"Can only convert .wav files with 4 bits per sample.\");\n    }\n    if (channels !== 2) {\n      throw new Error(\"Can only convert .wav files with stereo sound.\");\n    }\n\n    const c1: ADPCMChannelStatus = {\n      step_index: 0,\n      predictor: 0\n    };\n    const c2: ADPCMChannelStatus = {\n      step_index: 0,\n      predictor: 0\n    };\n\n    const samples: Buffer = (wav.data as any).samples;\n    const left = new Int16Array(samples.length);\n    const right = new Int16Array(samples.length);\n    for (let i = 0; i < samples.length; i++) {\n      left[i] = this.decodeADPCM_IMA(c1, samples[i] >>> 4);\n      right[i] = this.decodeADPCM_IMA(c2, samples[i] & 0x0f);\n    }\n\n    return {\n      left,\n      right,\n      sampleRate\n    };\n  }\n\n  public encode(rawData: RawSamples) {\n    const numSamples = rawData.left.length;\n    const samples = new Int16Array(numSamples * 2);\n    for (let i = 0; i < numSamples; i++) {\n      samples[i * 2 + 0] = rawData.left[i];\n      samples[i * 2 + 1] = rawData.right[i];\n    }\n\n    const wav = new WaveFile();\n    wav.fromScratch(2, rawData.sampleRate, \"16\", samples as any);\n    return wav.toBuffer();\n  }\n\n  private av_clip(n: number, min: number, max: number) {\n    return Math.min(Math.max(min, n), max);\n  }\n\n  private av_clip_int16(a: number) {\n    if ((a + 0x8000) & ~0xffff) {\n      return (a >> 31) ^ 0x7fff;\n    } else {\n      return a;\n    }\n  }\n\n  private decodeADPCM_IMA(c: ADPCMChannelStatus, nibble: number) {\n    const step = this.adpcmStepTable[c.step_index];\n    const stepIndex = this.av_clip(\n      c.step_index + this.adpcmIndexTable[nibble],\n      0,\n      88\n    );\n\n    const sign = nibble & 8;\n    const delta = nibble & 7;\n    const diff = ((2 * delta + 1) * step) >>> 3;\n    let predictor = c.predictor;\n    if (sign) {\n      predictor -= diff;\n    } else {\n      predictor += diff;\n    }\n\n    c.predictor = this.av_clip_int16(predictor);\n    c.step_index = stepIndex;\n\n    return c.predictor;\n  }\n}\n","/*\n * The savegame data structure was reverse-engineered by Benedikt Freisen\n * as part of the 'mdcii-engine' project and released under GPLv2+.\n * https://github.com/roybaer/mdcii-engine\n */\n\nimport Stream from \"../../parsers/stream\";\nimport { ShipCourse } from \"./ship-course\";\nimport { Rotation8 } from \"./world\";\n\nexport interface ShipGood {\n  good_id: number;\n  amount: number;\n  action: number;\n}\n\nexport interface ShipTradeStop {\n  id: number;\n  kontor_id: number;\n  _1: number;\n  goods: ShipGood[];\n  _2: number[];\n}\n\nexport type Ship = ReturnType<typeof shipFromSaveGame>;\n\nexport function shipFromSaveGame(data: Stream) {\n  const name = data.readString(28);\n  const position = new PIXI.Point(data.read16(), data.read16());\n  const _1 = data.read(3 * 4);\n\n  const courseFrom = ShipCourse.fromSaveGame(data);\n  const courseTo = ShipCourse.fromSaveGame(data);\n  const courseCurrent = ShipCourse.fromSaveGame(data);\n\n  const _2 = data.read32();\n  const hp = data.read16();\n  const _3 = data.read32();\n  const canons = data.read8();\n  const flags = data.read8();\n  const sellingPrice = data.read16();\n  const id = data.read16();\n  const type = data.read16();\n  const _4 = data.read8();\n  const playerId = data.read8();\n  const _5 = data.read32();\n  const rotation = data.read16() as Rotation8;\n  const tradeStops = parseShipTradeStops(data, 8);\n  const _6 = data.read16();\n  const cargo = parseShipGoods(data, 8);\n  // type_name = SHIP_TYPES[ship['type']],\n\n  return {\n    id,\n    playerId,\n    position,\n    rotation,\n    name,\n    hp,\n    tradeStops,\n    cargo\n  };\n}\n\nfunction parseShipTradeStops(data: Stream, n: number): ShipTradeStop[] {\n  const tradeStops = [];\n  for (let i = 0; i < n; i++) {\n    tradeStops.push({\n      id: data.read8(),\n      kontor_id: data.read8(),\n      _1: data.read16(),\n      goods: parseShipGoods(data, 2),\n      _2: data.read(16)\n    });\n  }\n  return tradeStops;\n}\n\nfunction parseShipGoods(data: Stream, n: number): ShipGood[] {\n  const cargo = [];\n  for (let i = 0; i < n; i++) {\n    cargo.push({\n      good_id: data.read16(),\n      amount: data.read16(),\n      action: data.read32() // 0 == 'load', 1 == 'unload'\n    });\n  }\n  return cargo;\n}\n","/*\n * The savegame data structure was reverse-engineered by Benedikt Freisen\n * as part of the 'mdcii-engine' project and released under GPLv2+.\n * https://github.com/roybaer/mdcii-engine\n */\n\nimport Stream from \"../../parsers/stream\";\n\nexport enum GoodAction {\n  None = 0,\n  Sell = 1,\n  Buy = 2\n}\n\nexport default class Good {\n  public static fromSaveGame(data: Stream) {\n    const tmp = data.read32();\n    const sellingPrice = (tmp & 0b00000000000000000000001111111111) >> 0;\n    const buyingPrice = (tmp & 0b00000000000011111111110000000000) >> 10;\n    const action: GoodAction = (tmp & 0b11111111111100000000000000000000) >> 20;\n    const _1 = data.read32();\n    const wantedSellingAmount = data.read16() >> 5;\n    const wantedBuyingAmount = data.read16() >> 5;\n    const currentAmount = data.read16() >> 5;\n    const _2 = data.read16();\n\n    /*\n        100101100001 // iron ore\n        100101100101 // gold ore\n        010111100001 // wool\n        010111100111 // sugarcane\n        010111100011 // tobacco\n        010111101001 // cows\n        010111011111 // grain\n        000111110101 // flour\n        001000001001 // iron\n        001000000101 // swords\n        001000010001 // muskets\n        001000001111 // canons\n        010000110011 // food\n        001000001101 // tobacco\n        010111011101 // spice\n        010111100101 // cacao\n        001000000111 // wine\n        000111111011 // fabric\n        000111111001 // clothing\n        001000010101 // jewellery\n        001000000011 // tools\n        011111010001 // wood\n        001000000001 // stone\n         */\n    const goodId = data.read16();\n    const _3 = data.read16();\n\n    return new Good(\n      goodId,\n      sellingPrice,\n      buyingPrice,\n      wantedSellingAmount,\n      wantedBuyingAmount,\n      currentAmount,\n      action\n    );\n  }\n\n  constructor(\n    public goodId: number,\n    public sellingPrice: number,\n    public buyingPrice: number,\n    public wantedSellingAmount: number,\n    public wantedBuyingAmount: number,\n    public currentAmount: number,\n    public action: GoodAction\n  ) {}\n}\n","// https://stackoverflow.com/a/12713326/2560557\nimport * as JSZip from \"jszip\";\n\nexport function uInt8ToBase64(arr: Uint8Array): string {\n  const CHUNK_SIZE = 0x8000; // arbitrary number\n  let index = 0;\n  const length = arr.length;\n  let result = \"\";\n  while (index < length) {\n    const slice = arr.subarray(index, Math.min(index + CHUNK_SIZE, length));\n    result += String.fromCharCode.apply(null, slice);\n    index += CHUNK_SIZE;\n  }\n\n  // tslint:disable:no-eval\n  return typeof window !== \"undefined\"\n    ? btoa(result)\n    : eval(\"require\")(\"btoa\")(result);\n  // tslint:enable:no-eval\n}\n\n/**\n * Get the value of the first query parameter with the given name.\n *\n * Taken from https://stackoverflow.com/a/901144\n */\nexport function getQueryParameter(name: string): string {\n  const url = window.location.href;\n  name = name.replace(/[\\[\\]]/g, \"\\\\$&\");\n  const regex = new RegExp(\"[?&]\" + name + \"(=([^&#]*)|&|#|$)\");\n  const results = regex.exec(url);\n  if (!results) {\n    return null;\n  }\n  if (!results[2]) {\n    return \"\";\n  }\n  return decodeURIComponent(results[2].replace(/\\+/g, \" \"));\n}\n\nexport function findRootInZip(zip: JSZip): JSZip {\n  const gfxFolder = zip.filter(relativePath =>\n    (\"/\" + relativePath).endsWith(\"/GFX/\")\n  );\n  if (gfxFolder.length === 1) {\n    return zip.folder(gfxFolder[0].name.replace(\"GFX/\", \"\"));\n  }\n  throw new Error(\"Your ZIP file does not have the expected structure.\");\n}\n","import * as PIXI from \"pixi.js\";\nimport { uInt8ToBase64 } from \"./util\";\n\nexport function textureFromUint8ArrayPNG(data: Uint8Array) {\n  return PIXI.Texture.fromImage(`data:image/png;base64,${uInt8ToBase64(data)}`);\n}\n\nexport async function textureFromUint8ArrayMP4(\n  data: Uint8Array\n): Promise<PIXI.VideoBaseTexture> {\n  const tmpVideo = document.createElement(\"video\");\n  tmpVideo.src = `data:video/mp4;base64,${uInt8ToBase64(data)}`;\n  const texture = PIXI.VideoBaseTexture.fromVideo(tmpVideo);\n\n  return new Promise<PIXI.VideoBaseTexture>((resolve, reject) => {\n    texture.on(\"loaded\", () => resolve(texture));\n    texture.on(\"error\", reject);\n  });\n}\n","import { TranslationDomain } from \"./translations\";\n\nexport default function parseTranslations(\n  data: string\n): Record<TranslationDomain, string[]> {\n  const translations: any = {};\n  let currentDomain: string | null;\n\n  for (const line of data.split(\"\\r\\n\")) {\n    if (currentDomain) {\n      if (line === \"[END]\") {\n        currentDomain = null;\n      } else {\n        translations[currentDomain].push(line);\n      }\n    } else {\n      if (line.startsWith(\"[\")) {\n        currentDomain = line.split(/[[\\]]/)[1];\n        translations[currentDomain] = [];\n      }\n    }\n  }\n\n  return translations as Record<TranslationDomain, string[]>;\n}\n"],"sourceRoot":""}